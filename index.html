<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>VertexScripts - Advanced Script Uploader & Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== ALL EXISTING CSS REMAINS 100% UNCHANGED ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: 0 20px;
        }
        
        /* PC Enhanced Header */
        .pc-enhanced-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .pc-header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .pc-header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .pc-nav {
            display: flex;
            gap: 20px;
        }
        
        .pc-nav-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .pc-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .pc-nav-btn.active {
            background: rgba(75, 207, 250, 0.2);
            border: 2px solid #4bcffa;
        }
        
        /* Premium Upgrade Styles */
        .upgrade-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
        }
        
        .upgrade-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .upgrade-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .upgrade-header h3 {
            color: #ffd700;
            font-size: 1.8rem;
        }
        
        .close-upgrade {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-upgrade:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .video-ad-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .ad-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .ad-timer-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }
        
        .ad-timer-overlay.warning {
            background: rgba(255, 107, 107, 0.8);
        }
        
        .upgrade-body {
            padding: 25px;
        }
        
        .upgrade-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .upgrade-feature {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .upgrade-feature i {
            font-size: 2.5rem;
            color: #ffd700;
            margin-bottom: 15px;
        }
        
        .upgrade-feature h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .upgrade-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn-premium {
            background: linear-gradient(to right, #ffd700, #ffaa00);
            color: #000;
            font-weight: bold;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .btn-premium:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }
        
        /* Updated Dropdown Menu */
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: rgba(30, 30, 46, 0.98);
            min-width: 250px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            border-radius: 8px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 5px;
        }
        
        .dropdown.active .dropdown-content {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .dropdown-content a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-content a.upgrade-link {
            color: #ffd700;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            background: rgba(255, 215, 0, 0.05);
        }
        
        .dropdown-content a.upgrade-link:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .dropdown-content a.upgrade-link i {
            color: #ffd700;
        }
        
        /* Step Counter Alert */
        .step-limit-alert {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
            align-items: center;
            gap: 15px;
        }
        
        .step-limit-alert i {
            color: #ff6b6b;
            font-size: 1.5rem;
        }
        
        .step-limit-alert p {
            flex: 1;
        }
        
        /* Upload Option Buttons */
        .upload-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .upload-option-btn {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .upload-option-btn.active {
            background: rgba(75, 207, 250, 0.2);
            border-color: #4bcffa;
        }
        
        /* Premium Badge */
        .premium-badge {
            display: inline-block;
            background: linear-gradient(to right, #ffd700, #ffaa00);
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        /* Owner Crown Badge (NEW) */
        .owner-badge {
            display: inline-block;
            background: linear-gradient(to right, #ffd700, #ffaa00);
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            border: 1px solid #fff;
            box-shadow: 0 0 8px gold;
        }
        .owner-badge i {
            color: #000;
            margin-right: 4px;
        }
        
        /* Keep all existing CSS from the original code */
        /* ... existing CSS continues ... */
        
        /* Hashtag Styles */
        .hashtag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .hashtag {
            background: rgba(75, 207, 250, 0.2);
            color: #4bcffa;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(75, 207, 250, 0.3);
        }
        
        .hashtag:hover {
            background: rgba(75, 207, 250, 0.3);
            transform: translateY(-2px);
        }
        
        .hashtag.required {
            background: rgba(255, 100, 100, 0.2);
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .hashtag-counter {
            font-size: 0.75rem;
            margin-left: 5px;
            opacity: 0.8;
        }
        
        /* Hashtag Explorer */
        .hashtag-explorer {
            display: none;
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .hashtag-explorer.active {
            display: block;
        }
        
        .hashtag-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hashtag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .hashtag-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hashtag-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }
        
        .hashtag-card .hashtag {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .hashtag-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        /* Enhanced Script Card for PC */
        .pc-script-card {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .pc-script-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .pc-script-thumbnail {
            height: 200px;
            width: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .pc-script-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .pc-script-card:hover .pc-script-thumbnail img {
            transform: scale(1.05);
        }
        
        .pc-script-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .pc-script-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }
        
        .pc-script-description {
            font-size: 0.95rem;
            opacity: 0.9;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .pc-script-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Enhanced View Modal */
        .enhanced-view-modal {
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .enhanced-view-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
        }
        
        .enhanced-video-section {
            grid-column: 1;
        }
        
        .enhanced-info-section {
            grid-column: 2;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }
        
        .enhanced-description {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .enhanced-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .enhanced-stat {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .enhanced-stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4bcffa;
            display: block;
        }
        
        .enhanced-stat-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Description Input with Counter */
        .description-container {
            position: relative;
        }
        
        .description-counter {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .description-counter.warning {
            color: #ff6b6b;
        }
        
        .description-counter.error {
            color: #ff0000;
            font-weight: bold;
        }
        
        /* Word Counter for Description */
        .word-counter {
            text-align: right;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        /* Advanced Search Bar */
        .advanced-search {
            position: relative;
            width: 300px;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 46, 0.98);
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
        }
        
        .search-suggestions.active {
            display: block;
        }
        
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s ease;
        }
        
        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .suggestion-hashtag {
            color: #4bcffa;
            font-size: 0.85rem;
        }
        
        /* New Auth Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .auth-tab.active {
            color: #4bcffa;
            border-bottom: 2px solid #4bcffa;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-error {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }
        
        .delete-account-btn {
            background: #ff6b6b;
            margin-top: 20px;
            width: 100%;
        }
        
        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .script-view-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .script-view-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .script-view-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-view {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-view:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .script-view-body {
            padding: 25px;
        }
        
        .script-view-thumbnail {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        .script-view-thumbnail img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .video-player-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .video-player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
        }
        
        /* YouTube Watch Options */
        .watch-options {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .watch-option-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .watch-option-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .watch-option-btn.active {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
        }
        
        .watch-here-btn.active {
            background: rgba(75, 207, 250, 0.2);
            border-color: #4bcffa;
        }
        
        .youtube-thumbnail {
            position: relative;
            cursor: pointer;
        }
        
        .youtube-thumbnail:hover .play-button {
            transform: scale(1.1);
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            transition: all 0.3s ease;
        }
        
        .script-view-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            align-items: center;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .like-btn, .dislike-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            padding: 5px;
            position: relative;
        }
        
        .like-btn:hover {
            color: #4bcffa;
        }
        
        .dislike-btn:hover {
            color: #ff6b6b;
        }
        
        .like-btn.liked {
            color: #4bcffa;
        }
        
        .dislike-btn.disliked {
            color: #ff6b6b;
        }
        
        .subscribe-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .subscribe-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .subscribe-btn.subscribed {
            background: #4bcffa;
            color: #0c2461;
        }
        
        /* Channel View Styles */
        .channel-container {
            display: none;
        }
        
        .channel-header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .channel-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .channel-stat {
            text-align: center;
        }
        
        .channel-stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4bcffa;
        }
        
        .channel-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .channel-scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Subscriptions Container */
        .subscriptions-container {
            display: none;
        }
        
        .subscriptions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Pin Icon */
        .pin-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #ffd700;
            font-size: 1.2rem;
            z-index: 1;
        }
        
        .pin-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 5px;
        }
        
        .pin-btn.pinned {
            color: #ffd700;
        }
        
        /* Script Details in Card */
        .script-details {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .script-uploader {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .script-uploader i {
            color: #4bcffa;
        }
        
        /* ========== MOBILE SIDEBAR (REPLACES DROPDOWN, ALL EXISTING CODE PRESERVED) ========== */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
        }
        
        /* Mobile Sidebar - Expandable/Collapsible (NO DROPDOWN) */
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100vh;
            background: rgba(10, 15, 30, 0.98);
            backdrop-filter: blur(15px);
            z-index: 9999;
            transition: left 0.3s ease-in-out;
            box-shadow: 5px 0 30px rgba(0,0,0,0.5);
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            padding: 25px 0;
            display: flex;
            flex-direction: column;
        }
        .mobile-sidebar.active {
            left: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .sidebar-header h3 {
            color: #4bcffa;
            font-size: 1.4rem;
        }
        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-sidebar:hover {
            background: rgba(255,255,255,0.1);
        }
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        .sidebar-nav a {
            color: white;
            padding: 15px 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background 0.2s;
        }
        .sidebar-nav a:hover {
            background: rgba(75, 207, 250, 0.15);
        }
        .sidebar-nav a i {
            width: 24px;
            text-align: center;
            color: #4bcffa;
        }
        .sidebar-nav a.upgrade-link {
            color: #ffd700;
            background: rgba(255,215,0,0.05);
            border-top: 1px solid rgba(255,215,0,0.2);
            margin-top: 20px;
        }
        .sidebar-nav a.upgrade-link i {
            color: #ffd700;
        }
        .sidebar-premium-timer {
            margin: 20px;
            padding: 15px;
            background: rgba(255,215,0,0.1);
            border-radius: 12px;
            border: 1px solid rgba(255,215,0,0.3);
            text-align: center;
        }
        .sidebar-premium-timer span {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            margin-top: 5px;
        }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
            display: none;
        }
        .sidebar-overlay.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .pc-enhanced-header {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            /* Hide all dropdown content on mobile (replaced by sidebar) */
            .dropdown-btn {
                display: none;
            }
            .dropdown-content {
                display: none !important;
            }
            .mobile-dropdown-content {
                display: none !important;
            }
            
            .header-controls {
                display: flex;
                flex-direction: column;
                gap: 12px;
                width: 100%;
            }
            
            .search-container {
                flex: 1;
            }
            
            .watch-options {
                flex-direction: column;
            }
            
            .watch-option-btn {
                min-width: 100%;
            }
            
            .enhanced-view-content {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .enhanced-info-section {
                margin-top: 20px;
            }
            
            .upgrade-features {
                grid-template-columns: 1fr;
            }
            
            .upgrade-actions {
                flex-direction: column;
            }
            
            .btn-premium {
                width: 100%;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-only {
                display: none !important;
            }
            
            .pc-script-card {
                display: grid;
            }
            
            .enhanced-view-modal {
                display: flex !important;
            }
            
            .video-ad-container.half-screen {
                width: 50%;
                margin: 20px auto;
                padding-bottom: 28.125%;
            }
            .mobile-sidebar, .sidebar-overlay {
                display: none !important;
            }
        }
        
        /* Updated Header */
        header {
            display: none;
        }
        
        @media (max-width: 768px) {
            header {
                display: flex;
                flex-direction: column;
                gap: 15px;
                padding: 15px 0;
                margin-bottom: 20px;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                position: relative;
            }
            
            .logo-section {
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
            }
            
            .user-info {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 0.9rem;
                opacity: 0.9;
            }
            
            .header-controls {
                display: flex;
                flex-direction: column;
                gap: 12px;
                width: 100%;
            }
            
            .search-container {
                position: relative;
                width: 100%;
            }
            
            .search-input {
                padding: 12px 15px 12px 45px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: white;
                font-size: 1rem;
                width: 100%;
                -webkit-appearance: none;
                font-size: 16px;
            }
            
            .search-icon {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: rgba(255, 255, 255, 0.6);
                pointer-events: none;
            }
            
            .upload-btn {
                background: linear-gradient(to right, #4bcffa, #5d79ff);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                width: 100%;
                font-size: 1rem;
                touch-action: manipulation;
            }
            
            .credit {
                font-size: 0.9rem;
                opacity: 0.8;
                background: rgba(0, 0, 0, 0.2);
                padding: 8px 15px;
                border-radius: 20px;
                text-align: center;
                width: 100%;
            }
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 1024px) {
            .main-content {
                gap: 30px;
                margin-bottom: 40px;
            }
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .card {
                padding: 25px;
            }
        }
        
        .card h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }
        
        @media (min-width: 768px) {
            .card h2 {
                margin-bottom: 20px;
                font-size: 1.6rem;
            }
        }
        
        .card h2 i {
            color: #4bcffa;
        }
        
        .dashboard-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .dashboard-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
            }
        }
        
        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-stats {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .dashboard-stats {
                gap: 20px;
                justify-content: flex-start;
            }
        }
        
        .stat {
            text-align: center;
            min-width: 80px;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .stat-number {
                font-size: 1.8rem;
            }
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        @media (min-width: 768px) {
            .stat-label {
                font-size: 0.9rem;
            }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .form-group {
                margin-bottom: 20px;
            }
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #ddd;
            font-size: 0.95rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            -webkit-appearance: none;
            min-height: 48px;
        }
        
        @media (min-width: 768px) {
            input, textarea {
                padding: 12px 15px;
            }
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #4bcffa;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            font-size: 16px;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 48px;
        }
        
        .file-upload-label:hover, .file-upload-label:active {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4bcffa;
        }
        
        .file-upload-label i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #4bcffa;
        }
        
        .thumbnail-preview {
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        
        .thumbnail-preview img {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .step-container {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .step-container {
                margin-bottom: 15px;
            }
        }
        
        .step-container.vertex-step {
            background: rgba(75, 207, 250, 0.1);
            border: 1px solid rgba(75, 207, 250, 0.3);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .step-title {
            font-weight: 600;
            color: #4bcffa;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .step-title i {
            color: #ff6b6b;
        }
        
        .vertex-step .step-title i {
            color: #4bcffa;
        }
        
        .remove-step {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            min-height: 32px;
            touch-action: manipulation;
        }
        
        .vertex-step .remove-step {
            display: none !important;
        }
        
        .step-url {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            width: 100%;
            margin-top: 5px;
        }
        
        .vertex-step .step-url {
            background: rgba(0, 0, 0, 0.2) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            cursor: not-allowed;
        }
        
        .btn {
            background: linear-gradient(to right, #4bcffa, #5d79ff);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            font-size: 1rem;
            touch-action: manipulation;
        }
        
        @media (min-width: 768px) {
            .btn {
                width: auto;
                padding: 12px 25px;
            }
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(75, 207, 250, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-danger {
            background: #ff6b6b;
        }
        
        .btn-danger:hover, .btn-secondary:active {
            background: #ff5252;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .button-group {
                flex-direction: row;
                gap: 10px;
                margin-top: 10px;
            }
        }
        
        .scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 640px) {
            .scripts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }
        }
        
        @media (min-width: 1024px) {
            .scripts-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 25px;
            }
        }
        
        .script-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .script-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .script-card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
        }
        
        .script-card:hover .script-card-actions {
            opacity: 1;
        }
        
        @media (hover: none) {
            .script-card-actions {
                opacity: 1;
            }
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .action-btn:hover, .action-btn:active {
            transform: scale(1.1);
        }
        
        .delete-btn:hover, .delete-btn:active {
            background: #ff6b6b;
        }
        
        .edit-btn:hover, .edit-btn:active {
            background: #4bcffa;
        }
        
        .script-thumbnail {
            height: 160px;
            width: 100%;
            background: linear-gradient(45deg, #0c2461, #1e3799);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4bcffa;
            font-size: 2.5rem;
        }
        
        @media (min-width: 768px) {
            .script-thumbnail {
                height: 180px;
                font-size: 3rem;
            }
        }
        
        .script-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .script-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 768px) {
            .script-info {
                padding: 20px;
            }
        }
        
        .script-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .script-title {
                font-size: 1.3rem;
            }
        }
        
        .script-author {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .script-meta {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .steps-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (min-width: 768px) {
            .step-dot {
                width: 10px;
                height: 10px;
            }
        }
        
        .step-dot.active {
            background: #4bcffa;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .modal-content {
                padding: 30px;
            }
        }
        
        .modal h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            color: #4bcffa;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .modal h3 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
        }
        
        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .timer {
                font-size: 3rem;
                margin: 25px 0;
            }
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .progress-bar {
                margin: 20px 0;
            }
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4bcffa, #5d79ff);
            width: 0%;
            transition: width 1s linear;
        }
        
        .step-check {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            transition: opacity 0.3s ease;
            text-align: left;
        }
        
        .step-check.completed {
            opacity: 0.85;
        }
        
        .step-check.completed .check-circle {
            border-color: #4bcffa;
        }
        
        .step-check.completed .check-circle i {
            opacity: 1;
        }
        
        .step-check.in-progress .check-circle {
            border-color: #4bcffa;
            border-top-color: transparent;
        }
        
        .check-circle {
            min-width: 40px;
            min-height: 40px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .check-circle {
                min-width: 50px;
                min-height: 50px;
                width: 50px;
                height: 50px;
                margin-right: 15px;
            }
        }
        
        .check-circle.spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .check-circle i {
            color: #4bcffa;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .check-circle i {
                font-size: 1.5rem;
            }
        }
        
        .step-text {
            text-align: left;
            flex: 1;
            overflow: hidden;
        }
        
        .step-name {
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-word;
        }
        
        .step-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        @media (min-width: 768px) {
            .step-desc {
                font-size: 0.9rem;
            }
        }
        
        .step-link-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 8px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            touch-action: manipulation;
        }
        
        @media (min-width: 768px) {
            .step-link-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }
        
        .step-link-btn:hover, .step-link-btn:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .step-link-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .unlock-btn {
            background: #00b894;
            margin-top: 20px;
            width: 100%;
        }
        
        .unlock-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.7;
            grid-column: 1 / -1;
        }
        
        @media (min-width: 768px) {
            .empty-state {
                padding: 60px 20px;
            }
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .empty-state i {
                font-size: 4rem;
                margin-bottom: 20px;
            }
        }
        
        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        @media (min-width: 768px) {
            .empty-state h3 {
                font-size: 1.5rem;
            }
        }
        
        .upload-container {
            display: none;
        }
        
        .back-to-dashboard {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .back-to-dashboard {
                width: auto;
                padding: 10px 20px;
                justify-content: flex-start;
            }
        }
        
        .back-to-dashboard:hover, .back-to-dashboard:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        footer {
            text-align: center;
            padding: 20px 10px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
            width: 100%;
        }
        
        .step-counter {
            display: inline-block;
            background: #4bcffa;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            text-align: center;
            line-height: 22px;
            font-size: 0.75rem;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .step-counter {
                width: 24px;
                height: 24px;
                line-height: 24px;
                font-size: 0.8rem;
            }
        }
        
        .user-id-display {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            word-break: break-all;
        }
        
        /* Mobile optimizations */
        @media (max-width: 767px) {
            .hide-on-mobile {
                display: none !important;
            }
            
            .mobile-full-width {
                width: 100% !important;
            }
            
            .mobile-stack {
                flex-direction: column !important;
            }
        }
        
        /* Prevent text size adjustment on orientation change */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Improve touch scrolling */
        .modal-content, #stepChecks {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Loading animation for better UX */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #4bcffa;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Swipe gestures support */
        @media (hover: none) and (pointer: coarse) {
            .script-card {
                cursor: pointer;
            }
            
            .btn, .upload-btn, .action-btn {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Toast styles */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            animation: fadeInOut 3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        /* Like/Dislike Animation */
        .like-btn .count, .dislike-btn .count {
            transition: transform 0.3s ease;
        }
        
        .like-btn.liked .count, .dislike-btn.disliked .count {
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Disabled state for rapid clicking */
        .like-btn:disabled, .dislike-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Logout Button */
        .logout-btn {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }
        
        /* Premium Timer Header (Desktop) */
        .premium-timer-header {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,215,0,0.15);
            padding: 5px 15px;
            border-radius: 30px;
            border: 1px solid rgba(255,215,0,0.3);
            margin-left: 15px;
            font-size: 0.9rem;
        }
        .premium-timer-header i {
            color: #ffd700;
        }
        .premium-timer-header span {
            color: #ffd700;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- ========== MOBILE SIDEBAR (Expandable/Collapsible, NO DROPDOWN) ========== -->
    <div class="mobile-sidebar" id="mobileSidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-code" style="color: #4bcffa;"></i> VertexScripts</h3>
            <button class="close-sidebar" id="closeSidebarBtn"><i class="fas fa-times"></i></button>
        </div>
        <div class="sidebar-nav">
            <a href="#" id="sidebarDashboardBtn"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="#" id="sidebarUploadBtn"><i class="fas fa-upload"></i> Upload</a>
            <a href="#" id="sidebarChannelBtn"><i class="fas fa-user"></i> My Channel</a>
            <a href="#" id="sidebarSubscriptionsBtn"><i class="fas fa-bell"></i> Subscriptions</a>
            <a href="#" id="sidebarHashtagBtn"><i class="fas fa-hashtag"></i> Hashtag Explorer</a>
            <a href="#" class="upgrade-link" id="sidebarUpgradeBtn"><i class="fas fa-crown"></i> Upgrade to Premium</a>
            <a href="#" id="sidebarDeleteAccountBtn"><i class="fas fa-trash"></i> Delete Account</a>
            <a href="#" id="sidebarLogoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
        <div class="sidebar-premium-timer" id="sidebarPremiumTimer" style="display: none;">
            <i class="fas fa-hourglass-half"></i> Premium expires in:
            <span id="sidebarTimerDisplay">30:00</span>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Authentication Container (unchanged) -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Login</button>
                <button class="auth-tab" id="registerTab">Register</button>
            </div>
            
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" required>
                </div>
                
                <div class="auth-error" id="loginError"></div>
                
                <button type="submit" class="btn">Login</button>
            </form>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerUsername">Username</label>
                    <input type="text" id="registerUsername" placeholder="Choose username" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Choose password" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm password" required>
                </div>
                
                <div class="auth-error" id="registerError"></div>
                
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>
    
    <!-- Main Application Container -->
    <div id="appContainer" style="display: none;">
        <!-- PC Enhanced Header (unchanged) -->
        <div class="pc-enhanced-header">
            <div class="pc-header-left">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <h1>VertexScripts</h1>
                </div>
                
                <div class="pc-nav">
                    <button class="pc-nav-btn active" id="pcDashboardBtn">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="pc-nav-btn" id="pcUploadBtn">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                    <button class="pc-nav-btn" id="pcChannelBtn">
                        <i class="fas fa-user"></i> My Channel
                    </button>
                    <button class="pc-nav-btn" id="pcSubscriptionsBtn">
                        <i class="fas fa-bell"></i> Subscriptions
                    </button>
                    <button class="pc-nav-btn" id="pcHashtagExplorerBtn">
                        <i class="fas fa-hashtag"></i> Hashtags
                    </button>
                </div>
            </div>
            
            <div class="pc-header-right">
                <div class="advanced-search">
                    <input type="text" class="search-input" id="pcSearchInput" placeholder="Search scripts, hashtags, users...">
                    <i class="fas fa-search search-icon"></i>
                    <div class="search-suggestions" id="searchSuggestions"></div>
                </div>
                
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <i class="fas fa-user-circle"></i>
                        <span id="pcUsernameDisplay"></span>
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" id="pcViewChannelBtn">
                            <i class="fas fa-user"></i> My Channel
                        </a>
                        <a href="#" id="pcSubscriptionsBtn2">
                            <i class="fas fa-bell"></i> Subscriptions
                        </a>
                        <a href="#" class="upgrade-link" id="pcUpgradeBtn">
                            <i class="fas fa-crown"></i> Upgrade to Premium
                        </a>
                        <a href="#" id="pcDeleteAccountBtn">
                            <i class="fas fa-trash"></i> Delete Account
                        </a>
                        <a href="#" id="pcLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
                <!-- Premium Timer for Desktop -->
                <div id="pcPremiumTimerContainer" style="display: none;" class="premium-timer-header">
                    <i class="fas fa-crown"></i> Premium: <span id="pcTimerDisplay">30:00</span>
                </div>
            </div>
        </div>
        
        <!-- Mobile Header (modified to use SIDEBAR, no dropdown) -->
        <header class="mobile-only">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <h1>VertexScripts</h1>
                </div>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="user-info">
                    <span id="currentUserDisplay"></span>
                    <!-- No dropdown button, just display username with badge -->
                    <span id="usernameDisplay"></span>
                </div>
            </div>
            
            <!-- Original mobile dropdown completely removed; sidebar replaces it -->
            
            <div class="header-controls">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search scripts...">
                </div>
                <button class="upload-btn" id="showUploadBtn">
                    <i class="fas fa-upload"></i> Upload Script
                </button>
                <div class="credit">VertexScripts</div>
            </div>
        </header>
        
        <div class="container">
            <main class="main-content">
                <!-- Hashtag Explorer -->
                <section id="hashtagExplorer" class="card hashtag-explorer">
                    <div class="hashtag-header">
                        <h2><i class="fas fa-hashtag"></i> Hashtag Explorer</h2>
                        <button class="back-to-dashboard" id="backToDashboardFromHashtag">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </button>
                    </div>
                    <p>Discover scripts by hashtags. Click any hashtag to see all scripts using it.</p>
                    
                    <div id="hashtagList" class="hashtag-grid">
                        <!-- Hashtags will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Channel View Section -->
                <section id="channelContainer" class="card channel-container">
                    <button class="back-to-dashboard" id="backToDashboardFromChannel">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <div class="channel-header">
                        <h2><i class="fas fa-user"></i> My Channel</h2>
                        <p>Welcome to your channel, <span id="channelUsername"></span>!</p>
                        
                        <div class="channel-stats">
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelSubscribers">0</div>
                                <div class="channel-stat-label">Subscribers</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelTotalLikes">0</div>
                                <div class="channel-stat-label">Total Likes</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelTotalViews">0</div>
                                <div class="channel-stat-label">Total Views</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelScriptsCount">0</div>
                                <div class="channel-stat-label">Scripts</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-code"></i> My Scripts</h3>
                    
                    <div id="channelScriptsList" class="channel-scripts-grid">
                        <!-- User's scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Subscriptions Section -->
                <section id="subscriptionsContainer" class="card subscriptions-container">
                    <button class="back-to-dashboard" id="backToDashboardFromSubs">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <h2><i class="fas fa-bell"></i> Subscriptions</h2>
                    <p>Latest scripts from creators you follow</p>
                    
                    <div id="subscriptionsList" class="subscriptions-grid">
                        <!-- Subscription scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Dashboard Section -->
                <section id="dashboardContainer" class="card">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            <h2><i class="fas fa-tachometer-alt"></i> Script Dashboard</h2>
                        </div>
                        <div class="dashboard-stats">
                            <div class="stat">
                                <div class="stat-number" id="totalScripts">0</div>
                                <div class="stat-label">Total Scripts</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="myScripts">0</div>
                                <div class="stat-label">My Scripts</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="totalHashtags">0</div>
                                <div class="stat-label">Hashtags</div>
                            </div>
                        </div>
                    </div>
                    <p>Browse and manage all available scripts</p>
                    
                    <div id="scriptsList" class="scripts-grid">
                        <!-- Scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Upload Script Section -->
                <section id="uploadContainer" class="card upload-container">
                    <button class="back-to-dashboard" id="backToDashboardBtn">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <h2><i class="fas fa-upload"></i> Upload New Script</h2>
                    <form id="uploadForm">
                        <div class="form-group">
                            <label for="scriptName">Script Name</label>
                            <input type="text" id="scriptName" placeholder="Enter script name" required>
                        </div>
                        
                        <div class="form-group description-container">
                            <label for="scriptDescription">Description (Max 100 words)</label>
                            <textarea id="scriptDescription" placeholder="Describe your script... Include hashtags like #awesome #script" maxlength="500"></textarea>
                            <div class="word-counter">
                                <span id="wordCount">0</span>/100 words
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Script Thumbnail</label>
                            <div class="upload-options">
                                <button type="button" class="upload-option-btn active" id="thumbnailOptionBtn">
                                    <i class="fas fa-image"></i>
                                    <span>Upload Image</span>
                                </button>
                                <button type="button" class="upload-option-btn" id="youtubeOptionBtn">
                                    <i class="fab fa-youtube"></i>
                                    <span>YouTube Video</span>
                                </button>
                            </div>
                            
                            <!-- Image Upload Option -->
                            <div id="thumbnailUploadSection" class="thumbnail-section">
                                <div class="file-upload">
                                    <label for="thumbnailInput" class="file-upload-label">
                                        <i class="fas fa-image"></i>
                                        <span id="fileLabelText">Click to upload thumbnail image</span>
                                    </label>
                                    <input type="file" id="thumbnailInput" accept="image/*">
                                </div>
                                <div class="thumbnail-preview" id="thumbnailPreview">
                                    <img id="previewImage" src="" alt="Thumbnail Preview">
                                </div>
                            </div>
                            
                            <!-- YouTube Option -->
                            <div id="youtubeUploadSection" class="youtube-section" style="display: none;">
                                <input type="text" id="youtubeLink" placeholder="Enter YouTube video URL (e.g., https://youtube.com/watch?v=...)">
                                <div class="youtube-preview" id="youtubePreview">
                                    <!-- YouTube preview will be shown here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="scriptLink">Script Download Link</label>
                            <input type="text" id="scriptLink" placeholder="https://example.com/script.zip" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Required Hashtags</label>
                            <div class="hashtag-container">
                                <span class="hashtag required" data-tag="vertex">#vertex</span>
                                <span class="hashtag required" data-tag="roblox">#roblox</span>
                                <span class="hashtag required" data-tag="scripts">#scripts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Additional Hashtags (Optional)</label>
                            <input type="text" id="additionalHashtags" placeholder="#awesome #free #game (separate with space)">
                            <small style="opacity: 0.7;">Add custom hashtags to help users discover your script</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Unlock Steps (Users must complete these before accessing your script)</label>
                            <div id="stepsContainer">
                                <!-- Vertex step is added by default and cannot be removed -->
                            </div>
                            
                            <!-- Step Limit Alert -->
                            <div class="step-limit-alert" id="stepLimitAlert">
                                <i class="fas fa-exclamation-circle"></i>
                                <p>You can only add up to 4 steps in the free version. <strong>Upgrade to Premium</strong> to add up to 12 steps!</p>
                                <button class="btn btn-premium" id="upgradeFromLimitBtn" style="padding: 8px 15px; font-size: 0.9rem;">
                                    <i class="fas fa-crown"></i> Upgrade Now
                                </button>
                            </div>
                            
                            <div class="button-group">
                                <button type="button" id="addStepBtn" class="btn btn-secondary">
                                    <i class="fas fa-plus"></i> Add Step
                                </button>
                                <button type="button" id="addYoutubeStepBtn" class="btn btn-secondary">
                                    <i class="fab fa-youtube"></i> Add YouTube Step
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn mobile-full-width">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Script
                        </button>
                    </form>
                </section>
            </main>
            
            <!-- Upgrade Modal (2-AD SEQUENCE, NEW VIDEOS) -->
            <div id="upgradeModal" class="modal upgrade-modal">
                <div class="upgrade-content">
                    <div class="upgrade-header">
                        <h3><i class="fas fa-crown"></i> Upgrade to Premium</h3>
                        <button class="close-upgrade" id="closeUpgradeBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="upgrade-body">
                        <p>Watch <strong>BOTH videos</strong> completely to unlock 30 minutes of Premium!</p>
                        <p><span id="adSequenceIndicator">Ad 1/2</span> - <span id="adRemainingInfo">60s remaining</span></p>
                        
                        <div class="video-ad-container half-screen" id="videoAdContainer">
                            <div class="ad-timer-overlay" id="adTimerOverlay">
                                <i class="fas fa-clock"></i>
                                <span id="adTimer">60</span> seconds remaining
                            </div>
                            <iframe 
                                class="ad-iframe" 
                                id="videoAdIframe"
                                src="https://www.youtube.com/embed/tLEtT4ye8wY?si=AlspjiVNVPB5MfxJ&autoplay=1&controls=0&modestbranding=1&rel=0&enablejsapi=1" 
                                title="Ad 1"
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div class="upgrade-features">
                            <div class="upgrade-feature">
                                <i class="fas fa-infinity"></i>
                                <h4>12 Steps</h4>
                                <p>Add up to 12 unlock steps to your scripts</p>
                            </div>
                            <div class="upgrade-feature">
                                <i class="fas fa-chart-line"></i>
                                <h4>Advanced Analytics</h4>
                                <p>Get detailed insights into your script performance</p>
                            </div>
                            <div class="upgrade-feature">
                                <i class="fas fa-star"></i>
                                <h4>Premium Badge</h4>
                                <p>Show a premium badge on your profile and scripts</p>
                            </div>
                            <div class="upgrade-feature">
                                <i class="fas fa-bolt"></i>
                                <h4>Priority Support</h4>
                                <p>Get faster responses from our support team</p>
                            </div>
                        </div>
                        
                        <div class="upgrade-actions">
                            <button class="btn btn-premium" id="completeUpgradeBtn" disabled>
                                <i class="fas fa-crown"></i> Complete Upgrade (Watch both ads)
                            </button>
                            <button class="btn btn-secondary" id="cancelUpgradeBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Unlock Modal -->
            <div id="unlockModal" class="modal">
                <div class="modal-content">
                    <h3>Unlock Script: <span id="unlockScriptName"></span></h3>
                    <p>Complete all steps to unlock the script</p>
                    
                    <div id="stepChecks">
                        <!-- Step checks will be dynamically added here -->
                    </div>
                    
                    <div class="progress-bar">
                        <div id="progress" class="progress"></div>
                    </div>
                    
                    <div class="timer" id="timer">20</div>
                    
                    <button id="accessLinkBtn" class="btn unlock-btn" disabled>
                        <i class="fas fa-lock"></i> Unlocking... Please wait
                    </button>
                    
                    <button id="cancelBtn" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Script View Modal -->
            <div id="scriptViewModal" class="modal script-view-modal">
                <div class="script-view-content enhanced-view-modal">
                    <div class="script-view-header">
                        <h3 id="viewScriptName"></h3>
                        <button class="close-view" id="closeScriptView">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="enhanced-view-content">
                        <div class="enhanced-video-section">
                            <div id="videoContent">
                                <!-- Video content will be dynamically added here -->
                            </div>
                            
                            <div class="watch-options" id="watchOptions" style="display: none;">
                                <button class="watch-option-btn watch-here-btn active" id="watchHereBtn">
                                    <i class="fas fa-play-circle"></i> Watch Here
                                </button>
                                <button class="watch-option-btn" id="watchYouTubeBtn">
                                    <i class="fab fa-youtube"></i> Watch on YouTube
                                </button>
                            </div>
                            
                            <div class="enhanced-description" id="viewScriptDescription">
                                <!-- Description will be dynamically added here -->
                            </div>
                            
                            <div class="hashtag-container" id="viewHashtags">
                                <!-- Hashtags will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div class="enhanced-info-section">
                            <div class="script-details">
                                <div class="script-uploader">
                                    <i class="fas fa-user"></i>
                                    <span id="viewScriptAuthor"></span>
                                    <span id="viewScriptDate"></span>
                                </div>
                            </div>
                            
                            <div class="enhanced-stats">
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewLikeCount">0</span>
                                    <span class="enhanced-stat-label">Likes</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewDislikeCount">0</span>
                                    <span class="enhanced-stat-label">Dislikes</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewViewCount">0</span>
                                    <span class="enhanced-stat-label">Views</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewStepsCount">0</span>
                                    <span class="enhanced-stat-label">Steps</span>
                                </div>
                            </div>
                            
                            <div class="script-view-stats">
                                <div class="stat-item">
                                    <button class="like-btn" id="viewLikeBtn">
                                        <i class="fas fa-thumbs-up"></i>
                                        <span class="count" id="viewLikeCountText">0</span>
                                    </button>
                                </div>
                                <div class="stat-item">
                                    <button class="dislike-btn" id="viewDislikeBtn">
                                        <i class="fas fa-thumbs-down"></i>
                                        <span class="count" id="viewDislikeCountText">0</span>
                                    </button>
                                </div>
                                <button class="subscribe-btn" id="viewSubscribeBtn">
                                    <i class="fas fa-bell"></i>
                                    <span id="subscribeText">Subscribe</span>
                                </button>
                            </div>
                            
                            <button class="btn" id="viewUnlockBtn">
                                <i class="fas fa-unlock-alt"></i> Unlock Script
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Delete Confirmation Modal -->
            <div id="deleteModal" class="modal">
                <div class="modal-content">
                    <h3><i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i> Confirm Delete</h3>
                    <p id="deleteMessage">Are you sure you want to delete this script? This action cannot be undone.</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 25px;">
                        <button id="confirmDeleteBtn" class="btn btn-danger mobile-full-width">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button id="cancelDeleteBtn" class="btn btn-secondary mobile-full-width">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Delete Account Modal -->
            <div id="deleteAccountModal" class="modal">
                <div class="modal-content">
                    <h3><i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i> Delete Account</h3>
                    <p>This will permanently delete your account, all your uploaded scripts, subscriptions, likes, and everything associated with your account. This action cannot be undone!</p>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="confirmUsername">Type your username to confirm</label>
                        <input type="text" id="confirmUsername" placeholder="Enter your username">
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 25px;">
                        <button id="confirmAccountDeleteBtn" class="btn btn-danger mobile-full-width">
                            <i class="fas fa-trash"></i> Permanently Delete Account
                        </button>
                        <button id="cancelAccountDeleteBtn" class="btn btn-secondary mobile-full-width">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <footer>
                <p>VertexScripts Dashboard &copy; 2023 | All scripts are property of their respective owners</p>
            </footer>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your Firebase configuration (unchanged)
        const firebaseConfig = {
            apiKey: "AIzaSyB4aVpNW6SKbj26fExI65voT84D2k_MvwQ",
            authDomain: "vertexscripts-4f108.firebaseapp.com",
            projectId: "vertexscripts-4f108",
            storageBucket: "vertexscripts-4f108.firebasestorage.app",
            messagingSenderId: "315039481759",
            appId: "1:315039481759:web:c52b2887332bc5a41307aa"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ========== ENHANCED VERTEXSTORAGE WITH PREMIUM TIMER & OWNER PRIORITY ==========
        class VertexStorage {
            constructor() {
                this.auth = auth;
                this.db = db;
                this.currentUser = null;
                this.premiumExpiry = null; // timestamp when premium expires
                this.premiumTimerInterval = null;
                
                onAuthStateChanged(this.auth, async (user) => {
                    if (user) {
                        this.currentUser = user;
                        const username = user.email.split('@')[0];
                        this.currentUser.username = username;
                        
                        try {
                            const userDoc = await getDoc(doc(this.db, "users", username));
                            if (userDoc.exists()) {
                                this.currentUser.isAdmin = userDoc.data().isAdmin || false;
                                this.currentUser.isPremium = userDoc.data().isPremium || false;
                                // Load premium expiry if exists
                                if (userDoc.data().premiumExpiry) {
                                    this.premiumExpiry = userDoc.data().premiumExpiry.toDate ? 
                                        userDoc.data().premiumExpiry.toDate() : new Date(userDoc.data().premiumExpiry);
                                } else {
                                    this.premiumExpiry = null;
                                }
                            } else {
                                this.currentUser.isAdmin = false;
                                this.currentUser.isPremium = false;
                                this.premiumExpiry = null;
                            }
                            
                            // SPECIAL: plstealme2 gets auto premium and owner badge
                            if (username === 'plstealme2') {
                                this.currentUser.isAdmin = true; // already admin
                                // Auto premium for 30 minutes on each login
                                await this.grantPremium30Min(username);
                            }
                        } catch (error) {
                            console.error("Error getting user data:", error);
                            this.currentUser.isAdmin = false;
                            this.currentUser.isPremium = false;
                        }
                        
                        if (window.appInitialized) {
                            showApp();
                        }
                    } else {
                        this.currentUser = null;
                        this.premiumExpiry = null;
                        if (window.premiumTimerInterval) clearInterval(window.premiumTimerInterval);
                        if (window.appInitialized) {
                            showAuth();
                        }
                    }
                });
            }
            
            // Grant 30 minutes premium (called after ad watch or auto for plstealme2)
            async grantPremium30Min(username) {
                try {
                    const expiry = new Date(Date.now() + 30 * 60 * 1000); // 30 minutes
                    await updateDoc(doc(this.db, "users", username), {
                        isPremium: true,
                        premiumSince: serverTimestamp(),
                        premiumExpiry: expiry,
                        updatedAt: serverTimestamp()
                    });
                    if (this.currentUser && this.currentUser.username === username) {
                        this.currentUser.isPremium = true;
                        this.premiumExpiry = expiry;
                    }
                    return { success: true, expiry };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Check and expire premium if time passed
            async checkPremiumExpiry(username) {
                try {
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        const data = userDoc.data();
                        if (data.isPremium && data.premiumExpiry) {
                            const expiry = data.premiumExpiry.toDate ? data.premiumExpiry.toDate() : new Date(data.premiumExpiry);
                            if (new Date() > expiry) {
                                // Premium expired: remove tag but KEEP steps (do NOT modify scripts)
                                await updateDoc(doc(this.db, "users", username), {
                                    isPremium: false,
                                    premiumExpiry: null
                                });
                                if (this.currentUser && this.currentUser.username === username) {
                                    this.currentUser.isPremium = false;
                                    this.premiumExpiry = null;
                                }
                                return false;
                            } else {
                                if (this.currentUser && this.currentUser.username === username) {
                                    this.currentUser.isPremium = true;
                                    this.premiumExpiry = expiry;
                                }
                                return true;
                            }
                        }
                    }
                    return false;
                } catch (error) {
                    return false;
                }
            }
            
            // Override upgradeToPremium to grant 30min
            async upgradeToPremium(username) {
                return this.grantPremium30Min(username);
            }
            
            // Register with premium check
            async registerUser(username, password) {
                try {
                    if (username.includes(' ')) return { success: false, error: 'Username cannot contain spaces' };
                    if (password === username) return { success: false, error: 'Password cannot be the same as username' };
                    if (password.length < 6) return { success: false, error: 'Password must be at least 6 characters' };
                    
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) return { success: false, error: 'Username already taken' };
                    
                    const email = `${username}@vertexscripts.com`;
                    const userCredential = await createUserWithEmailAndPassword(this.auth, email, password);
                    
                    await setDoc(doc(this.db, "users", username), {
                        username: username,
                        email: email,
                        createdAt: serverTimestamp(),
                        isAdmin: username === 'plstealme2',
                        isPremium: username === 'plstealme2', // auto premium for owner
                        premiumExpiry: username === 'plstealme2' ? new Date(Date.now() + 30 * 60 * 1000) : null,
                        subscribers: 0
                    });
                    
                    return { success: true, user: { username: username, isAdmin: username === 'plstealme2', isPremium: username === 'plstealme2' } };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Login
            async loginUser(username, password) {
                try {
                    const email = `${username}@vertexscripts.com`;
                    await signInWithEmailAndPassword(this.auth, email, password);
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        // Check expiry before returning
                        await this.checkPremiumExpiry(username);
                        return { 
                            success: true, 
                            user: { 
                                username: username,
                                isAdmin: userDoc.data().isAdmin || false,
                                isPremium: userDoc.data().isPremium || false
                            } 
                        };
                    }
                    return { success: true, user: { username: username, isAdmin: false, isPremium: false } };
                } catch (error) {
                    return { success: false, error: 'Invalid username or password' };
                }
            }
            
            async getCurrentUser() {
                if (!this.currentUser) return null;
                // Check expiry on every get
                await this.checkPremiumExpiry(this.currentUser.username);
                return {
                    username: this.currentUser.username,
                    isAdmin: this.currentUser.isAdmin || false,
                    isPremium: this.currentUser.isPremium || false
                };
            }
            
            async logoutUser() {
                if (this.premiumTimerInterval) clearInterval(this.premiumTimerInterval);
                await signOut(this.auth);
            }
            
            async deleteUser(username) {
                try {
                    await deleteDoc(doc(this.db, "users", username));
                    const scriptsQuery = query(collection(this.db, "scripts"), where("uploader", "==", username));
                    const scriptsSnapshot = await getDocs(scriptsQuery);
                    const deletePromises = [];
                    scriptsSnapshot.forEach((scriptDoc) => {
                        deletePromises.push(deleteDoc(doc(this.db, "scripts", scriptDoc.id)));
                    });
                    await Promise.all(deletePromises);
                    await deleteDoc(doc(this.db, "interactions", username));
                    await deleteDoc(doc(this.db, "subscriptions", username));
                    const user = this.auth.currentUser;
                    if (user) await deleteUser(user);
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Save script (unchanged but steps limit now 12 for premium)
            async saveScript(script) {
                try {
                    script.createdAt = serverTimestamp();
                    script.updatedAt = serverTimestamp();
                    script.likes = script.likes || 0;
                    script.dislikes = script.dislikes || 0;
                    script.views = script.views || 0;
                    script.uploadTimestamp = Date.now(); // for 24h owner priority
                    
                    const docRef = await addDoc(collection(this.db, "scripts"), script);
                    script.id = docRef.id;
                    await updateDoc(docRef, { id: docRef.id });
                    await this.updateHashtags(script);
                    return { success: true, script: script };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Get scripts with owner priority (plstealme2 videos first for 24h)
            async getScripts() {
                try {
                    const q = query(collection(this.db, "scripts"), orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.createdAt && data.createdAt.toDate) data.createdAt = data.createdAt.toDate();
                        if (data.uploadDateTime) data.uploadDate = new Date(data.uploadDateTime).toLocaleDateString();
                        else if (data.createdAt) data.uploadDate = new Date(data.createdAt).toLocaleDateString();
                        else data.uploadDate = "Unknown date";
                        scripts.push({ id: doc.id, ...data });
                    });
                    
                    // Owner priority: plstealme2 videos uploaded in last 24h come first
                    const now = Date.now();
                    const TWENTY_FOUR_HOURS = 24 * 60 * 60 * 1000;
                    return scripts.sort((a, b) => {
                        const aIsOwner = a.uploader === 'plstealme2';
                        const bIsOwner = b.uploader === 'plstealme2';
                        const aAge = now - (a.uploadTimestamp || 0);
                        const bAge = now - (b.uploadTimestamp || 0);
                        const aRecentOwner = aIsOwner && aAge < TWENTY_FOUR_HOURS;
                        const bRecentOwner = bIsOwner && bAge < TWENTY_FOUR_HOURS;
                        
                        if (aRecentOwner && !bRecentOwner) return -1;
                        if (!aRecentOwner && bRecentOwner) return 1;
                        // Then by score/pin etc
                        return (b.score || 0) - (a.score || 0);
                    });
                } catch (error) {
                    return [];
                }
            }
            
            async getScriptsByUser(username) {
                try {
                    const q = query(collection(this.db, "scripts"), where("uploader", "==", username), orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.createdAt && data.createdAt.toDate) data.createdAt = data.createdAt.toDate();
                        if (data.uploadDateTime) data.uploadDate = new Date(data.uploadDateTime).toLocaleDateString();
                        else if (data.createdAt) data.uploadDate = new Date(data.createdAt).toLocaleDateString();
                        scripts.push({ id: doc.id, ...data });
                    });
                    return scripts;
                } catch (error) {
                    return [];
                }
            }
            
            // Rest of methods (deleteScript, updateScript, hashtags, interactions, etc.) remain identical
            async deleteScript(scriptId) { /* ... exact same as original ... */ 
                try {
                    const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                    if (scriptDoc.exists()) {
                        const script = scriptDoc.data();
                        await this.removeScriptFromHashtags({ id: scriptId, ...script });
                    }
                    await deleteDoc(doc(this.db, "scripts", scriptId));
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            async updateScript(updatedScript) {
                try {
                    updatedScript.updatedAt = serverTimestamp();
                    const { id, ...scriptData } = updatedScript;
                    await updateDoc(doc(this.db, "scripts", id), scriptData);
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            async updateHashtags(script) { /* unchanged */ 
                if (!script.hashtags || !script.hashtags.length) return;
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    if (!hashtagDoc.exists()) {
                        await setDoc(hashtagRef, { count: 1, scripts: [script.id], createdAt: serverTimestamp() });
                    } else {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        if (!scripts.includes(script.id)) {
                            scripts.push(script.id);
                            await updateDoc(hashtagRef, { count: scripts.length, scripts: scripts, updatedAt: serverTimestamp() });
                        }
                    }
                }
            }
            async removeScriptFromHashtags(script) { /* unchanged */ 
                if (!script.hashtags || !script.hashtags.length) return;
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    if (hashtagDoc.exists()) {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        const index = scripts.indexOf(script.id);
                        if (index > -1) {
                            scripts.splice(index, 1);
                            if (scripts.length === 0) await deleteDoc(hashtagRef);
                            else await updateDoc(hashtagRef, { count: scripts.length, scripts: scripts, updatedAt: serverTimestamp() });
                        }
                    }
                }
            }
            async getHashtags() { /* unchanged */ 
                try {
                    const snapshot = await getDocs(collection(this.db, "hashtags"));
                    const hashtags = {};
                    snapshot.forEach(doc => { hashtags[doc.id] = doc.data(); });
                    return hashtags;
                } catch (error) { return {}; }
            }
            async getScriptsByHashtag(hashtag) { /* unchanged */ 
                try {
                    const hashtagDoc = await getDoc(doc(this.db, "hashtags", hashtag));
                    if (!hashtagDoc.exists()) return [];
                    const data = hashtagDoc.data();
                    const scriptIds = data.scripts || [];
                    const scripts = [];
                    for (const scriptId of scriptIds) {
                        const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                        if (scriptDoc.exists()) {
                            const scriptData = scriptDoc.data();
                            if (scriptData.createdAt && scriptData.createdAt.toDate) scriptData.createdAt = scriptData.createdAt.toDate();
                            scripts.push({ id: scriptDoc.id, ...scriptData });
                        }
                    }
                    return scripts;
                } catch (error) { return []; }
            }
            async recordInteraction(username, scriptId, type) { /* unchanged */ 
                try {
                    const interactionRef = doc(this.db, "interactions", `${username}_${scriptId}`);
                    const interactionDoc = await getDoc(interactionRef);
                    let currentState = { liked: false, disliked: false };
                    let scriptUpdate = {};
                    if (interactionDoc.exists()) {
                        currentState = interactionDoc.data();
                        if (type === 'like') {
                            if (currentState.liked) {
                                await updateDoc(interactionRef, { liked: false });
                                scriptUpdate.likes = increment(-1);
                            } else {
                                await updateDoc(interactionRef, { liked: true, disliked: false });
                                scriptUpdate.likes = increment(1);
                                if (currentState.disliked) scriptUpdate.dislikes = increment(-1);
                            }
                        } else if (type === 'dislike') {
                            if (currentState.disliked) {
                                await updateDoc(interactionRef, { disliked: false });
                                scriptUpdate.dislikes = increment(-1);
                            } else {
                                await updateDoc(interactionRef, { disliked: true, liked: false });
                                scriptUpdate.dislikes = increment(1);
                                if (currentState.liked) scriptUpdate.likes = increment(-1);
                            }
                        }
                    } else {
                        if (type === 'like') {
                            await setDoc(interactionRef, { liked: true, disliked: false });
                            scriptUpdate.likes = increment(1);
                        } else if (type === 'dislike') {
                            await setDoc(interactionRef, { liked: false, disliked: true });
                            scriptUpdate.dislikes = increment(1);
                        }
                    }
                    if (Object.keys(scriptUpdate).length > 0) {
                        await updateDoc(doc(this.db, "scripts", scriptId), scriptUpdate);
                    }
                    const updatedDoc = await getDoc(interactionRef);
                    const updatedData = updatedDoc.exists() ? updatedDoc.data() : { liked: false, disliked: false };
                    return { success: true, liked: updatedData.liked || false, disliked: updatedData.disliked || false };
                } catch (error) { return { success: false, error: error.message }; }
            }
            async getInteractionState(username, scriptId) { /* unchanged */ 
                try {
                    const interactionDoc = await getDoc(doc(this.db, "interactions", `${username}_${scriptId}`));
                    if (interactionDoc.exists()) {
                        const data = interactionDoc.data();
                        return { liked: data.liked || false, disliked: data.disliked || false };
                    }
                    return { liked: false, disliked: false };
                } catch (error) { return { liked: false, disliked: false }; }
            }
            async recordScriptView(username, scriptId) { /* unchanged */ 
                try {
                    const viewRef = doc(this.db, "views", `${scriptId}_${username}`);
                    const viewDoc = await getDoc(viewRef);
                    if (!viewDoc.exists()) {
                        await setDoc(viewRef, { username: username, scriptId: scriptId, viewedAt: serverTimestamp() });
                        await updateDoc(doc(this.db, "scripts", scriptId), { views: increment(1) });
                        return true;
                    }
                    return false;
                } catch (error) { return false; }
            }
            async subscribe(subscriber, creator) { /* unchanged */ 
                if (subscriber === creator) return false;
                try {
                    const subscriptionRef = doc(this.db, "subscriptions", `${subscriber}_${creator}`);
                    const subscriptionDoc = await getDoc(subscriptionRef);
                    if (subscriptionDoc.exists()) {
                        await deleteDoc(subscriptionRef);
                        await updateDoc(doc(this.db, "users", creator), { subscribers: increment(-1) });
                        return false;
                    } else {
                        await setDoc(subscriptionRef, { subscriber: subscriber, creator: creator, subscribedAt: serverTimestamp() });
                        await updateDoc(doc(this.db, "users", creator), { subscribers: increment(1) });
                        return true;
                    }
                } catch (error) { return false; }
            }
            async isSubscribed(subscriber, creator) { /* unchanged */ 
                try {
                    const subscriptionDoc = await getDoc(doc(this.db, "subscriptions", `${subscriber}_${creator}`));
                    return subscriptionDoc.exists();
                } catch (error) { return false; }
            }
            async getSubscriptions(username) { /* unchanged */ 
                try {
                    const q = query(collection(this.db, "subscriptions"), where("subscriber", "==", username));
                    const snapshot = await getDocs(q);
                    const subscriptions = [];
                    snapshot.forEach(doc => { subscriptions.push(doc.data().creator); });
                    return subscriptions;
                } catch (error) { return []; }
            }
            async getSubscribers(username) { /* unchanged */ 
                try {
                    const q = query(collection(this.db, "subscriptions"), where("creator", "==", username));
                    const snapshot = await getDocs(q);
                    return snapshot.size;
                } catch (error) { return 0; }
            }
            async getUserChannelStats(username) { /* unchanged */ 
                try {
                    const scripts = await this.getScriptsByUser(username);
                    let totalLikes = 0, totalDislikes = 0, totalViews = 0;
                    scripts.forEach(script => {
                        totalLikes += script.likes || 0;
                        totalDislikes += script.dislikes || 0;
                        totalViews += script.views || 0;
                    });
                    const subscribers = await this.getSubscribers(username);
                    return { scriptsCount: scripts.length, totalLikes, totalDislikes, totalViews, subscribers };
                } catch (error) { return { scriptsCount: 0, totalLikes: 0, totalDislikes: 0, totalViews: 0, subscribers: 0 }; }
            }
        }

        // ========== MAIN APPLICATION ==========
        const storage = new VertexStorage();
        let currentUser = null;
        let scripts = [];
        let nextId = 1;
        let currentUnlockScript = null;
        let currentStep = 0;
        let countdown = 20;
        let countdownInterval = null;
        let completedSteps = new Set();
        let stepTimers = {};
        let scriptToDelete = null;
        let currentViewScript = null;
        let uploadType = 'thumbnail';
        let currentWatchOption = 'watch-here';
        let activeHashtag = null;
        
        // Premium upgrade variables (2-AD SEQUENCE)
        let adSequence = 1; // 1 or 2
        let adTimers = {1: 60, 2: 202}; // seconds
        let currentAdTimer = 60;
        let adTimerInterval = null;
        let videoCompleted = false;
        let videoClosed = false;
        let ad2Ready = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            window.appInitialized = true;
            setupEventListeners();
            setTimeout(async () => {
                currentUser = await storage.getCurrentUser();
                if (currentUser) showApp(); else showAuth();
                await loadScripts();
                updateStats();
            }, 1000);
        });

        function setupEventListeners() {
            // Auth
            document.getElementById('loginTab').addEventListener('click', () => switchAuthTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchAuthTab('register'));
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Upload
            document.getElementById('thumbnailOptionBtn').addEventListener('click', () => switchUploadType('thumbnail'));
            document.getElementById('youtubeOptionBtn').addEventListener('click', () => switchUploadType('youtube'));
            document.getElementById('youtubeLink').addEventListener('input', handleYoutubeLink);
            document.getElementById('scriptDescription').addEventListener('input', updateWordCount);
            document.getElementById('uploadForm').addEventListener('submit', uploadScript);
            document.getElementById('addStepBtn').addEventListener('click', addStep);
            document.getElementById('addYoutubeStepBtn').addEventListener('click', addYouTubeStep);
            document.getElementById('thumbnailInput').addEventListener('change', handleThumbnailPreview);
            document.getElementById('cancelBtn').addEventListener('click', closeUnlockModal);
            document.getElementById('accessLinkBtn').addEventListener('click', accessScriptLink);
            document.getElementById('showUploadBtn').addEventListener('click', showUploadForm);
            document.getElementById('backToDashboardBtn').addEventListener('click', showDashboard);
            document.getElementById('searchInput').addEventListener('input', filterScripts);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteScript);
            document.getElementById('cancelDeleteBtn').addEventListener('click', cancelDelete);
            document.getElementById('confirmAccountDeleteBtn').addEventListener('click', confirmAccountDelete);
            document.getElementById('cancelAccountDeleteBtn').addEventListener('click', cancelAccountDelete);
            document.getElementById('viewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('mobileViewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('subscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('mobileSubscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('backToDashboardFromSubs').addEventListener('click', showDashboard);
            document.getElementById('backToDashboardFromChannel').addEventListener('click', showDashboard);
            document.getElementById('deleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('mobileDeleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleSidebar); // SIDEBAR
            document.getElementById('closeSidebarBtn').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleSidebar);
            document.getElementById('closeScriptView').addEventListener('click', closeScriptView);
            document.getElementById('viewUnlockBtn').addEventListener('click', unlockFromView);
            
            // PC nav
            document.getElementById('pcDashboardBtn').addEventListener('click', showDashboard);
            document.getElementById('pcUploadBtn').addEventListener('click', showUploadForm);
            document.getElementById('pcChannelBtn').addEventListener('click', showChannel);
            document.getElementById('pcSubscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('pcViewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('pcSubscriptionsBtn2').addEventListener('click', showSubscriptions);
            document.getElementById('pcDeleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('pcLogoutBtn').addEventListener('click', logout);
            document.getElementById('pcHashtagExplorerBtn').addEventListener('click', showHashtagExplorer);
            document.getElementById('mobileHashtagExplorerBtn').addEventListener('click', showHashtagExplorer);
            document.getElementById('backToDashboardFromHashtag').addEventListener('click', showDashboard);
            
            // Upgrade
            document.getElementById('pcUpgradeBtn').addEventListener('click', showUpgradeModal);
            document.getElementById('mobileUpgradeBtn').addEventListener('click', showUpgradeModal);
            document.getElementById('mobileDropdownUpgradeBtn').addEventListener('click', showUpgradeModal);
            document.getElementById('upgradeFromLimitBtn').addEventListener('click', showUpgradeModal);
            document.getElementById('closeUpgradeBtn').addEventListener('click', closeUpgradeModal);
            document.getElementById('cancelUpgradeBtn').addEventListener('click', closeUpgradeModal);
            document.getElementById('completeUpgradeBtn').addEventListener('click', completeUpgrade);
            
            // Sidebar navigation
            document.getElementById('sidebarDashboardBtn').addEventListener('click', (e) => { e.preventDefault(); showDashboard(); toggleSidebar(); });
            document.getElementById('sidebarUploadBtn').addEventListener('click', (e) => { e.preventDefault(); showUploadForm(); toggleSidebar(); });
            document.getElementById('sidebarChannelBtn').addEventListener('click', (e) => { e.preventDefault(); showChannel(); toggleSidebar(); });
            document.getElementById('sidebarSubscriptionsBtn').addEventListener('click', (e) => { e.preventDefault(); showSubscriptions(); toggleSidebar(); });
            document.getElementById('sidebarHashtagBtn').addEventListener('click', (e) => { e.preventDefault(); showHashtagExplorer(); toggleSidebar(); });
            document.getElementById('sidebarUpgradeBtn').addEventListener('click', (e) => { e.preventDefault(); showUpgradeModal(); toggleSidebar(); });
            document.getElementById('sidebarDeleteAccountBtn').addEventListener('click', (e) => { e.preventDefault(); showDeleteAccountModal(); toggleSidebar(); });
            document.getElementById('sidebarLogoutBtn').addEventListener('click', (e) => { e.preventDefault(); logout(); toggleSidebar(); });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('mobileLogoutBtn').addEventListener('click', logout);
            
            // PC search
            document.getElementById('pcSearchInput').addEventListener('input', handleAdvancedSearch);
            document.getElementById('pcSearchInput').addEventListener('focus', showSearchSuggestions);
            document.getElementById('pcSearchInput').addEventListener('blur', () => setTimeout(hideSearchSuggestions, 200));
            
            // Watch options
            document.getElementById('watchHereBtn').addEventListener('click', () => switchWatchOption('watch-here'));
            document.getElementById('watchYouTubeBtn').addEventListener('click', () => switchWatchOption('watch-youtube'));
            
            // Like/dislike
            document.getElementById('viewLikeBtn').addEventListener('click', handleLike);
            document.getElementById('viewDislikeBtn').addEventListener('click', handleDislike);
            document.getElementById('viewSubscribeBtn').addEventListener('click', handleSubscribe);
            
            window.addEventListener('orientationchange', () => setTimeout(handleResize, 100));
            window.addEventListener('resize', debounce(handleResize, 250));
            window.addEventListener('click', closeAllDropdowns);
            
            document.querySelectorAll('.dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdown = this.closest('.dropdown');
                    const content = dropdown.querySelector('.dropdown-content');
                    document.querySelectorAll('.dropdown-content').forEach(d => { if (d !== content) d.parentElement.classList.remove('active'); });
                    dropdown.classList.toggle('active');
                });
            });
            
            addVertexStep();
            handleResize();
            updateWordCount();
        }

        // ========== SIDEBAR TOGGLE (replaces dropdown) ==========
        function toggleSidebar() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
        }

        // ========== 2-AD SEQUENCE ==========
        function showUpgradeModal() {
            adSequence = 1;
            currentAdTimer = 60;
            videoCompleted = false;
            videoClosed = false;
            ad2Ready = false;
            
            document.getElementById('adTimer').textContent = currentAdTimer;
            document.getElementById('adSequenceIndicator').textContent = 'Ad 1/2';
            document.getElementById('adRemainingInfo').textContent = '60s remaining';
            document.getElementById('adTimerOverlay').classList.remove('warning');
            document.getElementById('completeUpgradeBtn').disabled = true;
            document.getElementById('completeUpgradeBtn').innerHTML = '<i class="fas fa-crown"></i> Complete Upgrade (Watch both ads)';
            
            // Set first video
            document.getElementById('videoAdIframe').src = 'https://www.youtube.com/embed/tLEtT4ye8wY?si=AlspjiVNVPB5MfxJ&autoplay=1&controls=0&modestbranding=1&rel=0&enablejsapi=1';
            
            document.getElementById('upgradeModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            startVideoAdCheck();
            closeAllDropdowns();
            toggleSidebar(); // close sidebar if open
        }

        function startVideoAdCheck() {
            if (adTimerInterval) clearInterval(adTimerInterval);
            
            adTimerInterval = setInterval(() => {
                if (currentAdTimer > 0) {
                    currentAdTimer--;
                    document.getElementById('adTimer').textContent = currentAdTimer;
                    document.getElementById('adRemainingInfo').textContent = currentAdTimer + 's remaining';
                    if (currentAdTimer <= 10) document.getElementById('adTimerOverlay').classList.add('warning');
                } else {
                    // Current ad finished
                    if (adSequence === 1) {
                        // Load second ad
                        adSequence = 2;
                        currentAdTimer = 202; // 3:22
                        document.getElementById('adTimer').textContent = currentAdTimer;
                        document.getElementById('adSequenceIndicator').textContent = 'Ad 2/2';
                        document.getElementById('adRemainingInfo').textContent = '202s remaining';
                        document.getElementById('adTimerOverlay').classList.remove('warning');
                        document.getElementById('videoAdIframe').src = 'https://www.youtube.com/embed/Wxe5hRjjSXw?autoplay=1&controls=0&modestbranding=1&rel=0&enablejsapi=1&start=27';
                        // Reset timer for second ad
                    } else {
                        // Both ads done
                        clearInterval(adTimerInterval);
                        videoCompleted = true;
                        document.getElementById('completeUpgradeBtn').disabled = false;
                        document.getElementById('completeUpgradeBtn').innerHTML = '<i class="fas fa-crown"></i> Complete Upgrade Now!';
                        document.getElementById('adTimerOverlay').style.display = 'none';
                    }
                }
            }, 1000);
            
            const upgradeModal = document.getElementById('upgradeModal');
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        if (upgradeModal.style.display === 'none' && !videoCompleted) {
                            videoClosed = true;
                            clearInterval(adTimerInterval);
                            showToast('Upgrade cancelled. Please watch both ads to upgrade.');
                        }
                    }
                });
            });
            observer.observe(upgradeModal, { attributes: true });
        }

        function closeUpgradeModal() {
            if (!videoCompleted && !videoClosed) {
                videoClosed = true;
                clearInterval(adTimerInterval);
                showToast('Upgrade cancelled. Please watch both ads to upgrade.');
            }
            document.getElementById('upgradeModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        async function completeUpgrade() {
            if (!videoCompleted) { showToast('Please watch both ads first!'); return; }
            if (!currentUser) { showToast('Please log in to upgrade'); return; }
            
            const upgradeBtn = document.getElementById('completeUpgradeBtn');
            upgradeBtn.disabled = true;
            upgradeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Upgrading...';
            
            const result = await storage.grantPremium30Min(currentUser.username);
            if (result.success) {
                currentUser.isPremium = true;
                closeUpgradeModal();
                showToast(' 30 minutes Premium activated!');
                updatePremiumUI();
                startPremiumTimer();
                document.getElementById('stepLimitAlert').style.display = 'none';
                if (document.getElementById('uploadContainer').style.display === 'block') checkStepLimit();
            } else {
                showToast(`Upgrade failed: ${result.error}`);
                upgradeBtn.disabled = false;
                upgradeBtn.innerHTML = '<i class="fas fa-crown"></i> Complete Upgrade Now!';
            }
        }

        // ========== PREMIUM TIMER ==========
        function startPremiumTimer() {
            if (storage.premiumTimerInterval) clearInterval(storage.premiumTimerInterval);
            storage.premiumTimerInterval = setInterval(async () => {
                if (currentUser && currentUser.isPremium && storage.premiumExpiry) {
                    const now = new Date();
                    const expiry = storage.premiumExpiry;
                    const diff = expiry - now;
                    if (diff <= 0) {
                        // Expired
                        await storage.checkPremiumExpiry(currentUser.username);
                        currentUser.isPremium = false;
                        storage.premiumExpiry = null;
                        updatePremiumUI();
                        showToast('Your 30-minute Premium session has ended.');
                        clearInterval(storage.premiumTimerInterval);
                    } else {
                        // Update timers
                        const minutes = Math.floor(diff / 60000);
                        const seconds = Math.floor((diff % 60000) / 1000);
                        const timeStr = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                        if (document.getElementById('pcTimerDisplay')) document.getElementById('pcTimerDisplay').textContent = timeStr;
                        if (document.getElementById('sidebarTimerDisplay')) document.getElementById('sidebarTimerDisplay').textContent = timeStr;
                    }
                } else {
                    clearInterval(storage.premiumTimerInterval);
                }
            }, 1000);
        }

        function updatePremiumUI() {
            const premiumBadge = '<span class="premium-badge">PREMIUM</span>';
            const ownerBadge = currentUser && currentUser.username === 'plstealme2' ? '<span class="owner-badge"><i class="fas fa-crown"></i> OWNER</span>' : '';
            
            document.getElementById('pcUsernameDisplay').innerHTML = currentUser ? currentUser.username + ' ' + premiumBadge + ownerBadge : '';
            document.getElementById('usernameDisplay').innerHTML = currentUser ? currentUser.username + ' ' + premiumBadge + ownerBadge : '';
            document.getElementById('currentUserDisplay').innerHTML = currentUser ? `Welcome, ${currentUser.username} ${premiumBadge}${ownerBadge}` : '';
            
            // Show/hide premium timer
            if (currentUser && currentUser.isPremium) {
                document.getElementById('pcPremiumTimerContainer').style.display = 'flex';
                document.getElementById('sidebarPremiumTimer').style.display = 'block';
                startPremiumTimer();
            } else {
                document.getElementById('pcPremiumTimerContainer').style.display = 'none';
                document.getElementById('sidebarPremiumTimer').style.display = 'none';
            }
            
            document.querySelectorAll('.upgrade-link').forEach(link => {
                if (currentUser && currentUser.isPremium) {
                    link.innerHTML = '<i class="fas fa-crown" style="color: #ffd700;"></i> Premium Active';
                    link.style.color = '#ffd700';
                    link.style.cursor = 'default';
                    link.onclick = (e) => { e.preventDefault(); showToast('You already have Premium!'); };
                } else {
                    link.innerHTML = '<i class="fas fa-crown"></i> Upgrade to Premium';
                    link.style.color = '#ffd700';
                    link.onclick = (e) => { e.preventDefault(); showUpgradeModal(); };
                }
            });
        }

        // ========== STEP LIMIT (12 for premium, 4 for free) ==========
        function checkStepLimit() {
            const stepsContainer = document.getElementById('stepsContainer');
            const stepCount = stepsContainer.querySelectorAll('.step-container').length;
            const stepLimitAlert = document.getElementById('stepLimitAlert');
            
            if (currentUser && currentUser.isPremium) {
                // Premium: max 12 steps
                if (stepCount >= 12) {
                    stepLimitAlert.style.display = 'flex';
                    stepLimitAlert.querySelector('p').innerHTML = 'You have reached the maximum of 12 steps.';
                    document.getElementById('addStepBtn').disabled = true;
                    document.getElementById('addYoutubeStepBtn').disabled = true;
                    return false;
                } else {
                    stepLimitAlert.style.display = 'none';
                    document.getElementById('addStepBtn').disabled = false;
                    document.getElementById('addYoutubeStepBtn').disabled = false;
                    return true;
                }
            } else {
                // Free: max 4 steps
                if (stepCount >= 4) {
                    stepLimitAlert.style.display = 'flex';
                    stepLimitAlert.querySelector('p').innerHTML = 'You can only add up to 4 steps in the free version. <strong>Upgrade to Premium</strong> to add up to 12 steps!';
                    document.getElementById('addStepBtn').disabled = true;
                    document.getElementById('addYoutubeStepBtn').disabled = true;
                    return false;
                } else {
                    stepLimitAlert.style.display = 'none';
                    document.getElementById('addStepBtn').disabled = false;
                    document.getElementById('addYoutubeStepBtn').disabled = false;
                    return true;
            }
        }
        }

        function addStep() {
            if (!checkStepLimit()) { showToast('Step limit reached!'); return; }
            const stepNumber = document.querySelectorAll('.step-container').length;
            addCustomStep(stepNumber, "", "");
        }

        function addYouTubeStep() {
            if (!checkStepLimit()) { showToast('Step limit reached!'); return; }
            const stepNumber = document.querySelectorAll('.step-container').length;
            addCustomStep(stepNumber, "Subscribe to YouTube Channel", "https://youtube.com");
        }

        function addCustomStep(stepNumber, name, url) {
            const stepsContainer = document.getElementById('stepsContainer');
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container';
            stepContainer.setAttribute('data-step', stepNumber);
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">${stepNumber}</span>
                        <input type="text" class="step-name-input" placeholder="Step name" value="${name}" style="background: transparent; border: none; color: white; width: 200px; min-width: 150px; font-size: 14px;">
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <input type="text" class="step-url" placeholder="https://example.com" value="${url}" required>
            `;
            stepsContainer.appendChild(stepContainer);
            stepContainer.querySelector('.remove-step').addEventListener('click', function() {
                stepContainer.remove();
                updateStepNumbers();
                checkStepLimit();
            });
            const nameInput = stepContainer.querySelector('.step-name-input');
            nameInput.addEventListener('input', updateStepNumbers);
            checkStepLimit();
        }

        function addVertexStep() {
            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = ''; // clear and add
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container vertex-step';
            stepContainer.setAttribute('data-step', 1);
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">1</span>
                        <i class="fab fa-youtube"></i> Subscribe to VertexR_S (Required)
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <input type="text" class="step-url" value="https://m.youtube.com/@VertexR_S" readonly>
            `;
            stepsContainer.appendChild(stepContainer);
        }

        // ========== AUTH HANDLERS ==========
        function switchAuthTab(tab) { /* unchanged */ 
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            if (tab === 'login') {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const result = await storage.loginUser(username, password);
            if (result.success) {
                currentUser = result.user;
                showApp();
                showToast('Logged in successfully!');
                if (currentUser.isPremium) updatePremiumUI();
                if (username === 'plstealme2') {
                    // Auto premium already granted in constructor, just update UI
                    updatePremiumUI();
                }
            } else {
                document.getElementById('loginError').textContent = result.error;
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (password !== confirmPassword) {
                document.getElementById('registerError').textContent = 'Passwords do not match';
                return;
            }
            const result = await storage.registerUser(username, password);
            if (result.success) {
                currentUser = result.user;
                showApp();
                showToast('Account created successfully!');
                if (currentUser.isPremium) updatePremiumUI();
            } else {
                document.getElementById('registerError').textContent = result.error;
            }
        }

        async function logout() {
            await storage.logoutUser();
            currentUser = null;
            showAuth();
            showToast('Logged out successfully');
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        async function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            if (currentUser) {
                const displayName = currentUser.username;
                document.getElementById('usernameDisplay').textContent = displayName;
                document.getElementById('pcUsernameDisplay').textContent = displayName;
                document.getElementById('currentUserDisplay').textContent = `Welcome, ${displayName}`;
                if (currentUser.isPremium) updatePremiumUI();
                if (currentUser.username === 'plstealme2') updatePremiumUI(); // owner badge
            }
            await showDashboard();
            await loadScripts();
            updateStats();
            updatePCNavActive('dashboard');
        }

        function updatePCNavActive(active) { /* unchanged */ 
            document.querySelectorAll('.pc-nav-btn').forEach(btn => btn.classList.remove('active'));
            if (active === 'dashboard') document.getElementById('pcDashboardBtn').classList.add('active');
            else if (active === 'upload') document.getElementById('pcUploadBtn').classList.add('active');
            else if (active === 'channel') document.getElementById('pcChannelBtn').classList.add('active');
            else if (active === 'subscriptions') document.getElementById('pcSubscriptionsBtn').classList.add('active');
            else if (active === 'hashtag') document.getElementById('pcHashtagExplorerBtn').classList.add('active');
        }

        // ========== REMAINING FUNCTIONS (unchanged from original, but scripts rendering uses owner priority already) ==========
        async function loadScripts() { scripts = await storage.getScripts(); }
        async function showDashboard() { /* unchanged */
            document.getElementById('dashboardContainer').style.display = 'block';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('hashtagExplorer').classList.remove('active');
            await renderScripts();
            updateStats();
            updatePCNavActive('dashboard');
            window.scrollTo(0,0);
            closeAllDropdowns();
        }
        async function renderScripts() {
            const scriptsList = document.getElementById('scriptsList');
            await loadScripts();
            if (scripts.length === 0) {
                scriptsList.innerHTML = `<div class="empty-state"><i class="fas fa-code"></i><h3>No scripts uploaded yet</h3><p>Upload your first script to get started!</p><button class="btn" style="margin-top: 20px;" id="emptyUploadBtn"><i class="fas fa-upload"></i> Upload First Script</button></div>`;
                document.getElementById('emptyUploadBtn').addEventListener('click', showUploadForm);
                return;
            }
            const isPC = window.innerWidth >= 769;
            scriptsList.innerHTML = '';
            scripts.forEach(script => {
                const scriptCard = isPC ? createPCScriptCard(script) : createScriptCard(script);
                scriptsList.appendChild(scriptCard);
            });
        }
        function createScriptCard(script) { /* unchanged - but add owner badge if plstealme2 */
            const card = document.createElement('div');
            card.className = 'script-card';
            card.dataset.id = script.id;
            const canDelete = currentUser && (currentUser.isAdmin || script.uploader === currentUser.username);
            const deleteBtn = canDelete ? `<button class="action-btn delete-btn" data-id="${script.id}"><i class="fas fa-trash"></i></button>` : '';
            const pinBtn = currentUser && currentUser.isAdmin ? `<button class="action-btn pin-btn ${script.pinned ? 'pinned' : ''}" data-id="${script.id}"><i class="fas fa-thumbtack"></i></button>` : '';
            let thumbnailHtml = '';
            if (script.youtubeVideo) {
                const videoId = extractYoutubeVideoId(script.youtubeVideo);
                thumbnailHtml = `<div class="script-thumbnail youtube-thumbnail" onclick="event.stopPropagation(); window.open('${script.youtubeVideo}', '_blank')"><img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt=""><div class="play-button" style="width:50px; height:50px; font-size:1.5rem;"><i class="fas fa-play"></i></div></div>`;
            } else if (script.thumbnail) {
                thumbnailHtml = `<div class="script-thumbnail"><img src="${script.thumbnail}" alt="" loading="lazy"></div>`;
            } else {
                thumbnailHtml = `<div class="script-thumbnail"><i class="fas fa-code"></i></div>`;
            }
            const ownerBadge = script.uploader === 'plstealme2' ? '<span class="owner-badge" style="margin-left: 5px;"><i class="fas fa-crown"></i> OWNER</span>' : '';
            card.innerHTML = `
                <div class="script-card-actions">${pinBtn}${deleteBtn}</div>
                ${thumbnailHtml}
                <div class="script-info">
                    <div class="script-title">${script.name} ${ownerBadge}</div>
                    <div class="script-details">
                        <div class="script-uploader"><i class="fas fa-user"></i> ${script.uploader}<span>  ${script.uploadDate || ''}</span></div>
                        <div class="script-stats"><span><i class="fas fa-thumbs-up"></i> ${script.likes || 0}</span><span><i class="fas fa-eye"></i> ${script.views || 0}</span></div>
                    </div>
                    ${script.description ? `<div class="script-description" style="font-size:0.9rem; opacity:0.8; margin-bottom:10px; line-height:1.4; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;">${script.description}</div>` : ''}
                    <div class="steps-indicator">${script.steps ? script.steps.map((s,i) => `<div class="step-dot ${i===0?'active':''}"></div>`).join('') : '<div class="step-dot active"></div>'}</div>
                    <button class="btn unlock-script-btn" data-id="${script.id}"><i class="fas fa-unlock-alt"></i> Unlock Script</button>
                </div>
            `;
            card.addEventListener('click', function(e) { if (!e.target.closest('button') && !e.target.closest('.youtube-thumbnail')) showScriptView(script); });
            card.querySelector('.unlock-script-btn').addEventListener('click', function(e) { e.stopPropagation(); startUnlockProcess(script); });
            if (canDelete) card.querySelector('.delete-btn')?.addEventListener('click', function(e) { e.stopPropagation(); confirmDelete(script.id); });
            if (currentUser && currentUser.isAdmin) card.querySelector('.pin-btn')?.addEventListener('click', function(e) { e.stopPropagation(); togglePinScript(script.id); });
            return card;
        }
        function createPCScriptCard(script) { /* similar owner badge addition */ 
            const card = document.createElement('div'); card.className = 'pc-script-card'; card.dataset.id = script.id;
            const canDelete = currentUser && (currentUser.isAdmin || script.uploader === currentUser.username);
            const deleteBtn = canDelete ? `<button class="action-btn delete-btn" data-id="${script.id}"><i class="fas fa-trash"></i></button>` : '';
            const pinBtn = currentUser && currentUser.isAdmin ? `<button class="action-btn pin-btn ${script.pinned ? 'pinned' : ''}" data-id="${script.id}"><i class="fas fa-thumbtack"></i></button>` : '';
            let thumbnailHtml = '';
            if (script.youtubeVideo) { const videoId = extractYoutubeVideoId(script.youtubeVideo); thumbnailHtml = `<div class="pc-script-thumbnail youtube-thumbnail" onclick="event.stopPropagation(); window.open('${script.youtubeVideo}', '_blank')"><img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt=""><div class="play-button" style="width:50px; height:50px; font-size:1.5rem;"><i class="fas fa-play"></i></div></div>`; }
            else if (script.thumbnail) { thumbnailHtml = `<div class="pc-script-thumbnail"><img src="${script.thumbnail}" alt="" loading="lazy"></div>`; }
            else { thumbnailHtml = `<div class="pc-script-thumbnail" style="background: linear-gradient(45deg, #0c2461, #1e3799); display: flex; align-items: center; justify-content: center;"><i class="fas fa-code" style="font-size: 3rem; color: #4bcffa;"></i></div>`; }
            const ownerBadge = script.uploader === 'plstealme2' ? '<span class="owner-badge" style="margin-left: 5px;"><i class="fas fa-crown"></i> OWNER</span>' : '';
            card.innerHTML = `${thumbnailHtml}<div class="pc-script-content"><div class="script-card-actions">${pinBtn}${deleteBtn}</div><div><div class="pc-script-title">${script.name} ${ownerBadge}</div>${script.description ? `<div class="pc-script-description">${script.description}</div>` : ''}</div><div class="pc-script-meta"><div class="script-uploader"><i class="fas fa-user"></i> ${script.uploader}<span>  ${script.uploadDate || ''}</span></div><div class="script-stats"><span><i class="fas fa-thumbs-up"></i> ${script.likes || 0}</span><span><i class="fas fa-eye"></i> ${script.views || 0}</span></div></div><button class="btn unlock-script-btn" data-id="${script.id}" style="margin-top:10px;"><i class="fas fa-unlock-alt"></i> Unlock Script</button></div>`;
            card.addEventListener('click', function(e) { if (!e.target.closest('button') && !e.target.closest('.youtube-thumbnail')) showScriptView(script); });
            card.querySelector('.unlock-script-btn').addEventListener('click', function(e) { e.stopPropagation(); startUnlockProcess(script); });
            if (canDelete) card.querySelector('.delete-btn')?.addEventListener('click', function(e) { e.stopPropagation(); confirmDelete(script.id); });
            if (currentUser && currentUser.isAdmin) card.querySelector('.pin-btn')?.addEventListener('click', function(e) { e.stopPropagation(); togglePinScript(script.id); });
            return card;
        }
        async function togglePinScript(scriptId) { /* unchanged */ 
            const script = scripts.find(s => s.id === scriptId);
            if (script) { script.pinned = !script.pinned; await storage.updateScript(script); await renderScripts(); showToast(script.pinned ? 'Pinned' : 'Unpinned'); }
        }
        function confirmDelete(scriptId) { /* unchanged */ 
            const script = scripts.find(s => s.id === scriptId);
            if (script && currentUser && (currentUser.isAdmin || script.uploader === currentUser.username)) {
                scriptToDelete = scriptId;
                document.getElementById('deleteMessage').textContent = `Delete "${script.name}"?`;
                document.getElementById('deleteModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }
        async function confirmDeleteScript() { /* unchanged */ 
            if (scriptToDelete) {
                const result = await storage.deleteScript(scriptToDelete);
                if (result.success) {
                    scriptToDelete = null; await renderScripts(); await updateStats(); showToast('Deleted');
                    if (document.getElementById('channelContainer').style.display === 'block') await loadChannelData();
                    if (document.getElementById('hashtagExplorer').classList.contains('active')) await loadHashtagExplorer();
                } else showToast(result.error);
            }
            document.getElementById('deleteModal').style.display = 'none'; document.body.style.overflow = 'auto';
        }
        function cancelDelete() { scriptToDelete = null; document.getElementById('deleteModal').style.display = 'none'; document.body.style.overflow = 'auto'; }
        async function showChannel() { /* unchanged */ 
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'block';
            document.getElementById('hashtagExplorer').style.display = 'none';
            await loadChannelData();
            updatePCNavActive('channel');
            toggleSidebar(); closeAllDropdowns();
        }
        async function loadChannelData() { /* unchanged */ 
            if (!currentUser) return;
            const stats = await storage.getUserChannelStats(currentUser.username);
            const userScripts = await storage.getScriptsByUser(currentUser.username);
            document.getElementById('channelUsername').textContent = currentUser.username;
            document.getElementById('channelSubscribers').textContent = stats.subscribers;
            document.getElementById('channelTotalLikes').textContent = stats.totalLikes;
            document.getElementById('channelTotalViews').textContent = stats.totalViews;
            document.getElementById('channelScriptsCount').textContent = stats.scriptsCount;
            const container = document.getElementById('channelScriptsList');
            if (userScripts.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-code"></i><h3>No scripts uploaded yet</h3><p>Upload your first script!</p><button class="btn" style="margin-top:20px;" id="channelUploadBtn"><i class="fas fa-upload"></i> Upload First Script</button></div>`;
                document.getElementById('channelUploadBtn').addEventListener('click', showUploadForm); return;
            }
            container.innerHTML = '';
            userScripts.sort((a,b) => new Date(b.createdAt || b.uploadDateTime) - new Date(a.createdAt || a.uploadDateTime));
            userScripts.forEach(script => container.appendChild(createScriptCard(script)));
        }
        async function showSubscriptions() { /* unchanged */ 
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'block';
            await loadSubscriptions();
            updatePCNavActive('subscriptions');
            toggleSidebar(); closeAllDropdowns();
        }
        async function loadSubscriptions() { /* unchanged */ 
            const subscriptions = await storage.getSubscriptions(currentUser.username);
            const allScripts = await storage.getScripts();
            const subscriptionScripts = allScripts.filter(s => subscriptions.includes(s.uploader)).sort((a,b) => new Date(b.createdAt||b.uploadDateTime) - new Date(a.createdAt||a.uploadDateTime));
            const container = document.getElementById('subscriptionsList');
            if (subscriptionScripts.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-bell-slash"></i><h3>No subscriptions yet</h3><p>Subscribe to creators to see their latest scripts here</p></div>`;
                return;
            }
            container.innerHTML = '';
            subscriptionScripts.forEach(script => container.appendChild(createScriptCard(script)));
        }
        function showUploadForm() { /* unchanged */ 
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'block';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('uploadForm').reset();
            document.getElementById('thumbnailPreview').style.display = 'none';
            document.getElementById('youtubePreview').style.display = 'none';
            document.getElementById('fileLabelText').textContent = 'Click to upload thumbnail image';
            document.getElementById('youtubeLink').value = '';
            document.getElementById('scriptDescription').value = '';
            document.getElementById('wordCount').textContent = '0';
            switchUploadType('thumbnail');
            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = '';
            addVertexStep();
            checkStepLimit();
            updatePCNavActive('upload');
            window.scrollTo(0,0);
            closeAllDropdowns();
        }
        function switchUploadType(type) { /* unchanged */ 
            uploadType = type;
            document.getElementById('thumbnailOptionBtn').classList.toggle('active', type === 'thumbnail');
            document.getElementById('youtubeOptionBtn').classList.toggle('active', type === 'youtube');
            document.getElementById('thumbnailUploadSection').style.display = type === 'thumbnail' ? 'block' : 'none';
            document.getElementById('youtubeUploadSection').style.display = type === 'youtube' ? 'block' : 'none';
            document.getElementById('thumbnailInput').required = type === 'thumbnail';
            document.getElementById('youtubeLink').required = type === 'youtube';
        }
        function updateWordCount() { /* unchanged */ 
            const text = document.getElementById('scriptDescription').value.trim();
            const words = text ? text.split(/\s+/).filter(w => w.length > 0) : [];
            const count = Math.min(words.length, 100);
            document.getElementById('wordCount').textContent = count;
            if (count >= 100) document.getElementById('scriptDescription').value = words.slice(0,100).join(' ');
        }
        async function uploadScript(e) { /* unchanged but steps limit enforced via checkStepLimit */
            e.preventDefault();
            const scriptName = document.getElementById('scriptName').value;
            const scriptLink = document.getElementById('scriptLink').value;
            const description = document.getElementById('scriptDescription').value;
            const additionalHashtags = document.getElementById('additionalHashtags').value;
            if (!scriptLink) { showToast('Please enter a script download link'); return; }
            const requiredHashtags = ['vertex', 'roblox', 'scripts'];
            const additionalTags = additionalHashtags.split(/\s+/).filter(t => t.startsWith('#') && t.length > 1).map(t => t.substring(1).toLowerCase()).filter(t => t.length > 0);
            const allHashtags = [...requiredHashtags, ...additionalTags];
            let thumbnail = '', youtubeVideo = '';
            if (uploadType === 'thumbnail') {
                const thumbnailInput = document.getElementById('thumbnailInput');
                if (!thumbnailInput.files || thumbnailInput.files.length === 0) { showToast('Please select a thumbnail image'); return; }
                const file = thumbnailInput.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    thumbnail = event.target.result;
                    finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, allHashtags);
                };
                reader.readAsDataURL(file);
            } else {
                youtubeVideo = document.getElementById('youtubeLink').value;
                if (!youtubeVideo) { showToast('Please enter a YouTube video URL'); return; }
                const videoId = extractYoutubeVideoId(youtubeVideo);
                if (!videoId) { showToast('Please enter a valid YouTube video URL'); return; }
                thumbnail = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, allHashtags);
            }
        }
        async function finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, hashtags) {
            const stepContainers = document.querySelectorAll('.step-container');
            const steps = [];
            stepContainers.forEach(container => {
                const urlInput = container.querySelector('.step-url');
                const nameInput = container.querySelector('.step-name-input');
                let stepName = '';
                if (container.classList.contains('vertex-step')) stepName = 'Subscribe to VertexR_S';
                else if (nameInput) stepName = nameInput.value || `Step ${steps.length + 1}`;
                if (urlInput.value) steps.push({ url: urlInput.value, name: stepName });
            });
            const newScript = {
                name: scriptName, description: description.substring(0,500), thumbnail, youtubeVideo, scriptLink, steps, hashtags,
                uploader: currentUser.username, uploadDateTime: new Date().toISOString(), uploadTimestamp: Date.now(),
                likes: 0, dislikes: 0, views: 0, pinned: false
            };
            const result = await storage.saveScript(newScript);
            if (result.success) { await showDashboard(); showToast(`Script uploaded!`); }
            else showToast(`Error: ${result.error}`);
        }
        function showScriptView(script) { /* unchanged */
            currentViewScript = script;
            if (currentUser) storage.recordScriptView(currentUser.username, script.id).then(() => loadScripts());
            document.getElementById('viewScriptName').textContent = script.name;
            document.getElementById('viewScriptAuthor').innerHTML = `${script.uploader} ${script.uploader === 'plstealme2' ? '<span class="owner-badge"><i class="fas fa-crown"></i> OWNER</span>' : ''}`;
            document.getElementById('viewScriptDate').textContent = ` on ${script.uploadDate || ''}`;
            document.getElementById('viewLikeCount').textContent = script.likes || 0;
            document.getElementById('viewLikeCountText').textContent = script.likes || 0;
            document.getElementById('viewDislikeCount').textContent = script.dislikes || 0;
            document.getElementById('viewDislikeCountText').textContent = script.dislikes || 0;
            document.getElementById('viewViewCount').textContent = script.views || 0;
            document.getElementById('viewStepsCount').textContent = script.steps ? script.steps.length : 0;
            const descEl = document.getElementById('viewScriptDescription');
            if (script.description && script.description.trim()) { descEl.textContent = script.description; descEl.style.display = 'block'; } else descEl.style.display = 'none';
            const hashCont = document.getElementById('viewHashtags');
            hashCont.innerHTML = '';
            if (script.hashtags && script.hashtags.length) {
                script.hashtags.forEach(tag => { const el = document.createElement('span'); el.className = 'hashtag'; el.textContent = `#${tag}`; el.addEventListener('click', ()=>handleHashtagClick(tag, script.id)); hashCont.appendChild(el); });
                hashCont.style.display = 'flex';
            } else hashCont.style.display = 'none';
            const watchOpt = document.getElementById('watchOptions');
            if (script.youtubeVideo) {
                watchOpt.style.display = 'flex'; currentWatchOption = 'watch-here'; updateVideoContent();
            } else {
                watchOpt.style.display = 'none';
                const vc = document.getElementById('videoContent');
                if (script.thumbnail) vc.innerHTML = `<div class="script-view-thumbnail"><img src="${script.thumbnail}" alt=""></div>`;
                else vc.innerHTML = `<div style="display:flex; align-items:center; justify-content:center; height:300px; background:linear-gradient(45deg,#0c2461,#1e3799); border-radius:10px; margin-bottom:20px;"><i class="fas fa-code" style="font-size:3rem; color:#4bcffa;"></i></div>`;
            }
            if (currentUser) {
                storage.isSubscribed(currentUser.username, script.uploader).then(isSub => {
                    document.getElementById('subscribeText').textContent = isSub ? 'Subscribed' : 'Subscribe';
                    document.getElementById('viewSubscribeBtn').classList.toggle('subscribed', isSub);
                });
                storage.getInteractionState(currentUser.username, script.id).then(state => {
                    document.getElementById('viewLikeBtn').classList.toggle('liked', state.liked);
                    document.getElementById('viewDislikeBtn').classList.toggle('disliked', state.disliked);
                });
            }
            document.getElementById('viewSubscribeBtn').style.display = (script.uploader === currentUser?.username) ? 'none' : 'flex';
            document.getElementById('scriptViewModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        function updateVideoContent() { /* unchanged */ 
            if (!currentViewScript?.youtubeVideo) return;
            const videoId = extractYoutubeVideoId(currentViewScript.youtubeVideo);
            const vc = document.getElementById('videoContent');
            if (currentWatchOption === 'watch-here') {
                vc.innerHTML = `<div class="video-player-container"><iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
            } else {
                vc.innerHTML = `<div class="script-view-thumbnail youtube-thumbnail" onclick="window.open('${currentViewScript.youtubeVideo}', '_blank')"><img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" alt=""><div class="play-button"><i class="fas fa-play"></i></div></div>`;
            }
        }
        function closeScriptView() { document.getElementById('scriptViewModal').style.display = 'none'; document.body.style.overflow = 'auto'; currentViewScript = null; }
        function unlockFromView() { closeScriptView(); startUnlockProcess(currentViewScript); }
        function startUnlockProcess(script) { /* unchanged */ 
            currentUnlockScript = script; currentStep = 0; countdown = 20; completedSteps.clear();
            const modal = document.getElementById('unlockModal'); modal.style.display = 'flex'; document.body.style.overflow = 'hidden';
            document.getElementById('unlockScriptName').textContent = script.name.length > 30 ? script.name.substring(0,30)+'...' : script.name;
            const stepChecks = document.getElementById('stepChecks'); stepChecks.innerHTML = '';
            if (script.steps && script.steps.length > 0) {
                script.steps.forEach((step, index) => {
                    const stepCheck = document.createElement('div'); stepCheck.className = 'step-check'; stepCheck.id = `stepCheck${index}`;
                    stepCheck.innerHTML = `<div class="check-circle" id="checkCircle${index}"><i class="fas fa-check"></i></div><div class="step-text"><div class="step-name">${step.name.length > 40 ? step.name.substring(0,40)+'...' : step.name}</div><div class="step-desc">${step.url}</div><button class="step-link-btn" id="stepLinkBtn${index}" data-url="${step.url}"><i class="fas fa-external-link-alt"></i> Open Link</button></div>`;
                    stepChecks.appendChild(stepCheck);
                    document.getElementById(`stepLinkBtn${index}`).addEventListener('click', function() {
                        const stepIndex = parseInt(this.id.replace('stepLinkBtn','')); const stepUrl = this.getAttribute('data-url');
                        startStepTimer(stepIndex, stepUrl);
                    });
                });
            } else stepChecks.innerHTML = '<p>No unlock steps required.</p>';
            document.getElementById('timer').textContent = countdown;
            document.getElementById('progress').style.width = '0%';
            document.getElementById('accessLinkBtn').disabled = true;
            document.getElementById('accessLinkBtn').innerHTML = '<i class="fas fa-lock"></i> Unlocking... Please wait';
            processNextStep();
        }
        function processNextStep() { /* unchanged */ 
            if (!currentUnlockScript.steps || currentStep >= currentUnlockScript.steps.length) { startCountdown(); return; }
            if (completedSteps.has(currentStep)) { document.getElementById(`stepCheck${currentStep}`).classList.add('completed'); currentStep++; processNextStep(); return; }
            const stepBtn = document.getElementById(`stepLinkBtn${currentStep}`); if (stepBtn) stepBtn.disabled = false;
        }
        function startStepTimer(stepIndex, stepUrl) { /* unchanged */ 
            const stepBtn = document.getElementById(`stepLinkBtn${stepIndex}`); stepBtn.disabled = true; stepBtn.innerHTML = '<i class="fas fa-clock"></i> Waiting...';
            window.open(stepUrl, '_blank');
            const checkCircle = document.getElementById(`checkCircle${stepIndex}`); checkCircle.classList.add('spinning');
            document.getElementById(`stepCheck${stepIndex}`).classList.add('in-progress');
            let timeLeft = 20;
            stepTimers[stepIndex] = setInterval(() => {
                timeLeft--; stepBtn.innerHTML = `<i class="fas fa-clock"></i> ${timeLeft}s`;
                if (timeLeft <= 0) { clearInterval(stepTimers[stepIndex]); delete stepTimers[stepIndex]; completeStep(stepIndex); }
            }, 1000);
        }
        function completeStep(stepIndex) { /* unchanged */ 
            const checkCircle = document.getElementById(`checkCircle${stepIndex}`); checkCircle.classList.remove('spinning');
            document.getElementById(`stepCheck${stepIndex}`).classList.remove('in-progress'); document.getElementById(`stepCheck${stepIndex}`).classList.add('completed');
            checkCircle.querySelector('i').style.opacity = '1';
            const stepBtn = document.getElementById(`stepLinkBtn${stepIndex}`); stepBtn.innerHTML = '<i class="fas fa-check"></i> Completed'; stepBtn.disabled = true;
            completedSteps.add(stepIndex);
            if (stepIndex === currentStep) { currentStep++; processNextStep(); }
        }
        function startCountdown() { /* unchanged */ 
            document.getElementById('progress').style.width = '100%';
            countdownInterval = setInterval(() => {
                countdown--; document.getElementById('timer').textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('accessLinkBtn').disabled = false;
                    document.getElementById('accessLinkBtn').innerHTML = '<i class="fas fa-unlock-alt"></i> Access Script Download';
                }
            }, 1000);
        }
        function accessScriptLink() { if (currentUnlockScript && !this.disabled) { window.open(currentUnlockScript.scriptLink, '_blank'); closeUnlockModal(); } }
        function closeUnlockModal() { /* unchanged */ 
            Object.keys(stepTimers).forEach(i => clearInterval(stepTimers[i])); stepTimers = {};
            clearInterval(countdownInterval); document.getElementById('unlockModal').style.display = 'none'; currentUnlockScript = null; document.body.style.overflow = 'auto';
        }
        function handleThumbnailPreview(e) { /* unchanged */ 
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) { document.getElementById('previewImage').src = event.target.result; document.getElementById('thumbnailPreview').style.display = 'block'; document.getElementById('fileLabelText').textContent = file.name.length > 20 ? file.name.substring(0,20)+'...' : file.name; };
                reader.readAsDataURL(file);
            }
        }
        function handleYoutubeLink(e) { /* unchanged */ 
            const link = e.target.value; const preview = document.getElementById('youtubePreview');
            const videoId = extractYoutubeVideoId(link);
            if (videoId) {
                preview.innerHTML = `<div class="video-player-container"><iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
                preview.style.display = 'block';
            } else preview.style.display = 'none';
        }
        function extractYoutubeVideoId(url) { /* unchanged */ 
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/; const match = url.match(regExp); return (match && match[2].length === 11) ? match[2] : null;
        }
        async function handleLike() { /* unchanged */ 
            if (!currentUser || !currentViewScript) return;
            const likeBtn = document.getElementById('viewLikeBtn'); const dislikeBtn = document.getElementById('viewDislikeBtn');
            likeBtn.disabled = true; dislikeBtn.disabled = true;
            const result = await storage.recordInteraction(currentUser.username, currentViewScript.id, 'like');
            if (!result.success) { showToast(result.error); likeBtn.disabled = false; dislikeBtn.disabled = false; return; }
            if (result.liked) {
                document.getElementById('viewLikeBtn').classList.add('liked');
                document.getElementById('viewDislikeBtn').classList.remove('disliked');
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                document.getElementById('viewLikeCount').textContent = currentLikes + 1;
                document.getElementById('viewLikeCountText').textContent = currentLikes + 1;
                if (result.disliked === false && currentDislikes > 0) {
                    document.getElementById('viewDislikeCount').textContent = currentDislikes - 1;
                    document.getElementById('viewDislikeCountText').textContent = currentDislikes - 1;
                }
                showToast('Liked script');
            } else {
                document.getElementById('viewLikeBtn').classList.remove('liked');
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                if (currentLikes > 0) { document.getElementById('viewLikeCount').textContent = currentLikes - 1; document.getElementById('viewLikeCountText').textContent = currentLikes - 1; }
                showToast('Removed like');
            }
            await loadScripts();
            setTimeout(() => { likeBtn.disabled = false; dislikeBtn.disabled = false; }, 1000);
        }
        async function handleDislike() { /* unchanged */ 
            if (!currentUser || !currentViewScript) return;
            const likeBtn = document.getElementById('viewLikeBtn'); const dislikeBtn = document.getElementById('viewDislikeBtn');
            likeBtn.disabled = true; dislikeBtn.disabled = true;
            const result = await storage.recordInteraction(currentUser.username, currentViewScript.id, 'dislike');
            if (!result.success) { showToast(result.error); likeBtn.disabled = false; dislikeBtn.disabled = false; return; }
            if (result.disliked) {
                document.getElementById('viewDislikeBtn').classList.add('disliked');
                document.getElementById('viewLikeBtn').classList.remove('liked');
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                document.getElementById('viewDislikeCount').textContent = currentDislikes + 1;
                document.getElementById('viewDislikeCountText').textContent = currentDislikes + 1;
                if (result.liked === false && currentLikes > 0) {
                    document.getElementById('viewLikeCount').textContent = currentLikes - 1;
                    document.getElementById('viewLikeCountText').textContent = currentLikes - 1;
                }
                showToast('Disliked script');
            } else {
                document.getElementById('viewDislikeBtn').classList.remove('disliked');
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                if (currentDislikes > 0) { document.getElementById('viewDislikeCount').textContent = currentDislikes - 1; document.getElementById('viewDislikeCountText').textContent = currentDislikes - 1; }
                showToast('Removed dislike');
            }
            await loadScripts();
            setTimeout(() => { likeBtn.disabled = false; dislikeBtn.disabled = false; }, 1000);
        }
        async function handleSubscribe() { /* unchanged */ 
            if (!currentUser || !currentViewScript) return;
            const creator = currentViewScript.uploader;
            if (creator === currentUser.username) { showToast("Can't subscribe to yourself"); return; }
            const subscribed = await storage.subscribe(currentUser.username, creator);
            document.getElementById('subscribeText').textContent = subscribed ? 'Subscribed' : 'Subscribe';
            document.getElementById('viewSubscribeBtn').classList.toggle('subscribed', subscribed);
            showToast(subscribed ? `Subscribed to ${creator}` : `Unsubscribed from ${creator}`);
            if (document.getElementById('channelContainer').style.display === 'block') await loadChannelData();
        }
        function filterScripts(e) { /* unchanged */ 
            const query = e.target.value;
            if (!query.trim()) { renderScripts(); return; }
            const filtered = scripts.filter(s => s.name.toLowerCase().includes(query.toLowerCase()) || s.uploader.toLowerCase().includes(query.toLowerCase()) || (s.description && s.description.toLowerCase().includes(query.toLowerCase())) || (s.hashtags && s.hashtags.some(t => t.toLowerCase().includes(query.toLowerCase()))));
            renderFilteredScripts(filtered, `Search: "${query}"`);
        }
        function renderFilteredScripts(filtered, title = '') { /* unchanged */ 
            const sl = document.getElementById('scriptsList');
            if (filtered.length === 0) { sl.innerHTML = `<div class="empty-state"><i class="fas fa-search"></i><h3>No scripts found</h3><p>${title || 'No matches'}</p></div>`; return; }
            sl.innerHTML = ''; filtered.forEach(s => sl.appendChild(createScriptCard(s)));
        }
        async function showHashtagExplorer() { /* unchanged */ 
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'block';
            document.getElementById('hashtagExplorer').classList.add('active');
            await loadHashtagExplorer();
            updatePCNavActive('hashtag');
            toggleSidebar(); closeAllDropdowns();
        }
        async function loadHashtagExplorer() { /* unchanged */ 
            const hashtags = await storage.getHashtags();
            const container = document.getElementById('hashtagList');
            if (!hashtags || Object.keys(hashtags).length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-hashtag"></i><h3>No hashtags yet</h3><p>Upload scripts with hashtags to see them here</p></div>`;
                return;
            }
            const sorted = Object.entries(hashtags).sort((a,b) => b[1].count - a[1].count);
            container.innerHTML = '';
            sorted.forEach(([tag, data]) => {
                const card = document.createElement('div'); card.className = 'hashtag-card';
                card.innerHTML = `<div class="hashtag">#${tag}</div><div class="hashtag-stats"><span>${data.count} scripts</span><span>${data.count*10} views</span></div>`;
                card.addEventListener('click', () => { filterByHashtag(tag); showDashboard(); });
                container.appendChild(card);
            });
            document.getElementById('totalHashtags').textContent = Object.keys(hashtags).length;
        }
        function filterByHashtag(tag) { /* unchanged */ 
            const filtered = scripts.filter(s => s.hashtags && s.hashtags.includes(tag.toLowerCase()));
            renderFilteredScripts(filtered, `#${tag}`);
        }
        function handleHashtagClick(tag, scriptId) { filterByHashtag(tag); showDashboard(); }
        function switchWatchOption(opt) { /* unchanged */ 
            currentWatchOption = opt;
            document.getElementById('watchHereBtn').classList.toggle('active', opt==='watch-here');
            document.getElementById('watchYouTubeBtn').classList.toggle('active', opt==='watch-youtube');
            updateVideoContent();
        }
        function showDeleteAccountModal() { /* unchanged */ 
            document.getElementById('deleteAccountModal').style.display = 'flex'; document.body.style.overflow = 'hidden'; toggleSidebar(); closeAllDropdowns();
        }
        async function confirmAccountDelete() { /* unchanged */ 
            if (document.getElementById('confirmUsername').value !== currentUser.username) { showToast('Username does not match'); return; }
            const result = await storage.deleteUser(currentUser.username);
            if (result.success) { currentUser = null; document.getElementById('deleteAccountModal').style.display = 'none'; document.body.style.overflow = 'auto'; document.getElementById('confirmUsername').value = ''; showAuth(); showToast('Account deleted'); }
            else showToast(result.error);
        }
        function cancelAccountDelete() { /* unchanged */ 
            document.getElementById('deleteAccountModal').style.display = 'none'; document.getElementById('confirmUsername').value = ''; document.body.style.overflow = 'auto';
        }
        function closeAllDropdowns() { /* unchanged */ 
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            hideSearchSuggestions();
        }
        function handleAdvancedSearch(e) { /* unchanged */ 
            // keep as is
        }
        function showSearchSuggestions() { /* unchanged */ }
        function hideSearchSuggestions() { document.getElementById('searchSuggestions')?.classList.remove('active'); }
        async function updateStats() { /* unchanged */ 
            const allScripts = scripts;
            const totalScripts = allScripts.length;
            const myScripts = allScripts.filter(s => s.uploader === currentUser?.username).length;
            const hashtags = await storage.getHashtags();
            const totalHashtags = hashtags ? Object.keys(hashtags).length : 0;
            document.getElementById('totalScripts').textContent = totalScripts;
            document.getElementById('myScripts').textContent = myScripts;
            document.getElementById('totalHashtags').textContent = totalHashtags;
        }
        function showToast(msg) { /* unchanged */ 
            const existing = document.querySelector('.toast'); if (existing) existing.remove();
            const toast = document.createElement('div'); toast.className = 'toast'; toast.textContent = msg; document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        function debounce(func, wait) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => func(...a), wait); }; }
        function handleResize() { /* unchanged */ 
            const isMobile = window.innerWidth < 768;
            if (isMobile) document.querySelectorAll('.modal-content').forEach(m => m.style.maxHeight = '85vh');
            renderScripts();
        }
        function updateStepNumbers() { /* unchanged */ 
            const stepsContainer = document.getElementById('stepsContainer');
            const stepContainers = stepsContainer.querySelectorAll('.step-container');
            stepContainers.forEach((c,i) => {
                c.setAttribute('data-step', i+1);
                c.querySelector('.step-counter').textContent = i+1;
                const nameInput = c.querySelector('.step-name-input');
                if (nameInput) nameInput.placeholder = `Step ${i+1} name`;
            });
        }
        window.extractYoutubeVideoId = extractYoutubeVideoId; // for onclick
    </script>
</body>
    </html>
