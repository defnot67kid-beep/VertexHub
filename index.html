<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>VertexScripts - Advanced Script Uploader & Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            width: 100%;
            padding: 0 20px;
        }
        
        /* Enhanced PC Header */
        .pc-enhanced-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(12, 36, 97, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            position: sticky;
            top: 10px;
            z-index: 1000;
        }
        
        .pc-header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .pc-header-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .pc-nav {
            display: flex;
            gap: 15px;
        }
        
        .pc-nav-btn {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .pc-nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .pc-nav-btn.active {
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            box-shadow: 0 5px 15px rgba(75, 207, 250, 0.3);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .logo i {
            color: #4bcffa;
            font-size: 1.8rem;
        }
        
        /* Enhanced Dropdowns */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            min-width: 160px;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(30, 30, 46, 0.98);
            min-width: 220px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-radius: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 8px;
            overflow: hidden;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dropdown.active .dropdown-content {
            display: block;
        }
        
        .dropdown-content a {
            color: white;
            padding: 14px 20px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .dropdown-content a:hover {
            background: rgba(255, 255, 255, 0.1);
            padding-left: 25px;
        }
        
        .dropdown-content a i {
            width: 20px;
            text-align: center;
        }
        
        /* Search with Creator Results */
        .search-container {
            position: relative;
            width: 300px;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 46, 0.98);
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .search-results.active {
            display: block;
        }
        
        .creator-result {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .creator-result:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .creator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 12px;
        }
        
        .creator-info {
            flex: 1;
        }
        
        .creator-name {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .creator-stats {
            font-size: 0.8rem;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 2px;
        }
        
        .subscribe-btn-small {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .subscribe-btn-small:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .subscribe-btn-small.subscribed {
            background: #4bcffa;
            color: #0c2461;
        }
        
        /* Script Grid - Square Cards */
        .scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .scripts-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }
        
        @media (min-width: 1800px) {
            .scripts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 25px;
            }
        }
        
        .script-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
        }
        
        .script-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .script-thumbnail {
            width: 100%;
            height: 60%;
            position: relative;
            overflow: hidden;
        }
        
        .script-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .script-card:hover .script-thumbnail img {
            transform: scale(1.05);
        }
        
        .script-info {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .script-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .script-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .script-uploader {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .script-uploader-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .script-stats {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .time-ago {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 4px;
        }
        
        /* Enhanced Upload Form */
        .social-platform-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .platform-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .platform-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .platform-option.active {
            background: rgba(75, 207, 250, 0.2);
            border-color: #4bcffa;
        }
        
        .platform-option i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .social-actions {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
        }
        
        .social-actions.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .social-action-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .social-action-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .social-input-group {
            margin-top: 15px;
        }
        
        .social-input-group input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Profile Edit Modal */
        .profile-edit-modal {
            max-width: 500px;
        }
        
        .profile-preview {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .profile-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-avatar-large input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .pc-enhanced-header {
                display: none;
            }
            
            .mobile-header {
                display: flex;
                flex-direction: column;
                gap: 15px;
                padding: 15px 0;
                margin-bottom: 20px;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            }
            
            .mobile-header-top {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .mobile-menu-btn {
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                padding: 10px;
            }
            
            .mobile-dropdown-content {
                display: none;
                background: rgba(30, 30, 46, 0.98);
                border-radius: 10px;
                margin-top: 10px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                overflow: hidden;
            }
            
            .mobile-dropdown-content.active {
                display: block;
                animation: fadeIn 0.3s ease;
            }
            
            .mobile-dropdown-content a {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 15px 20px;
                color: white;
                text-decoration: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            
            .mobile-dropdown-content a:last-child {
                border-bottom: none;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-header {
                display: none;
            }
        }
        
        /* Creator Profile View */
        .creator-profile {
            display: none;
            margin-bottom: 30px;
        }
        
        .creator-profile.active {
            display: block;
        }
        
        .profile-header {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .profile-avatar-xl {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .profile-avatar-xl img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .profile-stats {
            display: flex;
            gap: 30px;
            margin-top: 15px;
        }
        
        .profile-stat {
            text-align: center;
        }
        
        .profile-stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4bcffa;
        }
        
        .profile-stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* Notification Permission */
        .notification-permission {
            display: none;
            background: rgba(75, 207, 250, 0.1);
            border: 2px solid #4bcffa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .notification-permission.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Main Content Areas */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        /* Common Button Styles */
        .btn {
            background: linear-gradient(135deg, #4bcffa, #5d79ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(75, 207, 250, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Form Elements */
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-top: 5px;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4bcffa;
        }
        
        /* FYP Algorithm Indicator */
        .fyp-boost {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }
        
        .fyp-boost.active {
            display: block;
        }
        
        /* Step Preview in Upload */
        .step-preview {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div id="authContainer" class="auth-container">
        <!-- ... Same as before ... -->
    </div>
    
    <!-- Main Application Container -->
    <div id="appContainer" style="display: none;">
        <!-- Enhanced PC Header -->
        <div class="pc-enhanced-header">
            <div class="pc-header-left">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <span>VertexScripts</span>
                </div>
                
                <div class="pc-nav">
                    <button class="pc-nav-btn active" id="pcDashboardBtn">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="pc-nav-btn" id="pcUploadBtn">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                    <button class="pc-nav-btn" id="pcChannelBtn">
                        <i class="fas fa-user"></i> Channel
                    </button>
                    <button class="pc-nav-btn" id="pcSubscriptionsBtn">
                        <i class="fas fa-bell"></i> Subscriptions
                    </button>
                    <button class="pc-nav-btn" id="pcHashtagExplorerBtn">
                        <i class="fas fa-hashtag"></i> Hashtags
                    </button>
                </div>
            </div>
            
            <div class="pc-header-right">
                <div class="search-container">
                    <input type="text" class="search-input" id="pcSearchInput" placeholder="Search scripts or @creators...">
                    <i class="fas fa-search search-icon"></i>
                    <div class="search-results" id="searchResults">
                        <!-- Search results will appear here -->
                    </div>
                </div>
                
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <i class="fas fa-user-circle"></i>
                        <span id="pcUsernameDisplay"></span>
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" id="pcEditProfileBtn">
                            <i class="fas fa-user-edit"></i> Edit Profile
                        </a>
                        <a href="#" id="pcViewChannelBtn">
                            <i class="fas fa-user"></i> My Channel
                        </a>
                        <a href="#" id="pcSubscriptionsBtn2">
                            <i class="fas fa-bell"></i> Subscriptions
                        </a>
                        <a href="#" id="pcDeleteAccountBtn">
                            <i class="fas fa-trash"></i> Delete Account
                        </a>
                        <a href="#" id="pcLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="mobile-header-top">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <span>VertexScripts</span>
                </div>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <i class="fas fa-user-circle"></i>
                        <span id="mobileUsernameDisplay"></span>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" id="mobileEditProfileBtn">
                            <i class="fas fa-user-edit"></i> Edit Profile
                        </a>
                        <a href="#" id="mobileViewChannelBtn">
                            <i class="fas fa-user"></i> My Channel
                        </a>
                        <a href="#" id="mobileSubscriptionsBtn">
                            <i class="fas fa-bell"></i> Subscriptions
                        </a>
                        <a href="#" id="mobileHashtagExplorerBtn">
                            <i class="fas fa-hashtag"></i> Hashtag Explorer
                        </a>
                        <a href="#" id="mobileDeleteAccountBtn">
                            <i class="fas fa-trash"></i> Delete Account
                        </a>
                        <a href="#" id="mobileLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mobile-dropdown-content" id="mobileDropdown">
                <a href="#" id="mobileDashboardBtn">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="#" id="mobileUploadBtn">
                    <i class="fas fa-upload"></i> Upload Script
                </a>
                <a href="#" id="mobileChannelBtn">
                    <i class="fas fa-user"></i> My Channel
                </a>
                <a href="#" id="mobileSubscriptionsBtn2">
                    <i class="fas fa-bell"></i> Subscriptions
                </a>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="mobileSearchInput" placeholder="Search or @creators...">
                <i class="fas fa-search search-icon"></i>
                <div class="search-results" id="mobileSearchResults">
                    <!-- Mobile search results -->
                </div>
            </div>
        </header>
        
        <div class="container">
            <!-- Notification Permission Banner -->
            <div id="notificationPermission" class="notification-permission">
                <i class="fas fa-bell" style="font-size: 2rem; color: #4bcffa; margin-bottom: 10px;"></i>
                <h3>Get Notifications!</h3>
                <p>Enable notifications to know when creators you follow upload new scripts</p>
                <button id="enableNotificationsBtn" class="btn" style="margin-top: 10px;">
                    <i class="fas fa-bell"></i> Enable Notifications
                </button>
            </div>
            
            <!-- Creator Profile View -->
            <div id="creatorProfile" class="creator-profile card">
                <button class="back-to-dashboard" id="backFromCreatorProfile">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                
                <div class="profile-header">
                    <div class="profile-avatar-xl" id="creatorProfileAvatar">
                        <!-- Avatar will be set dynamically -->
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="creatorProfileName"></div>
                        <p id="creatorProfileBio">No bio yet</p>
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <div class="profile-stat-number" id="creatorScriptsCount">0</div>
                                <div class="profile-stat-label">Scripts</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-number" id="creatorSubscribers">0</div>
                                <div class="profile-stat-label">Subscribers</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-number" id="creatorTotalViews">0</div>
                                <div class="profile-stat-label">Views</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn" id="creatorSubscribeBtn">
                        <i class="fas fa-bell"></i> Subscribe
                    </button>
                </div>
                
                <h3><i class="fas fa-code"></i> Scripts by <span id="creatorScriptsTitle"></span></h3>
                <div id="creatorScriptsGrid" class="scripts-grid">
                    <!-- Creator's scripts will appear here -->
                </div>
            </div>
            
            <main class="main-content">
                <!-- ... Other sections same as before (Dashboard, Upload, etc.) ... -->
                <!-- Update the upload form section with new social platform selector -->
                <section id="uploadContainer" class="card upload-container">
                    <button class="back-to-dashboard" id="backToDashboardBtn">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <h2><i class="fas fa-upload"></i> Upload New Script</h2>
                    <form id="uploadForm">
                        <!-- ... Existing form fields ... -->
                        
                        <div class="form-group">
                            <label>Unlock Steps (Pre-built Options)</label>
                            <div class="social-platform-selector" id="platformSelector">
                                <div class="platform-option" data-platform="youtube">
                                    <i class="fab fa-youtube"></i>
                                    <div>YouTube</div>
                                </div>
                                <div class="platform-option" data-platform="tiktok">
                                    <i class="fab fa-tiktok"></i>
                                    <div>TikTok</div>
                                </div>
                                <div class="platform-option" data-platform="instagram">
                                    <i class="fab fa-instagram"></i>
                                    <div>Instagram</div>
                                </div>
                                <div class="platform-option" data-platform="twitch">
                                    <i class="fab fa-twitch"></i>
                                    <div>Twitch</div>
                                </div>
                                <div class="platform-option" data-platform="discord">
                                    <i class="fab fa-discord"></i>
                                    <div>Discord</div>
                                </div>
                            </div>
                            
                            <!-- Social Actions will appear here -->
                            <div id="socialActions" class="social-actions"></div>
                            
                            <!-- Custom Step Input -->
                            <div style="margin-top: 20px;">
                                <button type="button" id="addCustomStepBtn" class="btn btn-secondary">
                                    <i class="fas fa-plus"></i> Add Custom Step
                                </button>
                            </div>
                            
                            <!-- Steps Container -->
                            <div id="stepsContainer" style="margin-top: 15px;">
                                <!-- Steps will appear here -->
                            </div>
                        </div>
                        
                        <button type="submit" class="btn">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Script
                        </button>
                    </form>
                </section>
            </main>
            
            <!-- Profile Edit Modal -->
            <div id="profileEditModal" class="modal">
                <div class="modal-content profile-edit-modal">
                    <h3><i class="fas fa-user-edit"></i> Edit Profile</h3>
                    
                    <div class="profile-preview">
                        <div class="profile-avatar-large" id="profileAvatarPreview">
                            <div id="avatarInitials">JD</div>
                            <img id="avatarImage" src="" style="display: none;">
                            <input type="file" id="avatarUpload" accept="image/*">
                        </div>
                        <div>
                            <h4 id="profileUsernameDisplay"></h4>
                            <p class="time-ago">Member since <span id="joinDate"></span></p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileBio">Bio</label>
                        <textarea id="profileBio" placeholder="Tell everyone about yourself..." maxlength="200"></textarea>
                    </div>
                    
                    <div class="button-group">
                        <button id="saveProfileBtn" class="btn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button id="cancelProfileEditBtn" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ... Other modals same as before ... -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB4aVpNW6SKbj26fExI65voT84D2k_MvwQ",
            authDomain: "vertexscripts-4f108.firebaseapp.com",
            projectId: "vertexscripts-4f108",
            storageBucket: "vertexscripts-4f108.firebasestorage.app",
            messagingSenderId: "315039481759",
            appId: "1:315039481759:web:c52b2887332bc5a41307aa"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ============ UPDATED STORAGE SYSTEM ============
        class EnhancedVertexStorage {
            constructor() {
                this.auth = auth;
                this.db = db;
                this.storage = storage;
                this.currentUser = null;
                
                onAuthStateChanged(this.auth, async (user) => {
                    if (user) {
                        this.currentUser = user;
                        const username = user.email.split('@')[0];
                        this.currentUser.username = username;
                        
                        try {
                            const userDoc = await getDoc(doc(this.db, "users", username));
                            if (userDoc.exists()) {
                                const data = userDoc.data();
                                this.currentUser.isAdmin = data.isAdmin || false;
                                this.currentUser.avatarUrl = data.avatarUrl || '';
                                this.currentUser.bio = data.bio || '';
                                this.currentUser.subscribers = data.subscribers || 0;
                                this.currentUser.joinDate = data.joinDate || data.createdAt;
                            } else {
                                this.currentUser.isAdmin = false;
                                this.currentUser.avatarUrl = '';
                                this.currentUser.bio = '';
                                this.currentUser.subscribers = 0;
                                this.currentUser.joinDate = serverTimestamp();
                            }
                        } catch (error) {
                            console.error("Error getting user data:", error);
                        }
                        
                        if (window.appInitialized) showApp();
                    } else {
                        this.currentUser = null;
                        if (window.appInitialized) showAuth();
                    }
                });
            }
            
            // Upload avatar to storage
            async uploadAvatar(username, file) {
                try {
                    const storageRef = ref(this.storage, `avatars/${username}`);
                    await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(storageRef);
                    
                    // Update user document
                    await updateDoc(doc(this.db, "users", username), {
                        avatarUrl: downloadURL,
                        updatedAt: serverTimestamp()
                    });
                    
                    return downloadURL;
                } catch (error) {
                    console.error("Error uploading avatar:", error);
                    throw error;
                }
            }
            
            // Update user profile
            async updateUserProfile(username, data) {
                try {
                    await updateDoc(doc(this.db, "users", username), {
                        ...data,
                        updatedAt: serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Get user profile
            async getUserProfile(username) {
                try {
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        return { success: true, data: userDoc.data() };
                    }
                    return { success: false, error: 'User not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Search creators
            async searchCreators(query) {
                try {
                    const usersRef = collection(this.db, "users");
                    const q = query(usersRef, where("username", ">=", query), where("username", "<=", query + "\uf8ff"));
                    const snapshot = await getDocs(q);
                    
                    const creators = [];
                    snapshot.forEach(doc => {
                        creators.push({ username: doc.id, ...doc.data() });
                    });
                    
                    // Also search in scripts
                    const scriptsQuery = query(collection(this.db, "scripts"), where("uploader", ">=", query), where("uploader", "<=", query + "\uf8ff"));
                    const scriptsSnapshot = await getDocs(scriptsQuery);
                    
                    const uniqueCreators = new Set(creators.map(c => c.username));
                    scriptsSnapshot.forEach(doc => {
                        const uploader = doc.data().uploader;
                        if (!uniqueCreators.has(uploader)) {
                            uniqueCreators.add(uploader);
                            creators.push({ username: uploader });
                        }
                    });
                    
                    return creators.slice(0, 5); // Limit to 5 results
                } catch (error) {
                    console.error("Error searching creators:", error);
                    return [];
                }
            }
            
            // Rest of the methods from original VertexStorage class...
            async registerUser(username, password) {
                try {
                    if (username.includes(' ')) {
                        return { success: false, error: 'Username cannot contain spaces' };
                    }
                    
                    if (password === username) {
                        return { success: false, error: 'Password cannot be the same as username' };
                    }
                    
                    if (password.length < 6) {
                        return { success: false, error: 'Password must be at least 6 characters' };
                    }
                    
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        return { success: false, error: 'Username already taken' };
                    }
                    
                    const email = `${username}@vertexscripts.com`;
                    const userCredential = await createUserWithEmailAndPassword(this.auth, email, password);
                    
                    await setDoc(doc(this.db, "users", username), {
                        username: username,
                        email: email,
                        createdAt: serverTimestamp(),
                        isAdmin: username === 'plstealme2',
                        subscribers: 0,
                        bio: '',
                        avatarUrl: '',
                        totalViews: 0,
                        totalLikes: 0,
                        totalScripts: 0
                    });
                    
                    return { success: true, user: { username: username, isAdmin: username === 'plstealme2' } };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            async loginUser(username, password) {
                try {
                    const email = `${username}@vertexscripts.com`;
                    await signInWithEmailAndPassword(this.auth, email, password);
                    
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        return { 
                            success: true, 
                            user: { 
                                username: username,
                                isAdmin: userDoc.data().isAdmin || false
                            } 
                        };
                    }
                    return { success: true, user: { username: username, isAdmin: false } };
                } catch (error) {
                    return { success: false, error: 'Invalid username or password' };
                }
            }
            
            async getCurrentUser() {
                if (!this.currentUser) return null;
                return {
                    username: this.currentUser.username,
                    isAdmin: this.currentUser.isAdmin || false,
                    avatarUrl: this.currentUser.avatarUrl || '',
                    bio: this.currentUser.bio || '',
                    subscribers: this.currentUser.subscribers || 0
                };
            }
            
            async logoutUser() {
                await signOut(this.auth);
            }
            
            async deleteUser(username) {
                try {
                    await deleteDoc(doc(this.db, "users", username));
                    
                    const scriptsQuery = query(collection(this.db, "scripts"), where("uploader", "==", username));
                    const scriptsSnapshot = await getDocs(scriptsQuery);
                    
                    const deletePromises = [];
                    scriptsSnapshot.forEach((scriptDoc) => {
                        deletePromises.push(deleteDoc(doc(this.db, "scripts", scriptDoc.id)));
                    });
                    await Promise.all(deletePromises);
                    
                    await deleteDoc(doc(this.db, "interactions", username));
                    await deleteDoc(doc(this.db, "subscriptions", username));
                    
                    const user = this.auth.currentUser;
                    if (user) {
                        await deleteUser(user);
                    }
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            async saveScript(script) {
                try {
                    script.createdAt = serverTimestamp();
                    script.updatedAt = serverTimestamp();
                    script.likes = script.likes || 0;
                    script.dislikes = script.dislikes || 0;
                    script.views = script.views || 0;
                    
                    const docRef = await addDoc(collection(this.db, "scripts"), script);
                    script.id = docRef.id;
                    
                    await updateDoc(docRef, { id: docRef.id });
                    
                    await this.updateHashtags(script);
                    
                    // Update user's script count
                    await updateDoc(doc(this.db, "users", script.uploader), {
                        totalScripts: increment(1)
                    });
                    
                    // Send notifications to subscribers
                    await this.notifySubscribers(script.uploader, script.name, script.id);
                    
                    return { success: true, script: script };
                } catch (error) {
                    console.error("Error saving script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            async notifySubscribers(creatorUsername, scriptName, scriptId) {
                try {
                    const subscriptionsQuery = query(collection(this.db, "subscriptions"), 
                                                     where("creator", "==", creatorUsername));
                    const snapshot = await getDocs(subscriptionsQuery);
                    
                    const notifications = [];
                    snapshot.forEach(doc => {
                        const subscriber = doc.data().subscriber;
                        notifications.push(
                            addDoc(collection(this.db, "notifications"), {
                                subscriber: subscriber,
                                creator: creatorUsername,
                                scriptId: scriptId,
                                scriptName: scriptName,
                                type: 'new_upload',
                                read: false,
                                createdAt: serverTimestamp()
                            })
                        );
                    });
                    
                    await Promise.all(notifications);
                } catch (error) {
                    console.error("Error sending notifications:", error);
                }
            }
            
            async getScripts() {
                try {
                    const q = query(collection(this.db, "scripts"), orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.createdAt && data.createdAt.toDate) {
                            data.createdAt = data.createdAt.toDate();
                        }
                        data.uploadDate = formatTimeAgo(data.createdAt);
                        scripts.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting scripts:', error);
                    return [];
                }
            }
            
            async getScriptsByUser(username) {
                try {
                    const q = query(collection(this.db, "scripts"), 
                                  where("uploader", "==", username),
                                  orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.createdAt && data.createdAt.toDate) {
                            data.createdAt = data.createdAt.toDate();
                        }
                        data.uploadDate = formatTimeAgo(data.createdAt);
                        scripts.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting user scripts:', error);
                    return [];
                }
            }
            
            async deleteScript(scriptId) {
                try {
                    const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                    if (scriptDoc.exists()) {
                        const script = scriptDoc.data();
                        await this.removeScriptFromHashtags({ id: scriptId, ...script });
                        
                        // Update user's script count
                        await updateDoc(doc(this.db, "users", script.uploader), {
                            totalScripts: increment(-1)
                        });
                    }
                    
                    await deleteDoc(doc(this.db, "scripts", scriptId));
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            async updateScript(updatedScript) {
                try {
                    updatedScript.updatedAt = serverTimestamp();
                    const { id, ...scriptData } = updatedScript;
                    await updateDoc(doc(this.db, "scripts", id), scriptData);
                    return { success: true };
                } catch (error) {
                    console.error("Error updating script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            async updateHashtags(script) {
                if (!script.hashtags || !script.hashtags.length) return;
                
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    
                    if (!hashtagDoc.exists()) {
                        await setDoc(hashtagRef, {
                            count: 1,
                            scripts: [script.id],
                            createdAt: serverTimestamp()
                        });
                    } else {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        if (!scripts.includes(script.id)) {
                            scripts.push(script.id);
                            await updateDoc(hashtagRef, {
                                count: scripts.length,
                                scripts: scripts,
                                updatedAt: serverTimestamp()
                            });
                        }
                    }
                }
            }
            
            async removeScriptFromHashtags(script) {
                if (!script.hashtags || !script.hashtags.length) return;
                
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    
                    if (hashtagDoc.exists()) {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        const index = scripts.indexOf(script.id);
                        
                        if (index > -1) {
                            scripts.splice(index, 1);
                            
                            if (scripts.length === 0) {
                                await deleteDoc(hashtagRef);
                            } else {
                                await updateDoc(hashtagRef, {
                                    count: scripts.length,
                                    scripts: scripts,
                                    updatedAt: serverTimestamp()
                                });
                            }
                        }
                    }
                }
            }
            
            async getHashtags() {
                try {
                    const snapshot = await getDocs(collection(this.db, "hashtags"));
                    const hashtags = {};
                    
                    snapshot.forEach(doc => {
                        hashtags[doc.id] = doc.data();
                    });
                    
                    return hashtags;
                } catch (error) {
                    console.error('Error getting hashtags:', error);
                    return {};
                }
            }
            
            async getScriptsByHashtag(hashtag) {
                try {
                    const hashtagDoc = await getDoc(doc(this.db, "hashtags", hashtag));
                    
                    if (!hashtagDoc.exists()) return [];
                    
                    const data = hashtagDoc.data();
                    const scriptIds = data.scripts || [];
                    
                    if (scriptIds.length === 0) return [];
                    
                    const scripts = [];
                    for (const scriptId of scriptIds) {
                        const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                        if (scriptDoc.exists()) {
                            const scriptData = scriptDoc.data();
                            if (scriptData.createdAt && scriptData.createdAt.toDate) {
                                scriptData.createdAt = scriptData.createdAt.toDate();
                            }
                            scriptData.uploadDate = formatTimeAgo(scriptData.createdAt);
                            scripts.push({ id: scriptDoc.id, ...scriptData });
                        }
                    }
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting scripts by hashtag:', error);
                    return [];
                }
            }
            
            async recordInteraction(username, scriptId, type) {
                try {
                    const interactionRef = doc(this.db, "interactions", `${username}_${scriptId}`);
                    const interactionDoc = await getDoc(interactionRef);
                    
                    let currentState = { liked: false, disliked: false };
                    let scriptUpdate = {};
                    
                    if (interactionDoc.exists()) {
                        currentState = interactionDoc.data();
                        
                        if (type === 'like') {
                            if (currentState.liked) {
                                await updateDoc(interactionRef, { liked: false });
                                scriptUpdate.likes = increment(-1);
                            } else {
                                await updateDoc(interactionRef, { 
                                    liked: true, 
                                    disliked: false 
                                });
                                scriptUpdate.likes = increment(1);
                                if (currentState.disliked) {
                                    scriptUpdate.dislikes = increment(-1);
                                }
                            }
                        } else if (type === 'dislike') {
                            if (currentState.disliked) {
                                await updateDoc(interactionRef, { disliked: false });
                                scriptUpdate.dislikes = increment(-1);
                            } else {
                                await updateDoc(interactionRef, { 
                                    disliked: true, 
                                    liked: false 
                                });
                                scriptUpdate.dislikes = increment(1);
                                if (currentState.liked) {
                                    scriptUpdate.likes = increment(-1);
                                }
                            }
                        }
                    } else {
                        if (type === 'like') {
                            await setDoc(interactionRef, { liked: true, disliked: false });
                            scriptUpdate.likes = increment(1);
                        } else if (type === 'dislike') {
                            await setDoc(interactionRef, { liked: false, disliked: true });
                            scriptUpdate.dislikes = increment(1);
                        }
                    }
                    
                    if (Object.keys(scriptUpdate).length > 0) {
                        await updateDoc(doc(this.db, "scripts", scriptId), scriptUpdate);
                    }
                    
                    const updatedDoc = await getDoc(interactionRef);
                    const updatedData = updatedDoc.exists() ? updatedDoc.data() : { liked: false, disliked: false };
                    
                    return { 
                        success: true, 
                        liked: updatedData.liked || false, 
                        disliked: updatedData.disliked || false 
                    };
                } catch (error) {
                    console.error('Error recording interaction:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async getInteractionState(username, scriptId) {
                try {
                    const interactionDoc = await getDoc(doc(this.db, "interactions", `${username}_${scriptId}`));
                    
                    if (interactionDoc.exists()) {
                        const data = interactionDoc.data();
                        return {
                            liked: data.liked || false,
                            disliked: data.disliked || false
                        };
                    }
                    return { liked: false, disliked: false };
                } catch (error) {
                    console.error('Error getting interaction state:', error);
                    return { liked: false, disliked: false };
                }
            }
            
            async recordScriptView(username, scriptId) {
                try {
                    const viewRef = doc(this.db, "views", `${scriptId}_${username}`);
                    const viewDoc = await getDoc(viewRef);
                    
                    if (!viewDoc.exists()) {
                        await setDoc(viewRef, {
                            username: username,
                            scriptId: scriptId,
                            viewedAt: serverTimestamp()
                        });
                        
                        await updateDoc(doc(this.db, "scripts", scriptId), {
                            views: increment(1)
                        });
                        
                        // Update user's total views
                        const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                        if (scriptDoc.exists()) {
                            const uploader = scriptDoc.data().uploader;
                            await updateDoc(doc(this.db, "users", uploader), {
                                totalViews: increment(1)
                            });
                        }
                        
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Error recording view:', error);
                    return false;
                }
            }
            
            async subscribe(subscriber, creator) {
                if (subscriber === creator) return false;
                
                try {
                    const subscriptionRef = doc(this.db, "subscriptions", `${subscriber}_${creator}`);
                    const subscriptionDoc = await getDoc(subscriptionRef);
                    
                    if (subscriptionDoc.exists()) {
                        await deleteDoc(subscriptionRef);
                        await updateDoc(doc(this.db, "users", creator), {
                            subscribers: increment(-1)
                        });
                        return false;
                    } else {
                        await setDoc(subscriptionRef, {
                            subscriber: subscriber,
                            creator: creator,
                            subscribedAt: serverTimestamp()
                        });
                        await updateDoc(doc(this.db, "users", creator), {
                            subscribers: increment(1)
                        });
                        return true;
                    }
                } catch (error) {
                    console.error('Error toggling subscription:', error);
                    return false;
                }
            }
            
            async isSubscribed(subscriber, creator) {
                try {
                    const subscriptionDoc = await getDoc(doc(this.db, "subscriptions", `${subscriber}_${creator}`));
                    return subscriptionDoc.exists();
                } catch (error) {
                    console.error('Error checking subscription:', error);
                    return false;
                }
            }
            
            async getSubscriptions(username) {
                try {
                    const q = query(collection(this.db, "subscriptions"), 
                                  where("subscriber", "==", username));
                    const snapshot = await getDocs(q);
                    
                    const subscriptions = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        subscriptions.push(data.creator);
                    });
                    
                    return subscriptions;
                } catch (error) {
                    console.error('Error getting subscriptions:', error);
                    return [];
                }
            }
            
            async getSubscribers(username) {
                try {
                    const q = query(collection(this.db, "subscriptions"), 
                                  where("creator", "==", username));
                    const snapshot = await getDocs(q);
                    
                    return snapshot.size;
                } catch (error) {
                    console.error('Error getting subscribers:', error);
                    return 0;
                }
            }
            
            async getUserChannelStats(username) {
                try {
                    const scripts = await this.getScriptsByUser(username);
                    let totalLikes = 0;
                    let totalDislikes = 0;
                    let totalViews = 0;
                    
                    scripts.forEach(script => {
                        totalLikes += script.likes || 0;
                        totalDislikes += script.dislikes || 0;
                        totalViews += script.views || 0;
                    });
                    
                    const subscribers = await this.getSubscribers(username);
                    
                    return {
                        scriptsCount: scripts.length,
                        totalLikes,
                        totalDislikes,
                        totalViews,
                        subscribers
                    };
                } catch (error) {
                    console.error('Error getting channel stats:', error);
                    return {
                        scriptsCount: 0,
                        totalLikes: 0,
                        totalDislikes: 0,
                        totalViews: 0,
                        subscribers: 0
                    };
                }
            }
            
            async getCreatorProfile(username) {
                try {
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (!userDoc.exists()) return null;
                    
                    const userData = userDoc.data();
                    const scripts = await this.getScriptsByUser(username);
                    const subscribers = await this.getSubscribers(username);
                    
                    return {
                        username: username,
                        avatarUrl: userData.avatarUrl || '',
                        bio: userData.bio || '',
                        joinDate: userData.createdAt,
                        subscribers: subscribers,
                        scriptsCount: scripts.length,
                        totalViews: userData.totalViews || 0
                    };
                } catch (error) {
                    console.error('Error getting creator profile:', error);
                    return null;
                }
            }
        }

        // ============ UTILITY FUNCTIONS ============
        function formatTimeAgo(date) {
            if (!date) return 'Unknown';
            
            const now = new Date();
            const past = date instanceof Date ? date : new Date(date);
            const diff = now - past;
            
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);
            
            if (years > 0) return `${years}y ago`;
            if (months > 0) return `${months}mo ago`;
            if (weeks > 0) return `${weeks}w ago`;
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            if (seconds > 0) return `${seconds}s ago`;
            return 'Just now';
        }
        
        function calculateFYPBoost(subscribers) {
            if (subscribers >= 10000) return 1000;
            if (subscribers >= 5000) return 800;
            if (subscribers >= 1000) return 500;
            if (subscribers >= 500) return 300;
            if (subscribers >= 100) return 100;
            if (subscribers >= 50) return 50;
            if (subscribers >= 10) return 20;
            return 0;
        }
        
        function extractUsernameFromLink(link) {
            if (!link) return '';
            
            // Remove protocol and domain
            let username = link.replace(/^https?:\/\/(www\.)?(tiktok\.com|youtube\.com|youtu\.be|instagram\.com|twitch\.tv|discord\.gg)\/?/, '');
            
            // Remove @ symbol if present
            username = username.replace(/^@/, '');
            
            // Remove trailing slashes and query parameters
            username = username.split('/')[0].split('?')[0];
            
            return username;
        }

        // ============ MAIN APPLICATION ============
        const storage = new EnhancedVertexStorage();
        let currentUser = null;
        let scripts = [];
        let nextId = 1;
        let currentUnlockScript = null;
        let currentStep = 0;
        let countdown = 20;
        let countdownInterval = null;
        let completedSteps = new Set();
        let stepTimers = {};
        let scriptToDelete = null;
        let currentViewScript = null;
        let uploadType = 'thumbnail';
        let currentWatchOption = 'watch-here';
        let activeHashtag = null;
        let dropdownTimeout = null;
        let viewingCreatorProfile = null;
        let selectedPlatform = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            window.appInitialized = true;
            setupEventListeners();
            
            setTimeout(async () => {
                currentUser = await storage.getCurrentUser();
                if (currentUser) {
                    showApp();
                } else {
                    showAuth();
                }
                
                await loadScripts();
                updateStats();
                
                // Request notification permission
                if (currentUser && Notification.permission === 'default') {
                    showNotificationPermission();
                }
            }, 1000);
        });

        function setupEventListeners() {
            // Auth forms
            document.getElementById('loginForm')?.addEventListener('submit', handleLogin);
            document.getElementById('registerForm')?.addEventListener('submit', handleRegister);
            
            // Navigation
            document.getElementById('pcDashboardBtn')?.addEventListener('click', showDashboard);
            document.getElementById('pcUploadBtn')?.addEventListener('click', showUploadForm);
            document.getElementById('pcChannelBtn')?.addEventListener('click', showChannel);
            document.getElementById('pcSubscriptionsBtn')?.addEventListener('click', showSubscriptions);
            document.getElementById('pcHashtagExplorerBtn')?.addEventListener('click', showHashtagExplorer);
            document.getElementById('mobileDashboardBtn')?.addEventListener('click', showDashboard);
            document.getElementById('mobileUploadBtn')?.addEventListener('click', showUploadForm);
            document.getElementById('mobileChannelBtn')?.addEventListener('click', showChannel);
            document.getElementById('mobileSubscriptionsBtn2')?.addEventListener('click', showSubscriptions);
            
            // Profile
            document.getElementById('pcEditProfileBtn')?.addEventListener('click', showEditProfile);
            document.getElementById('mobileEditProfileBtn')?.addEventListener('click', showEditProfile);
            document.getElementById('saveProfileBtn')?.addEventListener('click', saveProfile);
            document.getElementById('cancelProfileEditBtn')?.addEventListener('click', closeEditProfile);
            document.getElementById('avatarUpload')?.addEventListener('change', handleAvatarUpload);
            
            // Search
            document.getElementById('pcSearchInput')?.addEventListener('input', handleSearch);
            document.getElementById('mobileSearchInput')?.addEventListener('input', handleSearch);
            
            // Social platform selection
            document.querySelectorAll('.platform-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectPlatform(this.dataset.platform);
                });
            });
            
            // Add custom step
            document.getElementById('addCustomStepBtn')?.addEventListener('click', addCustomStep);
            
            // Notifications
            document.getElementById('enableNotificationsBtn')?.addEventListener('click', requestNotificationPermission);
            
            // Creator profile
            document.getElementById('creatorSubscribeBtn')?.addEventListener('click', handleCreatorSubscribe);
            document.getElementById('backFromCreatorProfile')?.addEventListener('click', hideCreatorProfile);
            
            // Dropdowns
            document.querySelectorAll('.dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdown = this.closest('.dropdown');
                    dropdown.classList.toggle('active');
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown.active').forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
            });
            
            // Mobile menu
            document.getElementById('mobileMenuBtn')?.addEventListener('click', toggleMobileMenu);
            
            // Rest of event listeners from original code...
        }

        function selectPlatform(platform) {
            selectedPlatform = platform;
            
            // Update UI
            document.querySelectorAll('.platform-option').forEach(option => {
                option.classList.toggle('active', option.dataset.platform === platform);
            });
            
            // Show platform-specific actions
            const socialActions = document.getElementById('socialActions');
            socialActions.innerHTML = '';
            socialActions.classList.add('active');
            
            switch(platform) {
                case 'youtube':
                    socialActions.innerHTML = `
                        <div class="social-action-option" data-action="subscribe" data-base="https://youtube.com/@">
                            <i class="fab fa-youtube"></i>
                            <span>Subscribe to Channel</span>
                        </div>
                        <div class="social-action-option" data-action="like" data-base="https://youtube.com/watch?v=">
                            <i class="fas fa-thumbs-up"></i>
                            <span>Like Video</span>
                        </div>
                        <div class="social-action-option" data-action="comment" data-base="https://youtube.com/watch?v=">
                            <i class="fas fa-comment"></i>
                            <span>Comment on Video</span>
                        </div>
                    `;
                    break;
                    
                case 'tiktok':
                    socialActions.innerHTML = `
                        <div class="social-action-option" data-action="follow" data-base="https://tiktok.com/@">
                            <i class="fab fa-tiktok"></i>
                            <span>Follow User</span>
                        </div>
                        <div class="social-action-option" data-action="like" data-base="https://tiktok.com/@">
                            <i class="fas fa-heart"></i>
                            <span>Like Video</span>
                        </div>
                        <div class="social-action-option" data-action="comment" data-base="https://tiktok.com/@">
                            <i class="fas fa-comment"></i>
                            <span>Comment on Video</span>
                        </div>
                    `;
                    break;
                    
                case 'instagram':
                    socialActions.innerHTML = `
                        <div class="social-action-option" data-action="follow" data-base="https://instagram.com/">
                            <i class="fab fa-instagram"></i>
                            <span>Follow User</span>
                        </div>
                        <div class="social-action-option" data-action="like" data-base="https://instagram.com/p/">
                            <i class="fas fa-heart"></i>
                            <span>Like Post</span>
                        </div>
                        <div class="social-action-option" data-action="comment" data-base="https://instagram.com/p/">
                            <i class="fas fa-comment"></i>
                            <span>Comment on Post</span>
                        </div>
                    `;
                    break;
                    
                case 'twitch':
                    socialActions.innerHTML = `
                        <div class="social-action-option" data-action="follow" data-base="https://twitch.tv/">
                            <i class="fab fa-twitch"></i>
                            <span>Follow Channel</span>
                        </div>
                        <div class="social-action-option" data-action="watch" data-base="https://twitch.tv/">
                            <i class="fas fa-eye"></i>
                            <span>Watch Stream</span>
                        </div>
                    `;
                    break;
                    
                case 'discord':
                    socialActions.innerHTML = `
                        <div class="social-action-option" data-action="join" data-base="https://discord.gg/">
                            <i class="fab fa-discord"></i>
                            <span>Join Server</span>
                        </div>
                    `;
                    break;
            }
            
            // Add click handlers to action options
            socialActions.querySelectorAll('.social-action-option').forEach(option => {
                option.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const baseUrl = this.dataset.base;
                    addSocialStep(platform, action, baseUrl);
                });
            });
        }

        function addSocialStep(platform, action, baseUrl) {
            const stepsContainer = document.getElementById('stepsContainer');
            const stepNumber = document.querySelectorAll('.step-container').length + 1;
            
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container';
            stepContainer.setAttribute('data-step', stepNumber);
            
            let stepName = '';
            let placeholder = '';
            
            switch(platform) {
                case 'youtube':
                    if (action === 'subscribe') {
                        stepName = `Subscribe to YouTube Channel`;
                        placeholder = 'Enter YouTube username (without @)';
                    } else if (action === 'like' || action === 'comment') {
                        stepName = `${action.charAt(0).toUpperCase() + action.slice(1)} YouTube Video`;
                        placeholder = 'Enter video ID (e.g., dQw4w9WgXcQ)';
                    }
                    break;
                    
                case 'tiktok':
                    stepName = `${action.charAt(0).toUpperCase() + action.slice(1)} TikTok`;
                    placeholder = 'Enter TikTok username or video ID';
                    break;
                    
                case 'instagram':
                    stepName = `${action.charAt(0).toUpperCase() + action.slice(1)} Instagram`;
                    placeholder = 'Enter Instagram username or post ID';
                    break;
                    
                case 'twitch':
                    stepName = `${action.charAt(0).toUpperCase() + action.slice(1)} Twitch Channel`;
                    placeholder = 'Enter Twitch username';
                    break;
                    
                case 'discord':
                    stepName = 'Join Discord Server';
                    placeholder = 'Enter Discord invite code';
                    break;
            }
            
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">${stepNumber}</span>
                        <input type="text" class="step-name-input" value="${stepName}" style="background: transparent; border: none; color: white; width: 200px; font-size: 14px;" readonly>
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <div class="social-input-group">
                    <input type="text" class="social-username" placeholder="${placeholder}" style="margin-bottom: 5px;">
                    <div class="step-preview" id="stepPreview${stepNumber}">
                        ${baseUrl}<span class="preview-username">[username]</span>
                    </div>
                </div>
                <input type="hidden" class="step-url" value="">
                <input type="hidden" class="step-platform" value="${platform}">
                <input type="hidden" class="step-action" value="${action}">
                <input type="hidden" class="step-base-url" value="${baseUrl}">
            `;
            
            stepsContainer.appendChild(stepContainer);
            
            // Update URL when username changes
            const usernameInput = stepContainer.querySelector('.social-username');
            const previewElement = stepContainer.querySelector('.step-preview');
            
            usernameInput.addEventListener('input', function() {
                const username = this.value.trim();
                const baseUrl = stepContainer.querySelector('.step-base-url').value;
                let finalUrl = baseUrl + username;
                
                // Handle special cases
                if (platform === 'tiktok' && action === 'like') {
                    // For TikTok likes, we need the full video URL
                    if (!username.includes('/')) {
                        finalUrl = `https://tiktok.com/@placeholder/video/${username}`;
                    }
                }
                
                stepContainer.querySelector('.step-url').value = finalUrl;
                previewElement.querySelector('.preview-username').textContent = username || '[username]';
                
                // Auto-format TikTok links
                if (platform === 'tiktok' && username.includes('tiktok.com')) {
                    const cleanedUsername = extractUsernameFromLink(username);
                    this.value = cleanedUsername;
                    finalUrl = baseUrl + cleanedUsername;
                    stepContainer.querySelector('.step-url').value = finalUrl;
                    previewElement.querySelector('.preview-username').textContent = cleanedUsername || '[username]';
                }
            });
            
            // Remove step button
            stepContainer.querySelector('.remove-step').addEventListener('click', function() {
                stepContainer.remove();
                updateStepNumbers();
            });
        }

        function addCustomStep() {
            const stepsContainer = document.getElementById('stepsContainer');
            const stepNumber = document.querySelectorAll('.step-container').length + 1;
            
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container';
            stepContainer.setAttribute('data-step', stepNumber);
            
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">${stepNumber}</span>
                        <input type="text" class="step-name-input" placeholder="Step name" style="background: transparent; border: none; color: white; width: 200px; font-size: 14px;">
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <input type="text" class="step-url" placeholder="https://example.com" required>
            `;
            
            stepsContainer.appendChild(stepContainer);
            
            stepContainer.querySelector('.remove-step').addEventListener('click', function() {
                stepContainer.remove();
                updateStepNumbers();
            });
        }

        function updateStepNumbers() {
            const stepContainers = document.querySelectorAll('.step-container');
            stepContainers.forEach((container, index) => {
                const stepNumber = index + 1;
                container.setAttribute('data-step', stepNumber);
                container.querySelector('.step-counter').textContent = stepNumber;
            });
        }

        async function handleSearch(e) {
            const query = e.target.value;
            const resultsContainer = e.target.id === 'pcSearchInput' ? 
                document.getElementById('searchResults') : 
                document.getElementById('mobileSearchResults');
            
            if (!query.trim()) {
                resultsContainer.classList.remove('active');
                return;
            }
            
            // Check if searching for creator
            if (query.startsWith('@')) {
                const creatorQuery = query.substring(1);
                const creators = await storage.searchCreators(creatorQuery);
                
                if (creators.length === 0) {
                    resultsContainer.classList.remove('active');
                    return;
                }
                
                resultsContainer.innerHTML = '';
                creators.forEach(creator => {
                    const result = document.createElement('div');
                    result.className = 'creator-result';
                    result.dataset.username = creator.username;
                    
                    // Get avatar initials
                    const initials = creator.username.substring(0, 2).toUpperCase();
                    
                    result.innerHTML = `
                        <div class="creator-avatar">
                            ${creator.avatarUrl ? 
                                `<img src="${creator.avatarUrl}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">` : 
                                initials}
                        </div>
                        <div class="creator-info">
                            <div class="creator-name">${creator.username}</div>
                            <div class="creator-stats">
                                <span>${creator.subscribers || 0} subscribers</span>
                                <span></span>
                                <span>${creator.totalScripts || 0} scripts</span>
                            </div>
                        </div>
                        <button class="subscribe-btn-small" data-username="${creator.username}">
                            Subscribe
                        </button>
                    `;
                    
                    resultsContainer.appendChild(result);
                });
                
                // Add click handlers
                resultsContainer.querySelectorAll('.creator-result').forEach(result => {
                    result.addEventListener('click', async function(e) {
                        if (!e.target.classList.contains('subscribe-btn-small')) {
                            const username = this.dataset.username;
                            await showCreatorProfile(username);
                        }
                    });
                });
                
                // Add subscribe button handlers
                resultsContainer.querySelectorAll('.subscribe-btn-small').forEach(btn => {
                    btn.addEventListener('click', async function(e) {
                        e.stopPropagation();
                        const creatorUsername = this.dataset.username;
                        await handleSearchSubscribe(creatorUsername, this);
                    });
                });
            } else {
                // Regular script search
                const filteredScripts = scripts.filter(script => 
                    script.name.toLowerCase().includes(query.toLowerCase()) ||
                    script.uploader.toLowerCase().includes(query.toLowerCase())
                );
                
                if (filteredScripts.length === 0) {
                    resultsContainer.classList.remove('active');
                    return;
                }
                
                resultsContainer.innerHTML = filteredScripts.map(script => `
                    <div class="creator-result" data-script-id="${script.id}">
                        <div class="creator-avatar" style="background: linear-gradient(135deg, #4bcffa, #5d79ff);">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="creator-info">
                            <div class="creator-name">${script.name}</div>
                            <div class="creator-stats">
                                <span>by ${script.uploader}</span>
                                <span></span>
                                <span>${script.views || 0} views</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                resultsContainer.querySelectorAll('.creator-result').forEach(result => {
                    result.addEventListener('click', function() {
                        const scriptId = this.dataset.scriptId;
                        const script = scripts.find(s => s.id === scriptId);
                        if (script) {
                            showScriptView(script);
                            resultsContainer.classList.remove('active');
                        }
                    });
                });
            }
            
            resultsContainer.classList.add('active');
        }

        async function handleSearchSubscribe(creatorUsername, button) {
            if (!currentUser) {
                showToast('Please login to subscribe');
                return;
            }
            
            if (creatorUsername === currentUser.username) {
                showToast("You can't subscribe to yourself");
                return;
            }
            
            const subscribed = await storage.subscribe(currentUser.username, creatorUsername);
            
            if (subscribed) {
                button.textContent = 'Subscribed';
                button.classList.add('subscribed');
                showToast(`Subscribed to ${creatorUsername}`);
            } else {
                button.textContent = 'Subscribe';
                button.classList.remove('subscribed');
                showToast(`Unsubscribed from ${creatorUsername}`);
            }
        }

        async function showCreatorProfile(username) {
            const profile = await storage.getCreatorProfile(username);
            if (!profile) {
                showToast('Creator not found');
                return;
            }
            
            viewingCreatorProfile = username;
            
            // Update UI
            document.getElementById('creatorProfileName').textContent = profile.username;
            document.getElementById('creatorProfileBio').textContent = profile.bio || 'No bio yet';
            document.getElementById('creatorScriptsCount').textContent = profile.scriptsCount;
            document.getElementById('creatorSubscribers').textContent = profile.subscribers;
            document.getElementById('creatorTotalViews').textContent = profile.totalViews || 0;
            document.getElementById('creatorScriptsTitle').textContent = profile.username;
            
            // Set avatar
            const avatarElement = document.getElementById('creatorProfileAvatar');
            avatarElement.innerHTML = profile.avatarUrl ? 
                `<img src="${profile.avatarUrl}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">` :
                profile.username.substring(0, 2).toUpperCase();
            
            // Update subscribe button
            const isSubscribed = await storage.isSubscribed(currentUser.username, username);
            const subscribeBtn = document.getElementById('creatorSubscribeBtn');
            subscribeBtn.innerHTML = isSubscribed ? 
                '<i class="fas fa-check"></i> Subscribed' : 
                '<i class="fas fa-bell"></i> Subscribe';
            subscribeBtn.classList.toggle('subscribed', isSubscribed);
            
            // Load creator's scripts
            const creatorScripts = await storage.getScriptsByUser(username);
            const scriptsGrid = document.getElementById('creatorScriptsGrid');
            
            if (creatorScripts.length === 0) {
                scriptsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-code"></i>
                        <h3>No scripts yet</h3>
                        <p>This creator hasn't uploaded any scripts</p>
                    </div>
                `;
            } else {
                scriptsGrid.innerHTML = '';
                creatorScripts.forEach(script => {
                    const scriptCard = createScriptCard(script);
                    scriptsGrid.appendChild(scriptCard);
                });
            }
            
            // Show profile, hide other sections
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('creatorProfile').classList.add('active');
            
            // Update PC navigation
            updatePCNavActive(null);
        }

        function hideCreatorProfile() {
            viewingCreatorProfile = null;
            document.getElementById('creatorProfile').classList.remove('active');
            showDashboard();
        }

        async function handleCreatorSubscribe() {
            if (!currentUser || !viewingCreatorProfile) return;
            
            if (viewingCreatorProfile === currentUser.username) {
                showToast("You can't subscribe to yourself");
                return;
            }
            
            const subscribed = await storage.subscribe(currentUser.username, viewingCreatorProfile);
            const subscribeBtn = document.getElementById('creatorSubscribeBtn');
            
            if (subscribed) {
                subscribeBtn.innerHTML = '<i class="fas fa-check"></i> Subscribed';
                subscribeBtn.classList.add('subscribed');
                document.getElementById('creatorSubscribers').textContent = 
                    parseInt(document.getElementById('creatorSubscribers').textContent) + 1;
                showToast(`Subscribed to ${viewingCreatorProfile}`);
            } else {
                subscribeBtn.innerHTML = '<i class="fas fa-bell"></i> Subscribe';
                subscribeBtn.classList.remove('subscribed');
                document.getElementById('creatorSubscribers').textContent = 
                    parseInt(document.getElementById('creatorSubscribers').textContent) - 1;
                showToast(`Unsubscribed from ${viewingCreatorProfile}`);
            }
        }

        function showEditProfile() {
            document.getElementById('profileEditModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Update form with current data
            document.getElementById('profileUsernameDisplay').textContent = currentUser.username;
            document.getElementById('profileBio').value = currentUser.bio || '';
            
            // Set avatar preview
            const avatarImage = document.getElementById('avatarImage');
            const avatarInitials = document.getElementById('avatarInitials');
            
            if (currentUser.avatarUrl) {
                avatarImage.src = currentUser.avatarUrl;
                avatarImage.style.display = 'block';
                avatarInitials.style.display = 'none';
            } else {
                avatarImage.style.display = 'none';
                avatarInitials.style.display = 'block';
                avatarInitials.textContent = currentUser.username.substring(0, 2).toUpperCase();
            }
        }

        async function handleAvatarUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showToast('Image must be less than 5MB');
                return;
            }
            
            try {
                showToast('Uploading avatar...');
                const avatarUrl = await storage.uploadAvatar(currentUser.username, file);
                
                // Update preview
                const avatarImage = document.getElementById('avatarImage');
                const avatarInitials = document.getElementById('avatarInitials');
                
                avatarImage.src = avatarUrl;
                avatarImage.style.display = 'block';
                avatarInitials.style.display = 'none';
                
                // Update current user data
                currentUser.avatarUrl = avatarUrl;
                
                showToast('Avatar updated successfully!');
            } catch (error) {
                showToast('Error uploading avatar');
                console.error(error);
            }
        }

        async function saveProfile() {
            const bio = document.getElementById('profileBio').value;
            
            try {
                await storage.updateUserProfile(currentUser.username, { bio: bio });
                currentUser.bio = bio;
                showToast('Profile updated successfully!');
                closeEditProfile();
            } catch (error) {
                showToast('Error updating profile');
            }
        }

        function closeEditProfile() {
            document.getElementById('profileEditModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('avatarUpload').value = '';
        }

        function showNotificationPermission() {
            document.getElementById('notificationPermission').classList.add('active');
        }

        async function requestNotificationPermission() {
            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    showToast('Notifications enabled!');
                    document.getElementById('notificationPermission').classList.remove('active');
                    
                    // Subscribe to push notifications (simplified)
                    if ('serviceWorker' in navigator && 'PushManager' in window) {
                        try {
                            const registration = await navigator.serviceWorker.register('/sw.js');
                            console.log('Service Worker registered');
                        } catch (error) {
                            console.error('Service Worker registration failed:', error);
                        }
                    }
                } else {
                    showToast('Notifications permission denied');
                }
            } catch (error) {
                console.error('Error requesting notification permission:', error);
                showToast('Error enabling notifications');
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileDropdown');
            menu.classList.toggle('active');
        }

        // Update createScriptCard function to show time ago
        function createScriptCard(script) {
            const scriptCard = document.createElement('div');
            scriptCard.className = 'script-card';
            scriptCard.dataset.id = script.id;
            
            // Get avatar initials for uploader
            const uploaderInitials = script.uploader.substring(0, 2).toUpperCase();
            
            // Determine thumbnail
            let thumbnailHtml = '';
            if (script.youtubeVideo) {
                const videoId = extractYoutubeVideoId(script.youtubeVideo);
                thumbnailHtml = `
                    <div class="script-thumbnail youtube-thumbnail" onclick="event.stopPropagation(); window.open('${script.youtubeVideo}', '_blank')">
                        <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="${script.name}" loading="lazy">
                        <div class="play-button" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 0, 0, 0.8); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-play" style="color: white; font-size: 1rem;"></i>
                        </div>
                    </div>
                `;
            } else if (script.thumbnail) {
                thumbnailHtml = `
                    <div class="script-thumbnail">
                        <img src="${script.thumbnail}" alt="${script.name}" loading="lazy">
                    </div>
                `;
            } else {
                thumbnailHtml = `
                    <div class="script-thumbnail" style="background: linear-gradient(135deg, #4bcffa, #5d79ff); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-code" style="font-size: 2rem; color: white;"></i>
                    </div>
                `;
            }
            
            scriptCard.innerHTML = `
                ${thumbnailHtml}
                <div class="script-info">
                    <div class="script-title">${script.name}</div>
                    <div class="script-meta">
                        <div class="script-uploader" data-username="${script.uploader}" style="cursor: pointer;">
                            <div class="script-uploader-avatar">
                                ${uploaderInitials}
                            </div>
                            <span>${script.uploader}</span>
                        </div>
                        <div class="script-stats">
                            <span><i class="fas fa-thumbs-up"></i> ${script.likes || 0}</span>
                            <span><i class="fas fa-eye"></i> ${script.views || 0}</span>
                        </div>
                    </div>
                    <div class="time-ago">${script.uploadDate}</div>
                    <button class="btn unlock-script-btn" data-id="${script.id}" style="margin-top: auto; padding: 8px 12px; font-size: 0.9rem;">
                        <i class="fas fa-unlock-alt"></i> Unlock
                    </button>
                </div>
            `;
            
            // Make entire card clickable to view details
            scriptCard.addEventListener('click', function(e) {
                if (!e.target.closest('button') && !e.target.closest('.youtube-thumbnail') && !e.target.closest('.script-uploader')) {
                    showScriptView(script);
                }
            });
            
            // Unlock button
            scriptCard.querySelector('.unlock-script-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                startUnlockProcess(script);
            });
            
            // Uploader click - show creator profile
            scriptCard.querySelector('.script-uploader').addEventListener('click', function(e) {
                e.stopPropagation();
                const username = this.dataset.username;
                showCreatorProfile(username);
            });
            
            return scriptCard;
        }

        // Update showScriptView to include time ago
        async function showScriptView(script) {
            currentViewScript = script;
            
            if (currentUser) {
                await storage.recordScriptView(currentUser.username, script.id);
                await loadScripts();
                const updatedScripts = scripts.find(s => s.id === script.id);
                if (updatedScripts) {
                    currentViewScript = updatedScripts;
                }
            }
            
            // Update time ago in view
            const timeAgoElement = document.createElement('div');
            timeAgoElement.className = 'time-ago';
            timeAgoElement.textContent = script.uploadDate;
            
            // Add to script view modal (you need to update the modal HTML)
            // ... rest of showScriptView function
        }

        // Update uploadScript function to handle social steps
        async function uploadScript(e) {
            e.preventDefault();
            
            // ... existing upload validation ...
            
            // Get all steps including social steps
            const stepContainers = document.querySelectorAll('.step-container');
            const steps = [];
            
            stepContainers.forEach(container => {
                const urlInput = container.querySelector('.step-url');
                const nameInput = container.querySelector('.step-name-input');
                const platformInput = container.querySelector('.step-platform');
                const actionInput = container.querySelector('.step-action');
                
                if (urlInput.value) {
                    const step = {
                        url: urlInput.value,
                        name: nameInput?.value || 'Unlock Step'
                    };
                    
                    if (platformInput?.value) {
                        step.platform = platformInput.value;
                        step.action = actionInput?.value;
                    }
                    
                    steps.push(step);
                }
            });
            
            // ... rest of upload process ...
        }

        // Update calculateScriptScore to include FYP boost
        function calculateScriptScore(script) {
            let score = 0;
            
            score += (script.likes || 0) * 10;
            score -= (script.dislikes || 0) * 5;
            score += (script.views || 0) * 0.1;
            
            if (script.pinned) {
                score += 1000;
            }
            
            // FYP boost based on creator subscribers
            const creatorSubscribers = script.creatorSubscribers || 0;
            const fypBoost = calculateFYPBoost(creatorSubscribers);
            score += fypBoost;
            
            // Show FYP boost indicator for creators with subscribers
            if (fypBoost > 0 && document.querySelector('.fyp-boost')) {
                const fypElement = document.querySelector('.fyp-boost');
                fypElement.textContent = `FYP Boost: +${fypBoost} (${creatorSubscribers} subscribers)`;
                fypElement.classList.add('active');
            }
            
            const createdAt = script.createdAt || script.uploadDateTime;
            if (createdAt) {
                const ageInDays = (new Date() - new Date(createdAt)) / (1000 * 60 * 60 * 24);
                if (ageInDays < 7) {
                    score += 50 - (ageInDays * 5);
                }
            }
            
            if (script.hashtags) {
                const requiredHashtags = ['vertex', 'roblox', 'scripts'];
                const hasRequiredTags = requiredHashtags.every(tag => 
                    script.hashtags.includes(tag.toLowerCase())
                );
                if (hasRequiredTags) {
                    score += 50;
                }
                
                score += (script.hashtags.length - requiredHashtags.length) * 5;
            }
            
            return score;
        }

        // Helper function for YouTube video ID extraction
        function extractYoutubeVideoId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Toast notification function
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Update PC navigation active state
        function updatePCNavActive(active) {
            document.querySelectorAll('.pc-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (active === 'dashboard') {
                document.getElementById('pcDashboardBtn').classList.add('active');
            } else if (active === 'upload') {
                document.getElementById('pcUploadBtn').classList.add('active');
            } else if (active === 'channel') {
                document.getElementById('pcChannelBtn').classList.add('active');
            } else if (active === 'subscriptions') {
                document.getElementById('pcSubscriptionsBtn').classList.add('active');
            } else if (active === 'hashtag') {
                document.getElementById('pcHashtagExplorerBtn').classList.add('active');
            }
        }

        // Initialize the rest of the application...
        // (Include all other functions from the original code with the above modifications)
        
        // Note: This is a partial implementation showing the key new features.
        // You'll need to integrate these changes with the rest of your existing code.
    </script>
</body>
                    </html>
