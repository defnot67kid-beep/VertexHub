<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>VertexScripts - Advanced Script Uploader & Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: 0 20px;
        }
        
        /* PC Enhanced Header */
        .pc-enhanced-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .pc-header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .pc-header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .pc-nav {
            display: flex;
            gap: 20px;
        }
        
        .pc-nav-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .pc-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .pc-nav-btn.active {
            background: rgba(75, 207, 250, 0.2);
            border: 2px solid #4bcffa;
        }
        
        /* Hashtag Styles */
        .hashtag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .hashtag {
            background: rgba(75, 207, 250, 0.2);
            color: #4bcffa;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(75, 207, 250, 0.3);
        }
        
        .hashtag:hover {
            background: rgba(75, 207, 250, 0.3);
            transform: translateY(-2px);
        }
        
        .hashtag.required {
            background: rgba(255, 100, 100, 0.2);
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .hashtag-counter {
            font-size: 0.75rem;
            margin-left: 5px;
            opacity: 0.8;
        }
        
        /* Hashtag Explorer */
        .hashtag-explorer {
            display: none;
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .hashtag-explorer.active {
            display: block;
        }
        
        .hashtag-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hashtag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .hashtag-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hashtag-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }
        
        .hashtag-card .hashtag {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .hashtag-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        /* Enhanced Script Card for PC */
        .pc-script-card {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .pc-script-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .pc-script-thumbnail {
            height: 200px;
            width: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .pc-script-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .pc-script-card:hover .pc-script-thumbnail img {
            transform: scale(1.05);
        }
        
        .pc-script-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .pc-script-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }
        
        .pc-script-description {
            font-size: 0.95rem;
            opacity: 0.9;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .pc-script-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Enhanced View Modal */
        .enhanced-view-modal {
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .enhanced-view-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
        }
        
        .enhanced-video-section {
            grid-column: 1;
        }
        
        .enhanced-info-section {
            grid-column: 2;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }
        
        .enhanced-description {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .enhanced-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .enhanced-stat {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .enhanced-stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4bcffa;
            display: block;
        }
        
        .enhanced-stat-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Description Input with Counter */
        .description-container {
            position: relative;
        }
        
        .description-counter {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .description-counter.warning {
            color: #ff6b6b;
        }
        
        .description-counter.error {
            color: #ff0000;
            font-weight: bold;
        }
        
        /* Word Counter for Description */
        .word-counter {
            text-align: right;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        /* Advanced Search Bar */
        .advanced-search {
            position: relative;
            width: 300px;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 46, 0.98);
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
        }
        
        .search-suggestions.active {
            display: block;
        }
        
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s ease;
        }
        
        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .suggestion-hashtag {
            color: #4bcffa;
            font-size: 0.85rem;
        }
        
        /* New Auth Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .auth-tab.active {
            color: #4bcffa;
            border-bottom: 2px solid #4bcffa;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-error {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }
        
        .delete-account-btn {
            background: #ff6b6b;
            margin-top: 20px;
            width: 100%;
        }
        
        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: rgba(30, 30, 46, 0.95);
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            border-radius: 8px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 5px;
        }
        
        .dropdown.active .dropdown-content {
            display: block;
        }
        
        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s ease;
        }
        
        .dropdown-content a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Script View Modal */
        .script-view-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .script-view-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .script-view-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-view {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-view:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .script-view-body {
            padding: 25px;
        }
        
        .script-view-thumbnail {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        .script-view-thumbnail img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .video-player-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .video-player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
        }
        
        /* YouTube Watch Options */
        .watch-options {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .watch-option-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .watch-option-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .watch-option-btn.active {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
        }
        
        .watch-here-btn.active {
            background: rgba(75, 207, 250, 0.2);
            border-color: #4bcffa;
        }
        
        .youtube-thumbnail {
            position: relative;
            cursor: pointer;
        }
        
        .youtube-thumbnail:hover .play-button {
            transform: scale(1.1);
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            transition: all 0.3s ease;
        }
        
        .script-view-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            align-items: center;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .like-btn, .dislike-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            padding: 5px;
            position: relative;
        }
        
        .like-btn:hover {
            color: #4bcffa;
        }
        
        .dislike-btn:hover {
            color: #ff6b6b;
        }
        
        .like-btn.liked {
            color: #4bcffa;
        }
        
        .dislike-btn.disliked {
            color: #ff6b6b;
        }
        
        .subscribe-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .subscribe-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .subscribe-btn.subscribed {
            background: #4bcffa;
            color: #0c2461;
        }
        
        /* Channel View Styles */
        .channel-container {
            display: none;
        }
        
        .channel-header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .channel-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .channel-stat {
            text-align: center;
        }
        
        .channel-stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4bcffa;
        }
        
        .channel-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .channel-scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Subscriptions Container */
        .subscriptions-container {
            display: none;
        }
        
        .subscriptions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Pin Icon */
        .pin-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #ffd700;
            font-size: 1.2rem;
            z-index: 1;
        }
        
        .pin-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 5px;
        }
        
        .pin-btn.pinned {
            color: #ffd700;
        }
        
        /* Script Details in Card */
        .script-details {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .script-uploader {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .script-uploader i {
            color: #4bcffa;
        }
        
        /* Mobile Dropdown Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            .pc-enhanced-header {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .dropdown-btn {
                display: none;
            }
            
            .mobile-dropdown-content {
                display: none;
                position: fixed;
                top: 80px;
                left: 0;
                right: 0;
                background: rgba(30, 30, 46, 0.98);
                z-index: 1000;
                padding: 10px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                max-height: calc(100vh - 80px);
                overflow-y: auto;
            }
            
            .mobile-dropdown-content.active {
                display: block;
            }
            
            .mobile-dropdown-content a {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 15px;
                color: white;
                text-decoration: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                font-size: 1rem;
            }
            
            .header-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .search-container {
                flex: 1;
            }
            
            /* Auto-show dropdown when clicking upload on mobile */
            .mobile-dropdown-content.show-upload {
                display: block;
            }
            
            .watch-options {
                flex-direction: column;
            }
            
            .watch-option-btn {
                min-width: 100%;
            }
            
            .enhanced-view-content {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .enhanced-info-section {
                margin-top: 20px;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-only {
                display: none !important;
            }
            
            .pc-script-card {
                display: grid;
            }
            
            .enhanced-view-modal {
                display: flex !important;
            }
        }
        
        /* Updated Header */
        header {
            display: none;
        }
        
        @media (max-width: 768px) {
            header {
                display: flex;
                flex-direction: column;
                gap: 15px;
                padding: 15px 0;
                margin-bottom: 20px;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                position: relative;
            }
            
            .logo-section {
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
            }
            
            .user-info {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 0.9rem;
                opacity: 0.9;
            }
            
            .header-controls {
                display: flex;
                flex-direction: column;
                gap: 12px;
                width: 100%;
            }
            
            .search-container {
                position: relative;
                width: 100%;
            }
            
            .search-input {
                padding: 12px 15px 12px 45px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: white;
                font-size: 1rem;
                width: 100%;
                -webkit-appearance: none;
                font-size: 16px;
            }
            
            .search-icon {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: rgba(255, 255, 255, 0.6);
                pointer-events: none;
            }
            
            .upload-btn {
                background: linear-gradient(to right, #4bcffa, #5d79ff);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                width: 100%;
                font-size: 1rem;
                touch-action: manipulation;
            }
            
            .credit {
                font-size: 0.9rem;
                opacity: 0.8;
                background: rgba(0, 0, 0, 0.2);
                padding: 8px 15px;
                border-radius: 20px;
                text-align: center;
                width: 100%;
            }
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 1024px) {
            .main-content {
                gap: 30px;
                margin-bottom: 40px;
            }
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .card {
                padding: 25px;
            }
        }
        
        .card h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }
        
        @media (min-width: 768px) {
            .card h2 {
                margin-bottom: 20px;
                font-size: 1.6rem;
            }
        }
        
        .card h2 i {
            color: #4bcffa;
        }
        
        .dashboard-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .dashboard-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
            }
        }
        
        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-stats {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .dashboard-stats {
                gap: 20px;
                justify-content: flex-start;
            }
        }
        
        .stat {
            text-align: center;
            min-width: 80px;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .stat-number {
                font-size: 1.8rem;
            }
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        @media (min-width: 768px) {
            .stat-label {
                font-size: 0.9rem;
            }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .form-group {
                margin-bottom: 20px;
            }
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #ddd;
            font-size: 0.95rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            -webkit-appearance: none;
            min-height: 48px;
        }
        
        @media (min-width: 768px) {
            input, textarea {
                padding: 12px 15px;
            }
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #4bcffa;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            font-size: 16px;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 48px;
        }
        
        .file-upload-label:hover, .file-upload-label:active {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4bcffa;
        }
        
        .file-upload-label i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #4bcffa;
        }
        
        .thumbnail-preview {
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        
        .thumbnail-preview img {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .step-container {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .step-container {
                margin-bottom: 15px;
            }
        }
        
        .step-container.vertex-step {
            background: rgba(75, 207, 250, 0.1);
            border: 1px solid rgba(75, 207, 250, 0.3);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .step-title {
            font-weight: 600;
            color: #4bcffa;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .step-title i {
            color: #ff6b6b;
        }
        
        .vertex-step .step-title i {
            color: #4bcffa;
        }
        
        .remove-step {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            min-height: 32px;
            touch-action: manipulation;
        }
        
        .vertex-step .remove-step {
            display: none !important;
        }
        
        .step-url {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            width: 100%;
            margin-top: 5px;
        }
        
        .vertex-step .step-url {
            background: rgba(0, 0, 0, 0.2) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            cursor: not-allowed;
        }
        
        .btn {
            background: linear-gradient(to right, #4bcffa, #5d79ff);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            font-size: 1rem;
            touch-action: manipulation;
        }
        
        @media (min-width: 768px) {
            .btn {
                width: auto;
                padding: 12px 25px;
            }
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(75, 207, 250, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-danger {
            background: #ff6b6b;
        }
        
        .btn-danger:hover, .btn-secondary:active {
            background: #ff5252;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .button-group {
                flex-direction: row;
                gap: 10px;
                margin-top: 10px;
            }
        }
        
        .scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 640px) {
            .scripts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }
        }
        
        @media (min-width: 1024px) {
            .scripts-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 25px;
            }
        }
        
        .script-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .script-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .script-card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
        }
        
        .script-card:hover .script-card-actions {
            opacity: 1;
        }
        
        @media (hover: none) {
            .script-card-actions {
                opacity: 1;
            }
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .action-btn:hover, .action-btn:active {
            transform: scale(1.1);
        }
        
        .delete-btn:hover, .delete-btn:active {
            background: #ff6b6b;
        }
        
        .edit-btn:hover, .edit-btn:active {
            background: #4bcffa;
        }
        
        .script-thumbnail {
            height: 160px;
            width: 100%;
            background: linear-gradient(45deg, #0c2461, #1e3799);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4bcffa;
            font-size: 2.5rem;
        }
        
        @media (min-width: 768px) {
            .script-thumbnail {
                height: 180px;
                font-size: 3rem;
            }
        }
        
        .script-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .script-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 768px) {
            .script-info {
                padding: 20px;
            }
        }
        
        .script-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .script-title {
                font-size: 1.3rem;
            }
        }
        
        .script-author {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .script-meta {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .steps-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (min-width: 768px) {
            .step-dot {
                width: 10px;
                height: 10px;
            }
        }
        
        .step-dot.active {
            background: #4bcffa;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .modal-content {
                padding: 30px;
            }
        }
        
        .modal h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            color: #4bcffa;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .modal h3 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
        }
        
        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .timer {
                font-size: 3rem;
                margin: 25px 0;
            }
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .progress-bar {
                margin: 20px 0;
            }
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4bcffa, #5d79ff);
            width: 0%;
            transition: width 1s linear;
        }
        
        .step-check {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            transition: opacity 0.3s ease;
            text-align: left;
        }
        
        .step-check.completed {
            opacity: 0.85;
        }
        
        .step-check.completed .check-circle {
            border-color: #4bcffa;
        }
        
        .step-check.completed .check-circle i {
            opacity: 1;
        }
        
        .step-check.in-progress .check-circle {
            border-color: #4bcffa;
            border-top-color: transparent;
        }
        
        .check-circle {
            min-width: 40px;
            min-height: 40px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .check-circle {
                min-width: 50px;
                min-height: 50px;
                width: 50px;
                height: 50px;
                margin-right: 15px;
            }
        }
        
        .check-circle.spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .check-circle i {
            color: #4bcffa;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .check-circle i {
                font-size: 1.5rem;
            }
        }
        
        .step-text {
            text-align: left;
            flex: 1;
            overflow: hidden;
        }
        
        .step-name {
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-word;
        }
        
        .step-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        @media (min-width: 768px) {
            .step-desc {
                font-size: 0.9rem;
            }
        }
        
        .step-link-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 8px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            touch-action: manipulation;
        }
        
        @media (min-width: 768px) {
            .step-link-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }
        
        .step-link-btn:hover, .step-link-btn:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .step-link-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .unlock-btn {
            background: #00b894;
            margin-top: 20px;
            width: 100%;
        }
        
        .unlock-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.7;
            grid-column: 1 / -1;
        }
        
        @media (min-width: 768px) {
            .empty-state {
                padding: 60px 20px;
            }
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #4bcffa;
        }
        
        @media (min-width: 768px) {
            .empty-state i {
                font-size: 4rem;
                margin-bottom: 20px;
            }
        }
        
        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        @media (min-width: 768px) {
            .empty-state h3 {
                font-size: 1.5rem;
            }
        }
        
        .upload-container {
            display: none;
        }
        
        .back-to-dashboard {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .back-to-dashboard {
                width: auto;
                padding: 10px 20px;
                justify-content: flex-start;
            }
        }
        
        .back-to-dashboard:hover, .back-to-dashboard:active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        footer {
            text-align: center;
            padding: 20px 10px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
            width: 100%;
        }
        
        .step-counter {
            display: inline-block;
            background: #4bcffa;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            text-align: center;
            line-height: 22px;
            font-size: 0.75rem;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .step-counter {
                width: 24px;
                height: 24px;
                line-height: 24px;
                font-size: 0.8rem;
            }
        }
        
        .user-id-display {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            word-break: break-all;
        }
        
        /* Mobile optimizations */
        @media (max-width: 767px) {
            .hide-on-mobile {
                display: none !important;
            }
            
            .mobile-full-width {
                width: 100% !important;
            }
            
            .mobile-stack {
                flex-direction: column !important;
            }
        }
        
        /* Prevent text size adjustment on orientation change */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Improve touch scrolling */
        .modal-content, #stepChecks {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Loading animation for better UX */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #4bcffa;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Swipe gestures support */
        @media (hover: none) and (pointer: coarse) {
            .script-card {
                cursor: pointer;
            }
            
            .btn, .upload-btn, .action-btn {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Toast styles */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            animation: fadeInOut 3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        /* Like/Dislike Animation */
        .like-btn .count, .dislike-btn .count {
            transition: transform 0.3s ease;
        }
        
        .like-btn.liked .count, .dislike-btn.disliked .count {
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Disabled state for rapid clicking */
        .like-btn:disabled, .dislike-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Logout Button */
        .logout-btn {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Login</button>
                <button class="auth-tab" id="registerTab">Register</button>
            </div>
            
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" required>
                </div>
                
                <div class="auth-error" id="loginError"></div>
                
                <button type="submit" class="btn">Login</button>
            </form>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerUsername">Username</label>
                    <input type="text" id="registerUsername" placeholder="Choose username" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Choose password" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm password" required>
                </div>
                
                <div class="auth-error" id="registerError"></div>
                
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>
    
    <!-- Main Application Container -->
    <div id="appContainer" style="display: none;">
        <!-- PC Enhanced Header -->
        <div class="pc-enhanced-header">
            <div class="pc-header-left">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <h1>VertexScripts</h1>
                </div>
                
                <div class="pc-nav">
                    <button class="pc-nav-btn active" id="pcDashboardBtn">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="pc-nav-btn" id="pcUploadBtn">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                    <button class="pc-nav-btn" id="pcChannelBtn">
                        <i class="fas fa-user"></i> My Channel
                    </button>
                    <button class="pc-nav-btn" id="pcSubscriptionsBtn">
                        <i class="fas fa-bell"></i> Subscriptions
                    </button>
                    <button class="pc-nav-btn" id="pcHashtagExplorerBtn">
                        <i class="fas fa-hashtag"></i> Hashtags
                    </button>
                </div>
            </div>
            
            <div class="pc-header-right">
                <div class="advanced-search">
                    <input type="text" class="search-input" id="pcSearchInput" placeholder="Search scripts, hashtags, users...">
                    <i class="fas fa-search search-icon"></i>
                    <div class="search-suggestions" id="searchSuggestions"></div>
                </div>
                
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <i class="fas fa-user-circle"></i>
                        <span id="pcUsernameDisplay"></span>
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" id="pcViewChannelBtn">
                            <i class="fas fa-user"></i> My Channel
                        </a>
                        <a href="#" id="pcSubscriptionsBtn2">
                            <i class="fas fa-bell"></i> Subscriptions
                        </a>
                        <a href="#" id="pcDeleteAccountBtn">
                            <i class="fas fa-trash"></i> Delete Account
                        </a>
                        <a href="#" id="pcLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Header -->
        <header class="mobile-only">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-code"></i>
                    <h1>VertexScripts</h1>
                </div>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="user-info">
                    <span id="currentUserDisplay"></span>
                    <div class="dropdown">
                        <button class="dropdown-btn">
                            <i class="fas fa-user-circle"></i>
                            <span id="usernameDisplay"></span>
                            <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" id="viewChannelBtn">
                                <i class="fas fa-user"></i> My Channel
                            </a>
                            <a href="#" id="subscriptionsBtn">
                                <i class="fas fa-bell"></i> Subscriptions
                            </a>
                            <a href="#" id="deleteAccountBtn">
                                <i class="fas fa-trash"></i> Delete Account
                            </a>
                            <a href="#" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mobile-dropdown-content" id="mobileDropdown">
                <a href="#" id="mobileViewChannelBtn">
                    <i class="fas fa-user"></i> My Channel
                </a>
                <a href="#" id="mobileSubscriptionsBtn">
                    <i class="fas fa-bell"></i> Subscriptions
                </a>
                <a href="#" id="mobileHashtagExplorerBtn">
                    <i class="fas fa-hashtag"></i> Hashtag Explorer
                </a>
                <a href="#" id="mobileDeleteAccountBtn">
                    <i class="fas fa-trash"></i> Delete Account
                </a>
                <a href="#" id="mobileLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
            
            <div class="header-controls">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search scripts...">
                </div>
                <button class="upload-btn" id="showUploadBtn">
                    <i class="fas fa-upload"></i> Upload Script
                </button>
                <div class="credit">VertexScripts</div>
            </div>
        </header>
        
        <div class="container">
            <main class="main-content">
                <!-- Hashtag Explorer -->
                <section id="hashtagExplorer" class="card hashtag-explorer">
                    <div class="hashtag-header">
                        <h2><i class="fas fa-hashtag"></i> Hashtag Explorer</h2>
                        <button class="back-to-dashboard" id="backToDashboardFromHashtag">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </button>
                    </div>
                    <p>Discover scripts by hashtags. Click any hashtag to see all scripts using it.</p>
                    
                    <div id="hashtagList" class="hashtag-grid">
                        <!-- Hashtags will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Channel View Section -->
                <section id="channelContainer" class="card channel-container">
                    <button class="back-to-dashboard" id="backToDashboardFromChannel">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <div class="channel-header">
                        <h2><i class="fas fa-user"></i> My Channel</h2>
                        <p>Welcome to your channel, <span id="channelUsername"></span>!</p>
                        
                        <div class="channel-stats">
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelSubscribers">0</div>
                                <div class="channel-stat-label">Subscribers</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelTotalLikes">0</div>
                                <div class="channel-stat-label">Total Likes</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelTotalViews">0</div>
                                <div class="channel-stat-label">Total Views</div>
                            </div>
                            <div class="channel-stat">
                                <div class="channel-stat-number" id="channelScriptsCount">0</div>
                                <div class="channel-stat-label">Scripts</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-code"></i> My Scripts</h3>
                    
                    <div id="channelScriptsList" class="channel-scripts-grid">
                        <!-- User's scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Subscriptions Section -->
                <section id="subscriptionsContainer" class="card subscriptions-container">
                    <button class="back-to-dashboard" id="backToDashboardFromSubs">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <h2><i class="fas fa-bell"></i> Subscriptions</h2>
                    <p>Latest scripts from creators you follow</p>
                    
                    <div id="subscriptionsList" class="subscriptions-grid">
                        <!-- Subscription scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Dashboard Section -->
                <section id="dashboardContainer" class="card">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            <h2><i class="fas fa-tachometer-alt"></i> Script Dashboard</h2>
                        </div>
                        <div class="dashboard-stats">
                            <div class="stat">
                                <div class="stat-number" id="totalScripts">0</div>
                                <div class="stat-label">Total Scripts</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="myScripts">0</div>
                                <div class="stat-label">My Scripts</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="totalHashtags">0</div>
                                <div class="stat-label">Hashtags</div>
                            </div>
                        </div>
                    </div>
                    <p>Browse and manage all available scripts</p>
                    
                    <div id="scriptsList" class="scripts-grid">
                        <!-- Scripts will be dynamically added here -->
                    </div>
                </section>
                
                <!-- Upload Script Section -->
                <section id="uploadContainer" class="card upload-container">
                    <button class="back-to-dashboard" id="backToDashboardBtn">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    
                    <h2><i class="fas fa-upload"></i> Upload New Script</h2>
                    <form id="uploadForm">
                        <div class="form-group">
                            <label for="scriptName">Script Name</label>
                            <input type="text" id="scriptName" placeholder="Enter script name" required>
                        </div>
                        
                        <div class="form-group description-container">
                            <label for="scriptDescription">Description (Max 100 words)</label>
                            <textarea id="scriptDescription" placeholder="Describe your script... Include hashtags like #awesome #script" maxlength="500"></textarea>
                            <div class="word-counter">
                                <span id="wordCount">0</span>/100 words
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Script Thumbnail</label>
                            <div class="upload-options">
                                <button type="button" class="upload-option-btn active" id="thumbnailOptionBtn">
                                    <i class="fas fa-image"></i>
                                    <span>Upload Image</span>
                                </button>
                                <button type="button" class="upload-option-btn" id="youtubeOptionBtn">
                                    <i class="fab fa-youtube"></i>
                                    <span>YouTube Video</span>
                                </button>
                            </div>
                            
                            <!-- Image Upload Option -->
                            <div id="thumbnailUploadSection" class="thumbnail-section">
                                <div class="file-upload">
                                    <label for="thumbnailInput" class="file-upload-label">
                                        <i class="fas fa-image"></i>
                                        <span id="fileLabelText">Click to upload thumbnail image</span>
                                    </label>
                                    <input type="file" id="thumbnailInput" accept="image/*">
                                </div>
                                <div class="thumbnail-preview" id="thumbnailPreview">
                                    <img id="previewImage" src="" alt="Thumbnail Preview">
                                </div>
                            </div>
                            
                            <!-- YouTube Option -->
                            <div id="youtubeUploadSection" class="youtube-section" style="display: none;">
                                <input type="text" id="youtubeLink" placeholder="Enter YouTube video URL (e.g., https://youtube.com/watch?v=...)">
                                <div class="youtube-preview" id="youtubePreview">
                                    <!-- YouTube preview will be shown here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="scriptLink">Script Download Link</label>
                            <input type="text" id="scriptLink" placeholder="https://example.com/script.zip" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Required Hashtags</label>
                            <div class="hashtag-container">
                                <span class="hashtag required" data-tag="vertex">#vertex</span>
                                <span class="hashtag required" data-tag="roblox">#roblox</span>
                                <span class="hashtag required" data-tag="scripts">#scripts</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Additional Hashtags (Optional)</label>
                            <input type="text" id="additionalHashtags" placeholder="#awesome #free #game (separate with space)">
                            <small style="opacity: 0.7;">Add custom hashtags to help users discover your script</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Unlock Steps (Users must complete these before accessing your script)</label>
                            <div id="stepsContainer">
                                <!-- Vertex step is added by default and cannot be removed -->
                            </div>
                            
                            <div class="button-group">
                                <button type="button" id="addStepBtn" class="btn btn-secondary">
                                    <i class="fas fa-plus"></i> Add Step
                                </button>
                                <button type="button" id="addYoutubeStepBtn" class="btn btn-secondary">
                                    <i class="fab fa-youtube"></i> Add YouTube Step
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn mobile-full-width">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Script
                        </button>
                    </form>
                </section>
            </main>
            
            <!-- Unlock Modal -->
            <div id="unlockModal" class="modal">
                <div class="modal-content">
                    <h3>Unlock Script: <span id="unlockScriptName"></span></h3>
                    <p>Complete all steps to unlock the script</p>
                    
                    <div id="stepChecks">
                        <!-- Step checks will be dynamically added here -->
                    </div>
                    
                    <div class="progress-bar">
                        <div id="progress" class="progress"></div>
                    </div>
                    
                    <div class="timer" id="timer">20</div>
                    
                    <button id="accessLinkBtn" class="btn unlock-btn" disabled>
                        <i class="fas fa-lock"></i> Unlocking... Please wait
                    </button>
                    
                    <button id="cancelBtn" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Script View Modal -->
            <div id="scriptViewModal" class="modal script-view-modal">
                <div class="script-view-content enhanced-view-modal">
                    <div class="script-view-header">
                        <h3 id="viewScriptName"></h3>
                        <button class="close-view" id="closeScriptView">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="enhanced-view-content">
                        <div class="enhanced-video-section">
                            <div id="videoContent">
                                <!-- Video content will be dynamically added here -->
                            </div>
                            
                            <div class="watch-options" id="watchOptions" style="display: none;">
                                <button class="watch-option-btn watch-here-btn active" id="watchHereBtn">
                                    <i class="fas fa-play-circle"></i> Watch Here
                                </button>
                                <button class="watch-option-btn" id="watchYouTubeBtn">
                                    <i class="fab fa-youtube"></i> Watch on YouTube
                                </button>
                            </div>
                            
                            <div class="enhanced-description" id="viewScriptDescription">
                                <!-- Description will be dynamically added here -->
                            </div>
                            
                            <div class="hashtag-container" id="viewHashtags">
                                <!-- Hashtags will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div class="enhanced-info-section">
                            <div class="script-details">
                                <div class="script-uploader">
                                    <i class="fas fa-user"></i>
                                    <span id="viewScriptAuthor"></span>
                                    <span id="viewScriptDate"></span>
                                </div>
                            </div>
                            
                            <div class="enhanced-stats">
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewLikeCount">0</span>
                                    <span class="enhanced-stat-label">Likes</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewDislikeCount">0</span>
                                    <span class="enhanced-stat-label">Dislikes</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewViewCount">0</span>
                                    <span class="enhanced-stat-label">Views</span>
                                </div>
                                <div class="enhanced-stat">
                                    <span class="enhanced-stat-number" id="viewStepsCount">0</span>
                                    <span class="enhanced-stat-label">Steps</span>
                                </div>
                            </div>
                            
                            <div class="script-view-stats">
                                <div class="stat-item">
                                    <button class="like-btn" id="viewLikeBtn">
                                        <i class="fas fa-thumbs-up"></i>
                                        <span class="count" id="viewLikeCountText">0</span>
                                    </button>
                                </div>
                                <div class="stat-item">
                                    <button class="dislike-btn" id="viewDislikeBtn">
                                        <i class="fas fa-thumbs-down"></i>
                                        <span class="count" id="viewDislikeCountText">0</span>
                                    </button>
                                </div>
                                <button class="subscribe-btn" id="viewSubscribeBtn">
                                    <i class="fas fa-bell"></i>
                                    <span id="subscribeText">Subscribe</span>
                                </button>
                            </div>
                            
                            <button class="btn" id="viewUnlockBtn">
                                <i class="fas fa-unlock-alt"></i> Unlock Script
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Delete Confirmation Modal -->
            <div id="deleteModal" class="modal">
                <div class="modal-content">
                    <h3><i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i> Confirm Delete</h3>
                    <p id="deleteMessage">Are you sure you want to delete this script? This action cannot be undone.</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 25px;">
                        <button id="confirmDeleteBtn" class="btn btn-danger mobile-full-width">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button id="cancelDeleteBtn" class="btn btn-secondary mobile-full-width">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                </div>
                </div>
            </div>
            
            <!-- Delete Account Modal -->
            <div id="deleteAccountModal" class="modal">
                <div class="modal-content">
                    <h3><i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i> Delete Account</h3>
                    <p>This will permanently delete your account, all your uploaded scripts, subscriptions, likes, and everything associated with your account. This action cannot be undone!</p>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="confirmUsername">Type your username to confirm</label>
                        <input type="text" id="confirmUsername" placeholder="Enter your username">
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 25px;">
                        <button id="confirmAccountDeleteBtn" class="btn btn-danger mobile-full-width">
                            <i class="fas fa-trash"></i> Permanently Delete Account
                        </button>
                        <button id="cancelAccountDeleteBtn" class="btn btn-secondary mobile-full-width">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <footer>
                <p>VertexScripts Dashboard &copy; 2023 | All scripts are property of their respective owners</p>
            </footer>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB4aVpNW6SKbj26fExI65voT84D2k_MvwQ",
            authDomain: "vertexscripts-4f108.firebaseapp.com",
            projectId: "vertexscripts-4f108",
            storageBucket: "vertexscripts-4f108.firebasestorage.app",
            messagingSenderId: "315039481759",
            appId: "1:315039481759:web:c52b2887332bc5a41307aa"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ============ FIREBASE STORAGE SYSTEM ============
        class VertexStorage {
            constructor() {
                this.auth = auth;
                this.db = db;
                this.currentUser = null;
                
                // Listen for auth state changes
                onAuthStateChanged(this.auth, async (user) => {
                    if (user) {
                        this.currentUser = user;
                        // Get username from email
                        const username = user.email.split('@')[0];
                        this.currentUser.username = username;
                        
                        // Get user data from Firestore
                        try {
                            const userDoc = await getDoc(doc(this.db, "users", username));
                            if (userDoc.exists()) {
                                this.currentUser.isAdmin = userDoc.data().isAdmin || false;
                            } else {
                                this.currentUser.isAdmin = false;
                            }
                        } catch (error) {
                            console.error("Error getting user data:", error);
                            this.currentUser.isAdmin = false;
                        }
                        
                        if (window.appInitialized) {
                            showApp();
                        }
                    } else {
                        this.currentUser = null;
                        if (window.appInitialized) {
                            showAuth();
                        }
                    }
                });
            }
            
            // User management with Firebase
            async registerUser(username, password) {
                try {
                    // Check if username contains spaces
                    if (username.includes(' ')) {
                        return { success: false, error: 'Username cannot contain spaces' };
                    }
                    
                    if (password === username) {
                        return { success: false, error: 'Password cannot be the same as username' };
                    }
                    
                    if (password.length < 6) {
                        return { success: false, error: 'Password must be at least 6 characters' };
                    }
                    
                    // Check if username already exists
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        return { success: false, error: 'Username already taken' };
                    }
                    
                    // Create user with email (using username@vertexscripts.com as email)
                    const email = `${username}@vertexscripts.com`;
                    const userCredential = await createUserWithEmailAndPassword(this.auth, email, password);
                    
                    // Save user data to Firestore
                    await setDoc(doc(this.db, "users", username), {
                        username: username,
                        email: email,
                        createdAt: serverTimestamp(),
                        isAdmin: username === 'plstealme2',
                        subscribers: 0
                    });
                    
                    return { success: true, user: { username: username, isAdmin: username === 'plstealme2' } };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            async loginUser(username, password) {
                try {
                    const email = `${username}@vertexscripts.com`;
                    await signInWithEmailAndPassword(this.auth, email, password);
                    
                    // Get user data from Firestore
                    const userDoc = await getDoc(doc(this.db, "users", username));
                    if (userDoc.exists()) {
                        return { 
                            success: true, 
                            user: { 
                                username: username,
                                isAdmin: userDoc.data().isAdmin || false
                            } 
                        };
                    }
                    return { success: true, user: { username: username, isAdmin: false } };
                } catch (error) {
                    return { success: false, error: 'Invalid username or password' };
                }
            }
            
            async getCurrentUser() {
                if (!this.currentUser) return null;
                return {
                    username: this.currentUser.username,
                    isAdmin: this.currentUser.isAdmin || false
                };
            }
            
            async logoutUser() {
                await signOut(this.auth);
            }
            
            async deleteUser(username) {
                try {
                    // Delete user data from Firestore
                    await deleteDoc(doc(this.db, "users", username));
                    
                    // Delete user's scripts
                    const scriptsQuery = query(collection(this.db, "scripts"), where("uploader", "==", username));
                    const scriptsSnapshot = await getDocs(scriptsQuery);
                    
                    const deletePromises = [];
                    scriptsSnapshot.forEach((scriptDoc) => {
                        deletePromises.push(deleteDoc(doc(this.db, "scripts", scriptDoc.id)));
                    });
                    await Promise.all(deletePromises);
                    
                    // Delete user's interactions
                    await deleteDoc(doc(this.db, "interactions", username));
                    
                    // Delete user's subscriptions
                    await deleteDoc(doc(this.db, "subscriptions", username));
                    
                    // Get current user and delete account
                    const user = this.auth.currentUser;
                    if (user) {
                        await deleteUser(user);
                    }
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Script management with Firestore
            async saveScript(script) {
                try {
                    // Add timestamp and initialize counts
                    script.createdAt = serverTimestamp();
                    script.updatedAt = serverTimestamp();
                    script.likes = script.likes || 0;
                    script.dislikes = script.dislikes || 0;
                    script.views = script.views || 0;
                    
                    // Save script
                    const docRef = await addDoc(collection(this.db, "scripts"), script);
                    script.id = docRef.id;
                    
                    // Update script with ID
                    await updateDoc(docRef, { id: docRef.id });
                    
                    // Update hashtags
                    await this.updateHashtags(script);
                    
                    return { success: true, script: script };
                } catch (error) {
                    console.error("Error saving script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            async getScripts() {
                try {
                    const q = query(collection(this.db, "scripts"), orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        // Convert Firestore timestamp to Date
                        if (data.createdAt && data.createdAt.toDate) {
                            data.createdAt = data.createdAt.toDate();
                        }
                        if (data.uploadDateTime) {
                            data.uploadDate = new Date(data.uploadDateTime).toLocaleDateString();
                        } else if (data.createdAt) {
                            data.uploadDate = new Date(data.createdAt).toLocaleDateString();
                        } else {
                            data.uploadDate = "Unknown date";
                        }
                        scripts.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting scripts:', error);
                    return [];
                }
            }
            
            async getScriptsByUser(username) {
                try {
                    const q = query(collection(this.db, "scripts"), 
                                  where("uploader", "==", username),
                                  orderBy("createdAt", "desc"));
                    const snapshot = await getDocs(q);
                    
                    const scripts = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.createdAt && data.createdAt.toDate) {
                            data.createdAt = data.createdAt.toDate();
                        }
                        if (data.uploadDateTime) {
                            data.uploadDate = new Date(data.uploadDateTime).toLocaleDateString();
                        } else if (data.createdAt) {
                            data.uploadDate = new Date(data.createdAt).toLocaleDateString();
                        }
                        scripts.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting user scripts:', error);
                    return [];
                }
            }
            
            async deleteScript(scriptId) {
                try {
                    // Get script first to update hashtags
                    const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                    if (scriptDoc.exists()) {
                        const script = scriptDoc.data();
                        await this.removeScriptFromHashtags({ id: scriptId, ...script });
                    }
                    
                    await deleteDoc(doc(this.db, "scripts", scriptId));
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            async updateScript(updatedScript) {
                try {
                    updatedScript.updatedAt = serverTimestamp();
                    
                    const { id, ...scriptData } = updatedScript;
                    await updateDoc(doc(this.db, "scripts", id), scriptData);
                    return { success: true };
                } catch (error) {
                    console.error("Error updating script:", error);
                    return { success: false, error: error.message };
                }
            }
            
            // Hashtag management
            async updateHashtags(script) {
                if (!script.hashtags || !script.hashtags.length) return;
                
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    
                    if (!hashtagDoc.exists()) {
                        await setDoc(hashtagRef, {
                            count: 1,
                            scripts: [script.id],
                            createdAt: serverTimestamp()
                        });
                    } else {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        if (!scripts.includes(script.id)) {
                            scripts.push(script.id);
                            await updateDoc(hashtagRef, {
                                count: scripts.length,
                                scripts: scripts,
                                updatedAt: serverTimestamp()
                            });
                        }
                    }
                }
            }
            
            async removeScriptFromHashtags(script) {
                if (!script.hashtags || !script.hashtags.length) return;
                
                for (const tag of script.hashtags) {
                    const hashtagRef = doc(this.db, "hashtags", tag);
                    const hashtagDoc = await getDoc(hashtagRef);
                    
                    if (hashtagDoc.exists()) {
                        const data = hashtagDoc.data();
                        const scripts = data.scripts || [];
                        const index = scripts.indexOf(script.id);
                        
                        if (index > -1) {
                            scripts.splice(index, 1);
                            
                            if (scripts.length === 0) {
                                await deleteDoc(hashtagRef);
                            } else {
                                await updateDoc(hashtagRef, {
                                    count: scripts.length,
                                    scripts: scripts,
                                    updatedAt: serverTimestamp()
                                });
                            }
                        }
                    }
                }
            }
            
            async getHashtags() {
                try {
                    const snapshot = await getDocs(collection(this.db, "hashtags"));
                    const hashtags = {};
                    
                    snapshot.forEach(doc => {
                        hashtags[doc.id] = doc.data();
                    });
                    
                    return hashtags;
                } catch (error) {
                    console.error('Error getting hashtags:', error);
                    return {};
                }
            }
            
            async getScriptsByHashtag(hashtag) {
                try {
                    const hashtagDoc = await getDoc(doc(this.db, "hashtags", hashtag));
                    
                    if (!hashtagDoc.exists()) return [];
                    
                    const data = hashtagDoc.data();
                    const scriptIds = data.scripts || [];
                    
                    if (scriptIds.length === 0) return [];
                    
                    // Get scripts by their IDs
                    const scripts = [];
                    for (const scriptId of scriptIds) {
                        const scriptDoc = await getDoc(doc(this.db, "scripts", scriptId));
                        if (scriptDoc.exists()) {
                            const scriptData = scriptDoc.data();
                            if (scriptData.createdAt && scriptData.createdAt.toDate) {
                                scriptData.createdAt = scriptData.createdAt.toDate();
                            }
                            scripts.push({ id: scriptDoc.id, ...scriptData });
                        }
                    }
                    
                    return scripts;
                } catch (error) {
                    console.error('Error getting scripts by hashtag:', error);
                    return [];
                }
            }
            
            // Interaction tracking
            async recordInteraction(username, scriptId, type) {
                try {
                    const interactionRef = doc(this.db, "interactions", `${username}_${scriptId}`);
                    const interactionDoc = await getDoc(interactionRef);
                    
                    let currentState = { liked: false, disliked: false };
                    let scriptUpdate = {};
                    
                    if (interactionDoc.exists()) {
                        currentState = interactionDoc.data();
                        
                        if (type === 'like') {
                            if (currentState.liked) {
                                // Remove like
                                await updateDoc(interactionRef, { liked: false });
                                scriptUpdate.likes = increment(-1);
                            } else {
                                // Add like, remove dislike if exists
                                await updateDoc(interactionRef, { 
                                    liked: true, 
                                    disliked: false 
                                });
                                scriptUpdate.likes = increment(1);
                                if (currentState.disliked) {
                                    scriptUpdate.dislikes = increment(-1);
                                }
                            }
                        } else if (type === 'dislike') {
                            if (currentState.disliked) {
                                // Remove dislike
                                await updateDoc(interactionRef, { disliked: false });
                                scriptUpdate.dislikes = increment(-1);
                            } else {
                                // Add dislike, remove like if exists
                                await updateDoc(interactionRef, { 
                                    disliked: true, 
                                    liked: false 
                                });
                                scriptUpdate.dislikes = increment(1);
                                if (currentState.liked) {
                                    scriptUpdate.likes = increment(-1);
                                }
                            }
                        }
                    } else {
                        // First interaction
                        if (type === 'like') {
                            await setDoc(interactionRef, { liked: true, disliked: false });
                            scriptUpdate.likes = increment(1);
                        } else if (type === 'dislike') {
                            await setDoc(interactionRef, { liked: false, disliked: true });
                            scriptUpdate.dislikes = increment(1);
                        }
                    }
                    
                    // Update script stats
                    if (Object.keys(scriptUpdate).length > 0) {
                        await updateDoc(doc(this.db, "scripts", scriptId), scriptUpdate);
                    }
                    
                    // Get updated interaction state
                    const updatedDoc = await getDoc(interactionRef);
                    const updatedData = updatedDoc.exists() ? updatedDoc.data() : { liked: false, disliked: false };
                    
                    return { 
                        success: true, 
                        liked: updatedData.liked || false, 
                        disliked: updatedData.disliked || false 
                    };
                } catch (error) {
                    console.error('Error recording interaction:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async getInteractionState(username, scriptId) {
                try {
                    const interactionDoc = await getDoc(doc(this.db, "interactions", `${username}_${scriptId}`));
                    
                    if (interactionDoc.exists()) {
                        const data = interactionDoc.data();
                        return {
                            liked: data.liked || false,
                            disliked: data.disliked || false
                        };
                    }
                    return { liked: false, disliked: false };
                } catch (error) {
                    console.error('Error getting interaction state:', error);
                    return { liked: false, disliked: false };
                }
            }
            
            // View tracking
            async recordScriptView(username, scriptId) {
                try {
                    const viewRef = doc(this.db, "views", `${scriptId}_${username}`);
                    const viewDoc = await getDoc(viewRef);
                    
                    if (!viewDoc.exists()) {
                        // First view from this user
                        await setDoc(viewRef, {
                            username: username,
                            scriptId: scriptId,
                            viewedAt: serverTimestamp()
                        });
                        
                        // Increment view count
                        await updateDoc(doc(this.db, "scripts", scriptId), {
                            views: increment(1)
                        });
                        
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Error recording view:', error);
                    return false;
                }
            }
            
            // Subscription management
            async subscribe(subscriber, creator) {
                if (subscriber === creator) return false;
                
                try {
                    const subscriptionRef = doc(this.db, "subscriptions", `${subscriber}_${creator}`);
                    const subscriptionDoc = await getDoc(subscriptionRef);
                    
                    if (subscriptionDoc.exists()) {
                        // Unsubscribe
                        await deleteDoc(subscriptionRef);
                        // Update creator's subscriber count
                        await updateDoc(doc(this.db, "users", creator), {
                            subscribers: increment(-1)
                        });
                        return false;
                    } else {
                        // Subscribe
                        await setDoc(subscriptionRef, {
                            subscriber: subscriber,
                            creator: creator,
                            subscribedAt: serverTimestamp()
                        });
                        // Update creator's subscriber count
                        await updateDoc(doc(this.db, "users", creator), {
                            subscribers: increment(1)
                        });
                        return true;
                    }
                } catch (error) {
                    console.error('Error toggling subscription:', error);
                    return false;
                }
            }
            
            async isSubscribed(subscriber, creator) {
                try {
                    const subscriptionDoc = await getDoc(doc(this.db, "subscriptions", `${subscriber}_${creator}`));
                    return subscriptionDoc.exists();
                } catch (error) {
                    console.error('Error checking subscription:', error);
                    return false;
                }
            }
            
            async getSubscriptions(username) {
                try {
                    const q = query(collection(this.db, "subscriptions"), 
                                  where("subscriber", "==", username));
                    const snapshot = await getDocs(q);
                    
                    const subscriptions = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        subscriptions.push(data.creator);
                    });
                    
                    return subscriptions;
                } catch (error) {
                    console.error('Error getting subscriptions:', error);
                    return [];
                }
            }
            
            async getSubscribers(username) {
                try {
                    const q = query(collection(this.db, "subscriptions"), 
                                  where("creator", "==", username));
                    const snapshot = await getDocs(q);
                    
                    return snapshot.size;
                } catch (error) {
                    console.error('Error getting subscribers:', error);
                    return 0;
                }
            }
            
            // Channel stats
            async getUserChannelStats(username) {
                try {
                    const scripts = await this.getScriptsByUser(username);
                    let totalLikes = 0;
                    let totalDislikes = 0;
                    let totalViews = 0;
                    
                    scripts.forEach(script => {
                        totalLikes += script.likes || 0;
                        totalDislikes += script.dislikes || 0;
                        totalViews += script.views || 0;
                    });
                    
                    // Get subscriber count
                    const subscribers = await this.getSubscribers(username);
                    
                    return {
                        scriptsCount: scripts.length,
                        totalLikes,
                        totalDislikes,
                        totalViews,
                        subscribers
                    };
                } catch (error) {
                    console.error('Error getting channel stats:', error);
                    return {
                        scriptsCount: 0,
                        totalLikes: 0,
                        totalDislikes: 0,
                        totalViews: 0,
                        subscribers: 0
                    };
                }
            }
        }

        // ============ MAIN APPLICATION ============
        const storage = new VertexStorage();
        let currentUser = null;
        let scripts = [];
        let nextId = 1;
        let currentUnlockScript = null;
        let currentStep = 0;
        let countdown = 20;
        let countdownInterval = null;
        let completedSteps = new Set();
        let stepTimers = {};
        let scriptToDelete = null;
        let currentViewScript = null;
        let uploadType = 'thumbnail';
        let currentWatchOption = 'watch-here';
        let activeHashtag = null;
        let dropdownTimeout = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            window.appInitialized = true;
            
            // Setup event listeners
            setupEventListeners();
            
            // Check if user is already logged in
            setTimeout(async () => {
                currentUser = await storage.getCurrentUser();
                
                if (currentUser) {
                    showApp();
                } else {
                    showAuth();
                }
                
                await loadScripts();
                updateStats();
            }, 1000);
        });

        function setupEventListeners() {
            // Auth tabs
            document.getElementById('loginTab').addEventListener('click', () => switchAuthTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchAuthTab('register'));
            
            // Auth forms
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Upload type selection
            document.getElementById('thumbnailOptionBtn').addEventListener('click', () => switchUploadType('thumbnail'));
            document.getElementById('youtubeOptionBtn').addEventListener('click', () => switchUploadType('youtube'));
            
            // YouTube link preview
            document.getElementById('youtubeLink').addEventListener('input', handleYoutubeLink);
            
            // Description word counter
            document.getElementById('scriptDescription').addEventListener('input', updateWordCount);
            
            // Main app buttons
            document.getElementById('uploadForm').addEventListener('submit', uploadScript);
            document.getElementById('addStepBtn').addEventListener('click', addStep);
            document.getElementById('addYoutubeStepBtn').addEventListener('click', addYouTubeStep);
            document.getElementById('thumbnailInput').addEventListener('change', handleThumbnailPreview);
            document.getElementById('cancelBtn').addEventListener('click', closeUnlockModal);
            document.getElementById('accessLinkBtn').addEventListener('click', accessScriptLink);
            document.getElementById('showUploadBtn').addEventListener('click', showUploadForm);
            document.getElementById('backToDashboardBtn').addEventListener('click', showDashboard);
            document.getElementById('searchInput').addEventListener('input', filterScripts);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteScript);
            document.getElementById('cancelDeleteBtn').addEventListener('click', cancelDelete);
            document.getElementById('confirmAccountDeleteBtn').addEventListener('click', confirmAccountDelete);
            document.getElementById('cancelAccountDeleteBtn').addEventListener('click', cancelAccountDelete);
            document.getElementById('viewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('mobileViewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('subscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('mobileSubscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('backToDashboardFromSubs').addEventListener('click', showDashboard);
            document.getElementById('backToDashboardFromChannel').addEventListener('click', showDashboard);
            document.getElementById('deleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('mobileDeleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('closeScriptView').addEventListener('click', closeScriptView);
            document.getElementById('viewUnlockBtn').addEventListener('click', unlockFromView);
            
            // PC navigation buttons
            document.getElementById('pcDashboardBtn').addEventListener('click', showDashboard);
            document.getElementById('pcUploadBtn').addEventListener('click', showUploadForm);
            document.getElementById('pcChannelBtn').addEventListener('click', showChannel);
            document.getElementById('pcSubscriptionsBtn').addEventListener('click', showSubscriptions);
            document.getElementById('pcViewChannelBtn').addEventListener('click', showChannel);
            document.getElementById('pcSubscriptionsBtn2').addEventListener('click', showSubscriptions);
            document.getElementById('pcDeleteAccountBtn').addEventListener('click', showDeleteAccountModal);
            document.getElementById('pcLogoutBtn').addEventListener('click', logout);
            document.getElementById('pcHashtagExplorerBtn').addEventListener('click', showHashtagExplorer);
            document.getElementById('mobileHashtagExplorerBtn').addEventListener('click', showHashtagExplorer);
            document.getElementById('backToDashboardFromHashtag').addEventListener('click', showDashboard);
            
            // Mobile logout buttons
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('mobileLogoutBtn').addEventListener('click', logout);
            
            // PC search
            document.getElementById('pcSearchInput').addEventListener('input', handleAdvancedSearch);
            document.getElementById('pcSearchInput').addEventListener('focus', showSearchSuggestions);
            document.getElementById('pcSearchInput').addEventListener('blur', () => {
                setTimeout(() => {
                    hideSearchSuggestions();
                }, 200);
            });
            
            // Watch options
            document.getElementById('watchHereBtn').addEventListener('click', () => switchWatchOption('watch-here'));
            document.getElementById('watchYouTubeBtn').addEventListener('click', () => switchWatchOption('watch-youtube'));
            
            // Advanced like/dislike handling
            document.getElementById('viewLikeBtn').addEventListener('click', handleLike);
            document.getElementById('viewDislikeBtn').addEventListener('click', handleDislike);
            document.getElementById('viewSubscribeBtn').addEventListener('click', handleSubscribe);
            
            // Window events
            window.addEventListener('orientationchange', () => setTimeout(handleResize, 100));
            window.addEventListener('resize', debounce(handleResize, 250));
            window.addEventListener('click', closeAllDropdowns);
            
            // Dropdown toggle
            document.querySelectorAll('.dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdown = this.closest('.dropdown');
                    const content = dropdown.querySelector('.dropdown-content');
                    
                    // Close all other dropdowns
                    document.querySelectorAll('.dropdown-content').forEach(d => {
                        if (d !== content) {
                            d.parentElement.classList.remove('active');
                        }
                    });
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('active');
                });
            });
            
            // Initialize
            addVertexStep();
            handleResize();
            updateWordCount();
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        function switchUploadType(type) {
            uploadType = type;
            
            // Update button states
            document.getElementById('thumbnailOptionBtn').classList.toggle('active', type === 'thumbnail');
            document.getElementById('youtubeOptionBtn').classList.toggle('active', type === 'youtube');
            
            // Show/hide sections
            document.getElementById('thumbnailUploadSection').style.display = type === 'thumbnail' ? 'block' : 'none';
            document.getElementById('youtubeUploadSection').style.display = type === 'youtube' ? 'block' : 'none';
            
            // Update required attribute
            document.getElementById('thumbnailInput').required = type === 'thumbnail';
            document.getElementById('youtubeLink').required = type === 'youtube';
        }

        function updateWordCount() {
            const textarea = document.getElementById('scriptDescription');
            const wordCount = document.getElementById('wordCount');
            const text = textarea.value.trim();
            
            if (text === '') {
                wordCount.textContent = '0';
                return;
            }
            
            const words = text.split(/\s+/).filter(word => word.length > 0);
            const count = Math.min(words.length, 100);
            wordCount.textContent = count;
            
            if (count >= 100) {
                // Trim text to 100 words
                const limitedWords = words.slice(0, 100).join(' ');
                textarea.value = limitedWords;
                showToast('Description limited to 100 words');
            }
        }

        function handleAdvancedSearch(e) {
            const query = e.target.value.toLowerCase();
            const suggestions = document.getElementById('searchSuggestions');
            
            if (!query.trim()) {
                suggestions.classList.remove('active');
                return;
            }
            
            // Get suggestions
            const scriptSuggestions = scripts.filter(script => 
                script.name.toLowerCase().includes(query) ||
                script.uploader.toLowerCase().includes(query) ||
                (script.description && script.description.toLowerCase().includes(query))
            );
            
            const hashtags = storage.getHashtags();
            const hashtagSuggestions = Object.keys(hashtags).filter(tag => 
                tag.toLowerCase().includes(query)
            );
            
            if (scriptSuggestions.length === 0 && hashtagSuggestions.length === 0) {
                suggestions.classList.remove('active');
                return;
            }
            
            let html = '';
            
            // Add hashtag suggestions first
            hashtagSuggestions.slice(0, 5).forEach(tag => {
                html += `
                    <div class="suggestion-item" data-type="hashtag" data-value="${tag}">
                        <i class="fas fa-hashtag" style="color: #4bcffa;"></i>
                        <span class="suggestion-hashtag">${tag}</span>
                        <small style="opacity: 0.6; margin-left: auto;">${hashtags[tag].count} scripts</small>
                    </div>
                `;
            });
            
            // Add script suggestions
            scriptSuggestions.slice(0, 5).forEach(script => {
                html += `
                    <div class="suggestion-item" data-type="script" data-value="${script.name}">
                        <i class="fas fa-code" style="color: #4bcffa;"></i>
                        ${script.name}
                        <small style="opacity: 0.6; margin-left: auto;">by ${script.uploader}</small>
                    </div>
                `;
            });
            
            suggestions.innerHTML = html;
            suggestions.classList.add('active');
            
            // Add click handlers to suggestions
            suggestions.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const value = this.dataset.value;
                    
                    if (type === 'hashtag') {
                        // Show scripts with this hashtag
                        filterByHashtag(value);
                        document.getElementById('pcSearchInput').value = value;
                    } else {
                        // Search for this script
                        document.getElementById('pcSearchInput').value = value;
                        filterScripts({ target: { value: value } });
                    }
                    
                    suggestions.classList.remove('active');
                });
            });
        }

        function showSearchSuggestions() {
            const query = document.getElementById('pcSearchInput').value;
            if (query.trim()) {
                handleAdvancedSearch({ target: { value: query } });
            }
        }

        function hideSearchSuggestions() {
            document.getElementById('searchSuggestions').classList.remove('active');
        }

        function filterByHashtag(hashtag) {
            const filteredScripts = scripts.filter(script => 
                script.hashtags && script.hashtags.includes(hashtag.toLowerCase())
            );
            
            renderFilteredScripts(filteredScripts, `Scripts with #${hashtag}`);
        }

        function switchWatchOption(option) {
            currentWatchOption = option;
            
            // Update button states
            document.getElementById('watchHereBtn').classList.toggle('active', option === 'watch-here');
            document.getElementById('watchYouTubeBtn').classList.toggle('active', option === 'watch-youtube');
            
            // Update video content based on option
            updateVideoContent();
        }

        function updateVideoContent() {
            const videoContent = document.getElementById('videoContent');
            if (!currentViewScript || !currentViewScript.youtubeVideo) return;
            
            const videoId = extractYoutubeVideoId(currentViewScript.youtubeVideo);
            
            if (currentWatchOption === 'watch-here') {
                // Embed YouTube video
                videoContent.innerHTML = `
                    <div class="video-player-container">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
            } else {
                // Show thumbnail with play button that opens YouTube
                videoContent.innerHTML = `
                    <div class="script-view-thumbnail youtube-thumbnail" onclick="window.open('${currentViewScript.youtubeVideo}', '_blank')">
                        <img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" alt="YouTube Video">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                `;
            }
        }

        function handleYoutubeLink(e) {
            const youtubeLink = e.target.value;
            const youtubePreview = document.getElementById('youtubePreview');
            
            if (!youtubeLink) {
                youtubePreview.style.display = 'none';
                return;
            }
            
            // Extract video ID from YouTube URL
            const videoId = extractYoutubeVideoId(youtubeLink);
            
            if (videoId) {
                youtubePreview.innerHTML = `
                    <div class="video-player-container">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
                youtubePreview.style.display = 'block';
            } else {
                youtubePreview.style.display = 'none';
            }
        }

        function extractYoutubeVideoId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = await storage.loginUser(username, password);
            
            if (result.success) {
                currentUser = result.user;
                showApp();
                showToast('Logged in successfully!');
            } else {
                document.getElementById('loginError').textContent = result.error;
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                document.getElementById('registerError').textContent = 'Passwords do not match';
                return;
            }
            
            const result = await storage.registerUser(username, password);
            
            if (result.success) {
                currentUser = result.user;
                showApp();
                showToast('Account created successfully!');
            } else {
                document.getElementById('registerError').textContent = result.error;
            }
        }

        async function logout() {
            await storage.logoutUser();
            currentUser = null;
            showAuth();
            showToast('Logged out successfully');
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        async function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Update user display
            if (currentUser) {
                const displayName = currentUser.username;
                document.getElementById('usernameDisplay').textContent = displayName;
                document.getElementById('pcUsernameDisplay').textContent = displayName;
                document.getElementById('currentUserDisplay').textContent = `Welcome, ${displayName}`;
            }
            
            await showDashboard();
            await loadScripts();
            updateStats();
            updatePCNavActive('dashboard');
        }

        function updatePCNavActive(active) {
            // Update PC navigation buttons
            document.querySelectorAll('.pc-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (active === 'dashboard') {
                document.getElementById('pcDashboardBtn').classList.add('active');
            } else if (active === 'upload') {
                document.getElementById('pcUploadBtn').classList.add('active');
            } else if (active === 'channel') {
                document.getElementById('pcChannelBtn').classList.add('active');
            } else if (active === 'subscriptions') {
                document.getElementById('pcSubscriptionsBtn').classList.add('active');
            } else if (active === 'hashtag') {
                document.getElementById('pcHashtagExplorerBtn').classList.add('active');
            }
        }

        function showDeleteAccountModal() {
            document.getElementById('deleteAccountModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            toggleMobileMenu();
            closeAllDropdowns();
        }

        async function confirmAccountDelete() {
            const confirmUsername = document.getElementById('confirmUsername').value;
            
            if (confirmUsername !== currentUser.username) {
                showToast('Username does not match');
                return;
            }
            
            const result = await storage.deleteUser(currentUser.username);
            
            if (result.success) {
                currentUser = null;
                document.getElementById('deleteAccountModal').style.display = 'none';
                document.body.style.overflow = 'auto';
                document.getElementById('confirmUsername').value = '';
                
                showAuth();
                showToast('Account deleted successfully');
            } else {
                showToast(result.error);
            }
        }

        function cancelAccountDelete() {
            document.getElementById('deleteAccountModal').style.display = 'none';
            document.getElementById('confirmUsername').value = '';
            document.body.style.overflow = 'auto';
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileDropdown');
            menu.classList.toggle('active');
            
            if (dropdownTimeout) {
                clearTimeout(dropdownTimeout);
                dropdownTimeout = null;
            }
        }

        function closeAllDropdowns(e) {
            // Close PC dropdowns
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                dropdown.classList.remove('active');
            });
            
            // Close mobile menu
            const mobileMenu = document.getElementById('mobileDropdown');
            if (mobileMenu) {
                mobileMenu.classList.remove('active');
                mobileMenu.classList.remove('show-upload');
            }
            
            // Close search suggestions
            const searchSuggestions = document.getElementById('searchSuggestions');
            if (searchSuggestions) {
                searchSuggestions.classList.remove('active');
            }
        }

        async function showHashtagExplorer() {
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'block';
            document.getElementById('hashtagExplorer').classList.add('active');
            
            await loadHashtagExplorer();
            updatePCNavActive('hashtag');
            toggleMobileMenu();
            closeAllDropdowns();
        }

        async function loadHashtagExplorer() {
            const hashtags = await storage.getHashtags();
            const container = document.getElementById('hashtagList');
            
            if (!hashtags || Object.keys(hashtags).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-hashtag"></i>
                        <h3>No hashtags yet</h3>
                        <p>Upload scripts with hashtags to see them here</p>
                    </div>
                `;
                return;
            }
            
            // Sort hashtags by count (descending)
            const sortedHashtags = Object.entries(hashtags).sort((a, b) => b[1].count - a[1].count);
            
            container.innerHTML = '';
            sortedHashtags.forEach(([tag, data]) => {
                const card = document.createElement('div');
                card.className = 'hashtag-card';
                card.innerHTML = `
                    <div class="hashtag">#${tag}</div>
                    <div class="hashtag-stats">
                        <span>${data.count} scripts</span>
                        <span>${data.count * 10} views</span>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    filterByHashtag(tag);
                    showDashboard();
                });
                
                container.appendChild(card);
            });
            
            // Update total hashtags count
            document.getElementById('totalHashtags').textContent = Object.keys(hashtags).length;
        }

        async function showChannel() {
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'block';
            document.getElementById('hashtagExplorer').style.display = 'none';
            
            await loadChannelData();
            updatePCNavActive('channel');
            toggleMobileMenu();
            closeAllDropdowns();
        }

        async function loadChannelData() {
            if (!currentUser) return;
            
            const stats = await storage.getUserChannelStats(currentUser.username);
            const userScripts = await storage.getScriptsByUser(currentUser.username);
            
            // Update channel info
            document.getElementById('channelUsername').textContent = currentUser.username;
            document.getElementById('channelSubscribers').textContent = stats.subscribers;
            document.getElementById('channelTotalLikes').textContent = stats.totalLikes;
            document.getElementById('channelTotalViews').textContent = stats.totalViews;
            document.getElementById('channelScriptsCount').textContent = stats.scriptsCount;
            
            // Load user's scripts
            const container = document.getElementById('channelScriptsList');
            
            if (userScripts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-code"></i>
                        <h3>No scripts uploaded yet</h3>
                        <p>Upload your first script to get started!</p>
                        <button class="btn" style="margin-top: 20px;" id="channelUploadBtn">
                            <i class="fas fa-upload"></i> Upload First Script
                        </button>
                    </div>
                `;
                
                document.getElementById('channelUploadBtn').addEventListener('click', showUploadForm);
                return;
            }
            
            // Sort by date (newest first)
            userScripts.sort((a, b) => new Date(b.createdAt || b.uploadDateTime) - new Date(a.createdAt || a.uploadDateTime));
            
            container.innerHTML = '';
            userScripts.forEach(script => {
                const scriptCard = createScriptCard(script);
                container.appendChild(scriptCard);
            });
        }

        async function showSubscriptions() {
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'block';
            
            await loadSubscriptions();
            updatePCNavActive('subscriptions');
            toggleMobileMenu();
            closeAllDropdowns();
        }

        async function loadSubscriptions() {
            const subscriptions = await storage.getSubscriptions(currentUser.username);
            const allScripts = await storage.getScripts();
            
            // Get scripts from subscribed creators
            const subscriptionScripts = allScripts.filter(script => 
                subscriptions.includes(script.uploader)
            );
            
            // Sort by date (newest first)
            subscriptionScripts.sort((a, b) => new Date(b.createdAt || b.uploadDateTime) - new Date(a.createdAt || a.uploadDateTime));
            
            const container = document.getElementById('subscriptionsList');
            
            if (subscriptionScripts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <h3>No subscriptions yet</h3>
                        <p>Subscribe to creators to see their latest scripts here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            subscriptionScripts.forEach(script => {
                const scriptCard = createScriptCard(script);
                container.appendChild(scriptCard);
            });
        }

        async function handleSubscribe() {
            if (!currentUser || !currentViewScript) return;
            
            const creator = currentViewScript.uploader;
            
            if (creator === currentUser.username) {
                showToast("You can't subscribe to yourself");
                return;
            }
            
            const subscribed = await storage.subscribe(currentUser.username, creator);
            
            if (subscribed) {
                document.getElementById('subscribeText').textContent = 'Subscribed';
                document.getElementById('viewSubscribeBtn').classList.add('subscribed');
                showToast(`Subscribed to ${creator}`);
            } else {
                document.getElementById('subscribeText').textContent = 'Subscribe';
                document.getElementById('viewSubscribeBtn').classList.remove('subscribed');
                showToast(`Unsubscribed from ${creator}`);
            }
            
            // Update channel stats if viewing own channel
            if (document.getElementById('channelContainer').style.display === 'block') {
                await loadChannelData();
            }
        }

        async function handleLike() {
            if (!currentUser || !currentViewScript) return;
            
            const likeBtn = document.getElementById('viewLikeBtn');
            const dislikeBtn = document.getElementById('viewDislikeBtn');
            
            // Disable buttons during processing to prevent spam
            likeBtn.disabled = true;
            dislikeBtn.disabled = true;
            
            const scriptId = currentViewScript.id;
            const result = await storage.recordInteraction(currentUser.username, scriptId, 'like');
            
            if (!result.success) {
                showToast(result.error);
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
                return;
            }
            
            // Update UI
            if (result.liked) {
                document.getElementById('viewLikeBtn').classList.add('liked');
                document.getElementById('viewDislikeBtn').classList.remove('disliked');
                
                // Update counts
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                
                document.getElementById('viewLikeCount').textContent = currentLikes + 1;
                document.getElementById('viewLikeCountText').textContent = currentLikes + 1;
                
                // If previously disliked, remove dislike
                if (result.disliked === false && currentDislikes > 0) {
                    document.getElementById('viewDislikeCount').textContent = currentDislikes - 1;
                    document.getElementById('viewDislikeCountText').textContent = currentDislikes - 1;
                }
                
                showToast('Liked script');
            } else {
                document.getElementById('viewLikeBtn').classList.remove('liked');
                
                // Update counts
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                if (currentLikes > 0) {
                    document.getElementById('viewLikeCount').textContent = currentLikes - 1;
                    document.getElementById('viewLikeCountText').textContent = currentLikes - 1;
                }
                
                showToast('Removed like');
            }
            
            // Refresh script data
            await loadScripts();
            
            // Re-enable buttons after a short delay
            setTimeout(() => {
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
            }, 1000);
        }

        async function handleDislike() {
            if (!currentUser || !currentViewScript) return;
            
            const likeBtn = document.getElementById('viewLikeBtn');
            const dislikeBtn = document.getElementById('viewDislikeBtn');
            
            // Disable buttons during processing to prevent spam
            likeBtn.disabled = true;
            dislikeBtn.disabled = true;
            
            const scriptId = currentViewScript.id;
            const result = await storage.recordInteraction(currentUser.username, scriptId, 'dislike');
            
            if (!result.success) {
                showToast(result.error);
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
                return;
            }
            
            // Update UI
            if (result.disliked) {
                document.getElementById('viewDislikeBtn').classList.add('disliked');
                document.getElementById('viewLikeBtn').classList.remove('liked');
                
                // Update counts
                const currentLikes = parseInt(document.getElementById('viewLikeCountText').textContent) || 0;
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                
                document.getElementById('viewDislikeCount').textContent = currentDislikes + 1;
                document.getElementById('viewDislikeCountText').textContent = currentDislikes + 1;
                
                // If previously liked, remove like
                if (result.liked === false && currentLikes > 0) {
                    document.getElementById('viewLikeCount').textContent = currentLikes - 1;
                    document.getElementById('viewLikeCountText').textContent = currentLikes - 1;
                }
                
                showToast('Disliked script');
            } else {
                document.getElementById('viewDislikeBtn').classList.remove('disliked');
                
                // Update counts
                const currentDislikes = parseInt(document.getElementById('viewDislikeCountText').textContent) || 0;
                if (currentDislikes > 0) {
                    document.getElementById('viewDislikeCount').textContent = currentDislikes - 1;
                    document.getElementById('viewDislikeCountText').textContent = currentDislikes - 1;
                }
                
                showToast('Removed dislike');
            }
            
            // Refresh script data
            await loadScripts();
            
            // Re-enable buttons after a short delay
            setTimeout(() => {
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
            }, 1000);
        }

        async function showScriptView(script) {
            currentViewScript = script;
            
            // Record view only once per user
            if (currentUser) {
                await storage.recordScriptView(currentUser.username, script.id);
                // Refresh script data to get updated view count
                await loadScripts();
                const updatedScripts = scripts.find(s => s.id === script.id);
                if (updatedScripts) {
                    currentViewScript = updatedScripts;
                }
            }
            
            // Update UI
            document.getElementById('viewScriptName').textContent = script.name;
            document.getElementById('viewScriptAuthor').textContent = `Uploaded by ${script.uploader}`;
            document.getElementById('viewScriptDate').textContent = ` on ${script.uploadDate || 'Unknown date'}`;
            document.getElementById('viewLikeCount').textContent = script.likes || 0;
            document.getElementById('viewLikeCountText').textContent = script.likes || 0;
            document.getElementById('viewDislikeCount').textContent = script.dislikes || 0;
            document.getElementById('viewDislikeCountText').textContent = script.dislikes || 0;
            document.getElementById('viewViewCount').textContent = script.views || 0;
            document.getElementById('viewStepsCount').textContent = script.steps ? script.steps.length : 0;
            
            // Show description
            const descriptionElement = document.getElementById('viewScriptDescription');
            if (script.description && script.description.trim()) {
                descriptionElement.textContent = script.description;
                descriptionElement.style.display = 'block';
            } else {
                descriptionElement.style.display = 'none';
            }
            
            // Show hashtags
            const hashtagContainer = document.getElementById('viewHashtags');
            hashtagContainer.innerHTML = '';
            
            if (script.hashtags && script.hashtags.length > 0) {
                script.hashtags.forEach(tag => {
                    const hashtagElement = document.createElement('span');
                    hashtagElement.className = 'hashtag';
                    hashtagElement.textContent = `#${tag}`;
                    hashtagElement.addEventListener('click', () => handleHashtagClick(tag, script.id));
                    hashtagContainer.appendChild(hashtagElement);
                });
                hashtagContainer.style.display = 'flex';
            } else {
                hashtagContainer.style.display = 'none';
            }
            
            // Show/hide watch options based on whether there's a YouTube video
            const watchOptions = document.getElementById('watchOptions');
            if (script.youtubeVideo) {
                watchOptions.style.display = 'flex';
                currentWatchOption = 'watch-here';
                updateVideoContent();
            } else {
                watchOptions.style.display = 'none';
                // Show image thumbnail
                const videoContent = document.getElementById('videoContent');
                if (script.thumbnail) {
                    videoContent.innerHTML = `
                        <div class="script-view-thumbnail">
                            <img src="${script.thumbnail}" alt="${script.name}">
                        </div>
                    `;
                } else {
                    videoContent.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; height: 300px; background: linear-gradient(45deg, #0c2461, #1e3799); border-radius: 10px; margin-bottom: 20px;">
                            <i class="fas fa-code" style="font-size: 3rem; color: #4bcffa;"></i>
                        </div>
                    `;
                }
            }
            
            // Check if user is subscribed
            const isSubscribed = await storage.isSubscribed(currentUser.username, script.uploader);
            document.getElementById('subscribeText').textContent = isSubscribed ? 'Subscribed' : 'Subscribe';
            document.getElementById('viewSubscribeBtn').classList.toggle('subscribed', isSubscribed);
            
            // Check if user has liked/disliked
            const interactionState = await storage.getInteractionState(currentUser.username, script.id);
            
            // Reset both buttons to default state first
            document.getElementById('viewLikeBtn').classList.remove('liked');
            document.getElementById('viewDislikeBtn').classList.remove('disliked');
            
            // Then apply correct states
            if (interactionState.liked) {
                document.getElementById('viewLikeBtn').classList.add('liked');
            }
            if (interactionState.disliked) {
                document.getElementById('viewDislikeBtn').classList.add('disliked');
            }
            
            // Disable subscribe button if user is the uploader
            if (script.uploader === currentUser.username) {
                document.getElementById('viewSubscribeBtn').style.display = 'none';
            } else {
                document.getElementById('viewSubscribeBtn').style.display = 'flex';
            }
            
            document.getElementById('scriptViewModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeScriptView() {
            document.getElementById('scriptViewModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentViewScript = null;
        }

        function unlockFromView() {
            closeScriptView();
            startUnlockProcess(currentViewScript);
        }

        // ============ ORIGINAL FUNCTIONALITY (UPDATED) ============
        async function loadScripts() {
            scripts = await storage.getScripts();
            // For Firebase, IDs are auto-generated
            nextId = scripts.length + 1;
        }

        async function showDashboard() {
            document.getElementById('dashboardContainer').style.display = 'block';
            document.getElementById('uploadContainer').style.display = 'none';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            document.getElementById('hashtagExplorer').classList.remove('active');
            
            await renderScripts();
            updateStats();
            updatePCNavActive('dashboard');
            window.scrollTo(0, 0);
            closeAllDropdowns();
        }

        function showUploadForm() {
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('uploadContainer').style.display = 'block';
            document.getElementById('subscriptionsContainer').style.display = 'none';
            document.getElementById('channelContainer').style.display = 'none';
            document.getElementById('hashtagExplorer').style.display = 'none';
            
            // Reset form
            document.getElementById('uploadForm').reset();
            document.getElementById('thumbnailPreview').style.display = 'none';
            document.getElementById('youtubePreview').style.display = 'none';
            document.getElementById('fileLabelText').textContent = 'Click to upload thumbnail image';
            document.getElementById('youtubeLink').value = '';
            document.getElementById('scriptDescription').value = '';
            document.getElementById('wordCount').textContent = '0';
            
            // Reset to default upload type
            switchUploadType('thumbnail');
            
            // Reset steps
            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = '';
            addVertexStep();
            
            updatePCNavActive('upload');
            window.scrollTo(0, 0);
            closeAllDropdowns();
        }

        function addVertexStep() {
            const stepsContainer = document.getElementById('stepsContainer');
            
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container vertex-step';
            stepContainer.setAttribute('data-step', 1);
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">1</span>
                        <i class="fab fa-youtube"></i> Subscribe to VertexR_S (Required)
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <input type="text" class="step-url" value="https://m.youtube.com/@VertexR_S" readonly>
            `;
            
            stepsContainer.appendChild(stepContainer);
        }

        function addStep() {
            const stepNumber = document.querySelectorAll('.step-container').length;
            addCustomStep(stepNumber, "", "");
        }

        function addYouTubeStep() {
            const stepNumber = document.querySelectorAll('.step-container').length;
            addCustomStep(stepNumber, "Subscribe to YouTube Channel", "https://youtube.com");
        }

        function addCustomStep(stepNumber, name, url) {
            const stepsContainer = document.getElementById('stepsContainer');
            
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container';
            stepContainer.setAttribute('data-step', stepNumber);
            stepContainer.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <span class="step-counter">${stepNumber}</span>
                        <input type="text" class="step-name-input" placeholder="Step name" value="${name}" style="background: transparent; border: none; color: white; width: 200px; min-width: 150px; font-size: 14px;">
                    </div>
                    <button type="button" class="remove-step"><i class="fas fa-times"></i></button>
                </div>
                <input type="text" class="step-url" placeholder="https://example.com" value="${url}" required>
            `;
            
            stepsContainer.appendChild(stepContainer);
            
            stepContainer.querySelector('.remove-step').addEventListener('click', function() {
                stepContainer.remove();
                updateStepNumbers();
            });
            
            const nameInput = stepContainer.querySelector('.step-name-input');
            nameInput.addEventListener('input', function() {
                updateStepNumbers();
            });
        }

        function updateStepNumbers() {
            const stepsContainer = document.getElementById('stepsContainer');
            const stepContainers = stepsContainer.querySelectorAll('.step-container');
            
            stepContainers.forEach((container, index) => {
                const stepNumber = index + 1;
                container.setAttribute('data-step', stepNumber);
                
                const counter = container.querySelector('.step-counter');
                counter.textContent = stepNumber;
                
                const nameInput = container.querySelector('.step-name-input');
                if (nameInput) {
                    nameInput.placeholder = `Step ${stepNumber} name`;
                }
            });
        }

        async function updateStats() {
            const allScripts = scripts;
            const totalScripts = allScripts.length;
            const myScripts = allScripts.filter(script => script.uploader === currentUser.username).length;
            const hashtags = await storage.getHashtags();
            const totalHashtags = hashtags ? Object.keys(hashtags).length : 0;
            
            document.getElementById('totalScripts').textContent = totalScripts;
            document.getElementById('myScripts').textContent = myScripts;
            document.getElementById('totalHashtags').textContent = totalHashtags;
        }

        function filterScripts(e) {
            const query = e.target.value;
            const scriptsList = document.getElementById('scriptsList');
            
            if (!query.trim()) {
                renderScripts();
                return;
            }
            
            const filteredScripts = scripts.filter(script => 
                script.name.toLowerCase().includes(query.toLowerCase()) ||
                script.uploader.toLowerCase().includes(query.toLowerCase()) ||
                (script.description && script.description.toLowerCase().includes(query.toLowerCase())) ||
                (script.hashtags && script.hashtags.some(tag => tag.toLowerCase().includes(query.toLowerCase())))
            );
            
            renderFilteredScripts(filteredScripts, `Search results for: "${query}"`);
        }

        function renderFilteredScripts(filteredScripts, title = '') {
            const scriptsList = document.getElementById('scriptsList');
            
            if (filteredScripts.length === 0) {
                scriptsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No scripts found</h3>
                        <p>${title || 'No scripts match your search query'}</p>
                    </div>
                `;
                return;
            }
            
            scriptsList.innerHTML = '';
            filteredScripts.forEach(script => {
                const scriptCard = createScriptCard(script);
                scriptsList.appendChild(scriptCard);
            });
            
            // Add title if provided
            if (title) {
                const titleElement = document.createElement('h3');
                titleElement.textContent = title;
                titleElement.style.marginBottom = '20px';
                titleElement.style.gridColumn = '1 / -1';
                scriptsList.prepend(titleElement);
            }
        }

        function calculateScriptScore(script) {
            let score = 0;
            
            // Base score from interactions
            score += (script.likes || 0) * 10;
            score -= (script.dislikes || 0) * 5;
            score += (script.views || 0) * 0.1;
            
            // Pinned scripts get huge boost
            if (script.pinned) {
                score += 1000;
            }
            
            // Recent scripts get small boost
            const createdAt = script.createdAt || script.uploadDateTime;
            if (createdAt) {
                const ageInDays = (new Date() - new Date(createdAt)) / (1000 * 60 * 60 * 24);
                if (ageInDays < 7) {
                    score += 50 - (ageInDays * 5);
                }
            }
            
            // Hashtag boost for required hashtags
            if (script.hashtags) {
                const requiredHashtags = ['vertex', 'roblox', 'scripts'];
                const hasRequiredTags = requiredHashtags.every(tag => 
                    script.hashtags.includes(tag.toLowerCase())
                );
                if (hasRequiredTags) {
                    score += 50;
                }
                
                // Boost for each additional hashtag
                score += (script.hashtags.length - requiredHashtags.length) * 5;
            }
            
            return score;
        }

        async function renderScripts() {
            const scriptsList = document.getElementById('scriptsList');
            await loadScripts(); // Reload from storage
            
            if (scripts.length === 0) {
                scriptsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-code"></i>
                        <h3>No scripts uploaded yet</h3>
                        <p>Upload your first script to get started!</p>
                        <button class="btn" style="margin-top: 20px;" id="emptyUploadBtn">
                            <i class="fas fa-upload"></i> Upload First Script
                        </button>
                    </div>
                `;
                
                document.getElementById('emptyUploadBtn').addEventListener('click', showUploadForm);
                return;
            }
            
            // Calculate scores and sort
            const scoredScripts = scripts.map(script => ({
                ...script,
                score: calculateScriptScore(script)
            }));
            
            // Sort by score (highest first)
            scoredScripts.sort((a, b) => b.score - a.score);
            
            scriptsList.innerHTML = '';
            
            // Check if we're on PC and use enhanced cards
            const isPC = window.innerWidth >= 769;
            
            scoredScripts.forEach(script => {
                const scriptCard = isPC ? createPCScriptCard(script) : createScriptCard(script);
                scriptsList.appendChild(scriptCard);
            });
        }

        function createPCScriptCard(script) {
            const scriptCard = document.createElement('div');
            scriptCard.className = 'pc-script-card';
            scriptCard.dataset.id = script.id;
            
            // Check if user can delete this script
            const canDelete = currentUser.isAdmin || script.uploader === currentUser.username;
            const deleteBtn = canDelete ? `
                <button class="action-btn delete-btn" data-id="${script.id}" aria-label="Delete script">
                    <i class="fas fa-trash"></i>
                </button>
            ` : '';
            
            // Check if admin can pin
            const pinBtn = currentUser.isAdmin ? `
                <button class="action-btn pin-btn ${script.pinned ? 'pinned' : ''}" data-id="${script.id}" aria-label="${script.pinned ? 'Unpin' : 'Pin'} script">
                    <i class="fas fa-thumbtack"></i>
                </button>
            ` : '';
            
            // Determine thumbnail to show
            let thumbnailHtml = '';
            if (script.youtubeVideo) {
                const videoId = extractYoutubeVideoId(script.youtubeVideo);
                thumbnailHtml = `
                    <div class="pc-script-thumbnail youtube-thumbnail" onclick="event.stopPropagation(); window.open('${script.youtubeVideo}', '_blank')">
                        <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="${script.name}">
                        <div class="play-button" style="width: 50px; height: 50px; font-size: 1.5rem;">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                `;
            } else if (script.thumbnail) {
                thumbnailHtml = `
                    <div class="pc-script-thumbnail">
                        <img src="${script.thumbnail}" alt="${script.name}" loading="lazy">
                    </div>
                `;
            } else {
                thumbnailHtml = `
                    <div class="pc-script-thumbnail" style="background: linear-gradient(45deg, #0c2461, #1e3799); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-code" style="font-size: 3rem; color: #4bcffa;"></i>
                    </div>
                `;
            }
            
            // Hashtags
            let hashtagsHtml = '';
            if (script.hashtags && script.hashtags.length > 0) {
                hashtagsHtml = `
                    <div class="hashtag-container" style="margin-top: 10px;">
                        ${script.hashtags.map(tag => `<span class="hashtag">#${tag}</span>`).join('')}
                    </div>
                `;
            }
            
            scriptCard.innerHTML = `
                ${thumbnailHtml}
                <div class="pc-script-content">
                    <div class="script-card-actions">
                        ${pinBtn}
                        ${deleteBtn}
                    </div>
                    <div>
                        <div class="pc-script-title">${script.name}</div>
                        ${script.description ? `<div class="pc-script-description">${script.description}</div>` : ''}
                        ${hashtagsHtml}
                    </div>
                    <div class="pc-script-meta">
                        <div class="script-uploader">
                            <i class="fas fa-user"></i>
                            ${script.uploader}
                            <span> ${script.uploadDate || 'Unknown date'}</span>
                        </div>
                        <div class="script-stats">
                            <span><i class="fas fa-thumbs-up"></i> ${script.likes || 0}</span>
                            <span><i class="fas fa-eye"></i> ${script.views || 0}</span>
                        </div>
                    </div>
                    <button class="btn unlock-script-btn" data-id="${script.id}" style="margin-top: 10px;">
                        <i class="fas fa-unlock-alt"></i> Unlock Script
                    </button>
                </div>
            `;
            
            // Make entire card clickable to view details
            scriptCard.addEventListener('click', function(e) {
                if (!e.target.closest('button') && !e.target.closest('.youtube-thumbnail')) {
                    showScriptView(script);
                }
            });
            
            // Unlock button
            scriptCard.querySelector('.unlock-script-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                startUnlockProcess(script);
            });
            
            // Delete button
            if (canDelete) {
                scriptCard.querySelector('.delete-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    confirmDelete(script.id);
                });
            }
            
            // Pin button (for admin only)
            if (currentUser.isAdmin) {
                scriptCard.querySelector('.pin-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    togglePinScript(script.id);
                });
            }
            
            // Hashtag click handlers
            scriptCard.querySelectorAll('.hashtag').forEach(hashtag => {
                hashtag.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const tag = this.textContent.substring(1); // Remove #
                    handleHashtagClick(tag, script.id);
                });
            });
            
            return scriptCard;
        }

        function createScriptCard(script) {
            const scriptCard = document.createElement('div');
            scriptCard.className = 'script-card';
            scriptCard.dataset.id = script.id;
            
            // Check if user can delete this script
            const canDelete = currentUser.isAdmin || script.uploader === currentUser.username;
            const deleteBtn = canDelete ? `
                <button class="action-btn delete-btn" data-id="${script.id}" aria-label="Delete script">
                    <i class="fas fa-trash"></i>
                </button>
            ` : '';
            
            // Check if admin can pin
            const pinBtn = currentUser.isAdmin ? `
                <button class="action-btn pin-btn ${script.pinned ? 'pinned' : ''}" data-id="${script.id}" aria-label="${script.pinned ? 'Unpin' : 'Pin'} script">
                    <i class="fas fa-thumbtack"></i>
                </button>
            ` : '';
            
            // Determine thumbnail to show
            let thumbnailHtml = '';
            if (script.youtubeVideo) {
                const videoId = extractYoutubeVideoId(script.youtubeVideo);
                thumbnailHtml = `
                    <div class="script-thumbnail youtube-thumbnail" onclick="event.stopPropagation(); window.open('${script.youtubeVideo}', '_blank')">
                        <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="${script.name}">
                        <div class="play-button" style="width: 50px; height: 50px; font-size: 1.5rem;">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                `;
            } else if (script.thumbnail) {
                thumbnailHtml = `
                    <div class="script-thumbnail">
                        <img src="${script.thumbnail}" alt="${script.name}" loading="lazy">
                    </div>
                `;
            } else {
                thumbnailHtml = `
                    <div class="script-thumbnail">
                        <i class="fas fa-code"></i>
                    </div>
                `;
            }
            
            scriptCard.innerHTML = `
                <div class="script-card-actions">
                    ${pinBtn}
                    ${deleteBtn}
                </div>
                ${thumbnailHtml}
                <div class="script-info">
                    <div class="script-title">${script.name}</div>
                    <div class="script-details">
                        <div class="script-uploader">
                            <i class="fas fa-user"></i>
                            ${script.uploader}
                            <span> ${script.uploadDate || 'Unknown date'}</span>
                        </div>
                        <div class="script-stats">
                            <span><i class="fas fa-thumbs-up"></i> ${script.likes || 0}</span>
                            <span><i class="fas fa-eye"></i> ${script.views || 0}</span>
                        </div>
                    </div>
                    ${script.description ? `<div class="script-description" style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${script.description}</div>` : ''}
                    <div class="steps-indicator">
                        ${script.steps ? script.steps.map((step, index) => 
                            `<div class="step-dot ${index === 0 ? 'active' : ''}"></div>`
                        ).join('') : '<div class="step-dot active"></div>'}
                    </div>
                    <button class="btn unlock-script-btn" data-id="${script.id}">
                        <i class="fas fa-unlock-alt"></i> Unlock Script
                    </button>
                </div>
            `;
            
            // Make entire card clickable to view details
            scriptCard.addEventListener('click', function(e) {
                if (!e.target.closest('button') && !e.target.closest('.youtube-thumbnail')) {
                    showScriptView(script);
                }
            });
            
            // Unlock button
            scriptCard.querySelector('.unlock-script-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                startUnlockProcess(script);
            });
            
            // Delete button
            if (canDelete) {
                scriptCard.querySelector('.delete-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    confirmDelete(script.id);
                });
            }
            
            // Pin button (for admin only)
            if (currentUser.isAdmin) {
                scriptCard.querySelector('.pin-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    togglePinScript(script.id);
                });
            }
            
            return scriptCard;
        }

        async function togglePinScript(scriptId) {
            const script = scripts.find(s => s.id === scriptId);
            
            if (script) {
                script.pinned = !script.pinned;
                await storage.updateScript(script);
                await renderScripts();
                showToast(script.pinned ? 'Script pinned to top' : 'Script unpinned');
            }
        }

        function confirmDelete(scriptId) {
            const script = scripts.find(s => s.id === scriptId);
            if (script && (currentUser.isAdmin || script.uploader === currentUser.username)) {
                scriptToDelete = scriptId;
                document.getElementById('deleteMessage').textContent = `Are you sure you want to delete "${script.name}"? This action cannot be undone.`;
                document.getElementById('deleteModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        async function confirmDeleteScript() {
            if (scriptToDelete) {
                const result = await storage.deleteScript(scriptToDelete);
                if (result.success) {
                    scriptToDelete = null;
                    await renderScripts();
                    await updateStats();
                    showToast('Script deleted successfully');
                    
                    // Update channel if viewing it
                    if (document.getElementById('channelContainer').style.display === 'block') {
                        await loadChannelData();
                    }
                    
                    // Update hashtag explorer if viewing it
                    if (document.getElementById('hashtagExplorer').classList.contains('active')) {
                        await loadHashtagExplorer();
                    }
                } else {
                    showToast(result.error);
                }
            }
            document.getElementById('deleteModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function cancelDelete() {
            scriptToDelete = null;
            document.getElementById('deleteModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        async function uploadScript(e) {
            e.preventDefault();
            
            const scriptName = document.getElementById('scriptName').value;
            const scriptLink = document.getElementById('scriptLink').value;
            const description = document.getElementById('scriptDescription').value;
            const additionalHashtags = document.getElementById('additionalHashtags').value;
            
            if (!scriptLink) {
                showToast('Please enter a script download link');
                return;
            }
            
            // Parse hashtags
            const requiredHashtags = ['vertex', 'roblox', 'scripts'];
            const additionalTags = additionalHashtags.split(/\s+/)
                .filter(tag => tag.startsWith('#') && tag.length > 1)
                .map(tag => tag.substring(1).toLowerCase())
                .filter(tag => tag.length > 0);
            
            const allHashtags = [...requiredHashtags, ...additionalTags];
            
            // Handle thumbnail or YouTube video
            let thumbnail = '';
            let youtubeVideo = '';
            
            if (uploadType === 'thumbnail') {
                const thumbnailInput = document.getElementById('thumbnailInput');
                if (!thumbnailInput.files || thumbnailInput.files.length === 0) {
                    showToast('Please select a thumbnail image');
                    return;
                }
                
                const file = thumbnailInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    thumbnail = event.target.result;
                    finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, allHashtags);
                };
                
                reader.readAsDataURL(file);
            } else {
                // YouTube video
                youtubeVideo = document.getElementById('youtubeLink').value;
                if (!youtubeVideo) {
                    showToast('Please enter a YouTube video URL');
                    return;
                }
                
                const videoId = extractYoutubeVideoId(youtubeVideo);
                if (!videoId) {
                    showToast('Please enter a valid YouTube video URL');
                    return;
                }
                
                // Use YouTube thumbnail as preview
                thumbnail = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, allHashtags);
            }
        }

        async function finishUpload(scriptName, description, scriptLink, thumbnail, youtubeVideo, hashtags) {
            // Get all steps
            const stepContainers = document.querySelectorAll('.step-container');
            const steps = [];
            
            stepContainers.forEach(container => {
                const urlInput = container.querySelector('.step-url');
                const nameInput = container.querySelector('.step-name-input');
                const stepTitle = container.querySelector('.step-title');
                
                let stepName = '';
                if (container.classList.contains('vertex-step')) {
                    stepName = 'Subscribe to VertexR_S';
                } else if (nameInput) {
                    stepName = nameInput.value || `Step ${steps.length + 1}`;
                } else if (stepTitle) {
                    stepName = stepTitle.textContent.replace('Subscribe to VertexR_S (Required)', 'Subscribe to VertexR_S').trim();
                }
                
                if (urlInput.value) {
                    steps.push({
                        url: urlInput.value,
                        name: stepName
                    });
                }
            });
            
            // Create new script object
            const newScript = {
                name: scriptName,
                description: description.substring(0, 500), // Limit description
                thumbnail: thumbnail,
                youtubeVideo: youtubeVideo,
                scriptLink: scriptLink,
                steps: steps,
                hashtags: hashtags,
                uploader: currentUser.username,
                uploadDateTime: new Date().toISOString(),
                likes: 0,
                dislikes: 0,
                views: 0,
                pinned: false
            };
            
            const result = await storage.saveScript(newScript);
            if (result.success) {
                await showDashboard();
                showToast(`Script "${scriptName}" uploaded successfully!`);
            } else {
                showToast(`Error: ${result.error}`);
            }
        }

        function startUnlockProcess(script) {
            currentUnlockScript = script;
            currentStep = 0;
            countdown = 20;
            completedSteps.clear();
            
            const modal = document.getElementById('unlockModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            document.getElementById('unlockScriptName').textContent = script.name.length > 30 ? script.name.substring(0, 30) + '...' : script.name;
            
            const stepChecks = document.getElementById('stepChecks');
            stepChecks.innerHTML = '';
            
            if (script.steps && script.steps.length > 0) {
                script.steps.forEach((step, index) => {
                    const stepCheck = document.createElement('div');
                    stepCheck.className = 'step-check';
                    stepCheck.id = `stepCheck${index}`;
                    stepCheck.innerHTML = `
                        <div class="check-circle" id="checkCircle${index}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="step-text">
                            <div class="step-name">${step.name.length > 40 ? step.name.substring(0, 40) + '...' : step.name}</div>
                            <div class="step-desc">${step.url}</div>
                            <button class="step-link-btn" id="stepLinkBtn${index}" data-url="${step.url}" aria-label="Open ${step.name}">
                                <i class="fas fa-external-link-alt"></i> Open Link
                            </button>
                        </div>
                    `;
                    stepChecks.appendChild(stepCheck);
                    
                    document.getElementById(`stepLinkBtn${index}`).addEventListener('click', function() {
                        const stepIndex = parseInt(this.id.replace('stepLinkBtn', ''));
                        const stepUrl = this.getAttribute('data-url');
                        startStepTimer(stepIndex, stepUrl);
                    });
                });
            } else {
                stepChecks.innerHTML = '<p>No unlock steps required for this script.</p>';
            }
            
            document.getElementById('timer').textContent = countdown;
            document.getElementById('progress').style.width = '0%';
            document.getElementById('accessLinkBtn').disabled = true;
            document.getElementById('accessLinkBtn').innerHTML = '<i class="fas fa-lock"></i> Unlocking... Please wait';
            
            processNextStep();
        }

        function processNextStep() {
            if (!currentUnlockScript.steps || currentStep >= currentUnlockScript.steps.length) {
                startCountdown();
                return;
            }
            
            if (completedSteps.has(currentStep)) {
                const stepCheck = document.getElementById(`stepCheck${currentStep}`);
                stepCheck.classList.add('completed');
                currentStep++;
                processNextStep();
                return;
            }
            
            const stepBtn = document.getElementById(`stepLinkBtn${currentStep}`);
            if (stepBtn) stepBtn.disabled = false;
        }

        function startStepTimer(stepIndex, stepUrl) {
            const stepBtn = document.getElementById(`stepLinkBtn${stepIndex}`);
            stepBtn.disabled = true;
            stepBtn.innerHTML = '<i class="fas fa-clock"></i> Waiting...';
            
            window.open(stepUrl, '_blank');
            
            const checkCircle = document.getElementById(`checkCircle${stepIndex}`);
            checkCircle.classList.add('spinning');
            
            const stepCheck = document.getElementById(`stepCheck${stepIndex}`);
            stepCheck.classList.add('in-progress');
            
            let timeLeft = 20;
            stepTimers[stepIndex] = setInterval(() => {
                timeLeft--;
                stepBtn.innerHTML = `<i class="fas fa-clock"></i> ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(stepTimers[stepIndex]);
                    delete stepTimers[stepIndex];
                    completeStep(stepIndex);
                }
            }, 1000);
        }

        function completeStep(stepIndex) {
            const checkCircle = document.getElementById(`checkCircle${stepIndex}`);
            checkCircle.classList.remove('spinning');
            
            const stepCheck = document.getElementById(`stepCheck${stepIndex}`);
            stepCheck.classList.remove('in-progress');
            stepCheck.classList.add('completed');
            
            const checkIcon = checkCircle.querySelector('i');
            checkIcon.style.opacity = '1';
            
            const stepBtn = document.getElementById(`stepLinkBtn${stepIndex}`);
            stepBtn.innerHTML = '<i class="fas fa-check"></i> Completed';
            stepBtn.disabled = true;
            
            completedSteps.add(stepIndex);
            
            if (stepIndex === currentStep) {
                currentStep++;
                processNextStep();
            }
        }

        function startCountdown() {
            document.getElementById('progress').style.width = '100%';
            
            countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('timer').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    
                    const accessBtn = document.getElementById('accessLinkBtn');
                    accessBtn.disabled = false;
                    accessBtn.innerHTML = '<i class="fas fa-unlock-alt"></i> Access Script Download';
                }
            }, 1000);
        }

        function accessScriptLink() {
            if (currentUnlockScript && !this.disabled) {
                window.open(currentUnlockScript.scriptLink, '_blank');
                closeUnlockModal();
            }
        }

        function closeUnlockModal() {
            Object.keys(stepTimers).forEach(stepIndex => {
                clearInterval(stepTimers[stepIndex]);
            });
            stepTimers = {};
            
            clearInterval(countdownInterval);
            document.getElementById('unlockModal').style.display = 'none';
            currentUnlockScript = null;
            document.body.style.overflow = 'auto';
        }

        function handleThumbnailPreview(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('previewImage');
                    preview.src = event.target.result;
                    document.getElementById('thumbnailPreview').style.display = 'block';
                    document.getElementById('fileLabelText').textContent = file.name.length > 20 ? file.name.substring(0, 20) + '...' : file.name;
                };
                reader.readAsDataURL(file);
            }
        }

        function showToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function handleResize() {
            const isMobile = window.innerWidth < 768;
            const searchInput = document.getElementById('searchInput');
            const pcSearchInput = document.getElementById('pcSearchInput');
            
            if (isMobile) {
                searchInput.placeholder = "Search...";
                document.querySelectorAll('.modal-content').forEach(modal => {
                    modal.style.maxHeight = '85vh';
                });
            } else {
                searchInput.placeholder = "Search scripts...";
                pcSearchInput.placeholder = "Search scripts, hashtags, users...";
            }
            
            // Re-render scripts with appropriate card type
            renderScripts();
        }
    </script>
</body>
    </html>
